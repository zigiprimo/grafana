/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","@grafana/runtime","react","@grafana/ui","@emotion/css","redux","lodash","rxjs","prismjs"],((e,t,r,n,a,o,i,s,l)=>(()=>{var c,u,d={8e3:(e,t,r)=>{"use strict";var n=r(804),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return n.isMemo(e)?i:s[e.$$typeof]||a}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=i;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(h){var a=f(r);a&&a!==h&&e(t,a,n)}var i=u(r);d&&(i=i.concat(d(r)));for(var s=l(t),g=l(r),m=0;m<i.length;++m){var v=i[m];if(!(o[v]||n&&n[v]||g&&g[v]||s&&s[v])){var y=p(r,v);try{c(t,v,y)}catch(e){}}}}return t}},1232:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,n=r?Symbol.for("react.element"):60103,a=r?Symbol.for("react.portal"):60106,o=r?Symbol.for("react.fragment"):60107,i=r?Symbol.for("react.strict_mode"):60108,s=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,c=r?Symbol.for("react.context"):60110,u=r?Symbol.for("react.async_mode"):60111,d=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,h=r?Symbol.for("react.suspense_list"):60120,g=r?Symbol.for("react.memo"):60115,m=r?Symbol.for("react.lazy"):60116,v=r?Symbol.for("react.block"):60121,y=r?Symbol.for("react.fundamental"):60117,b=r?Symbol.for("react.responder"):60118,O=r?Symbol.for("react.scope"):60119;function S(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case u:case d:case o:case s:case i:case f:return e;default:switch(e=e&&e.$$typeof){case c:case p:case m:case g:case l:return e;default:return t}}case a:return t}}}function w(e){return S(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=n,t.ForwardRef=p,t.Fragment=o,t.Lazy=m,t.Memo=g,t.Portal=a,t.Profiler=s,t.StrictMode=i,t.Suspense=f,t.isAsyncMode=function(e){return w(e)||S(e)===u},t.isConcurrentMode=w,t.isContextConsumer=function(e){return S(e)===c},t.isContextProvider=function(e){return S(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return S(e)===p},t.isFragment=function(e){return S(e)===o},t.isLazy=function(e){return S(e)===m},t.isMemo=function(e){return S(e)===g},t.isPortal=function(e){return S(e)===a},t.isProfiler=function(e){return S(e)===s},t.isStrictMode=function(e){return S(e)===i},t.isSuspense=function(e){return S(e)===f},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===d||e===s||e===i||e===f||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===g||e.$$typeof===l||e.$$typeof===c||e.$$typeof===p||e.$$typeof===y||e.$$typeof===b||e.$$typeof===O||e.$$typeof===v)},t.typeOf=S},804:(e,t,r)=>{"use strict";e.exports=r(1232)},2532:(e,t,r)=>{"use strict";var n=r(7480),a=r(9010),o=n.__importDefault(r(1436));t.c=function(e,t){void 0===t&&(t=[]);var r=o.default(e,t,{loading:!0}),n=r[0],i=r[1];return a.useEffect((function(){i()}),[i]),n}},1436:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(7480),a=r(9010),o=n.__importDefault(r(6076));t.default=function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r={loading:!1});var i=a.useRef(0),s=o.default(),l=a.useState(r),c=l[0],u=l[1],d=a.useCallback((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var a=++i.current;return c.loading||u((function(e){return n.__assign(n.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return s()&&a===i.current&&u({value:e,loading:!1}),e}),(function(e){return s()&&a===i.current&&u({error:e,loading:!1}),e}))}),t);return[c,d]}},6076:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9010);t.default=function(){var e=n.useRef(!1),t=n.useCallback((function(){return e.current}),[]);return n.useEffect((function(){return e.current=!0,function(){e.current=!1}}),[]),t}},5628:(e,t,r)=>{const n=Symbol("SemVer ANY");class a{static get ANY(){return n}constructor(e,t){if(t=o(t),e instanceof a){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?i[s.COMPARATORLOOSE]:i[s.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=o(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=a;const o=r(8940),{safeRe:i,t:s}=r(6560),l=r(2800),c=r(8356),u=r(696),d=r(9416)},9416:(e,t,r)=>{class n{constructor(e,t){if(t=o(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof i)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!m(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&v(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&h)|(this.options.loose&&g))+":"+e,r=a.get(t);if(r)return r;const n=this.options.loose,o=n?c[u.HYPHENRANGELOOSE]:c[u.HYPHENRANGE];e=e.replace(o,N(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(c[u.COMPARATORTRIM],d),s("comparator trim",e),e=e.replace(c[u.TILDETRIM],p),s("tilde trim",e),e=e.replace(c[u.CARETTRIM],f),s("caret trim",e);let l=e.split(" ").map((e=>b(e,this.options))).join(" ").split(/\s+/).map((e=>j(e,this.options)));n&&(l=l.filter((e=>(s("loose invalid filter",e,this.options),!!e.match(c[u.COMPARATORLOOSE]))))),s("range list",l);const v=new Map,y=l.map((e=>new i(e,this.options)));for(const e of y){if(m(e))return[e];v.set(e.value,e)}v.size>1&&v.has("")&&v.delete("");const O=[...v.values()];return a.set(t,O),O}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some((r=>y(r,t)&&e.set.some((e=>y(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new l(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(C(this.set[t],e,this.options))return!0;return!1}}e.exports=n;const a=new(r(7136))({max:1e3}),o=r(8940),i=r(5628),s=r(8356),l=r(696),{safeRe:c,t:u,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:f}=r(6560),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:g}=r(1112),m=e=>"<0.0.0-0"===e.value,v=e=>""===e.value,y=(e,t)=>{let r=!0;const n=e.slice();let a=n.pop();for(;r&&n.length;)r=n.every((e=>a.intersects(e,t))),a=n.pop();return r},b=(e,t)=>(s("comp",e,t),e=E(e,t),s("caret",e),e=S(e,t),s("tildes",e),e=x(e,t),s("xrange",e),e=k(e,t),s("stars",e),e),O=e=>!e||"x"===e.toLowerCase()||"*"===e,S=(e,t)=>e.trim().split(/\s+/).map((e=>w(e,t))).join(" "),w=(e,t)=>{const r=t.loose?c[u.TILDELOOSE]:c[u.TILDE];return e.replace(r,((t,r,n,a,o)=>{let i;return s("tilde",e,t,r,n,a,o),O(r)?i="":O(n)?i=`>=${r}.0.0 <${+r+1}.0.0-0`:O(a)?i=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:o?(s("replaceTilde pr",o),i=`>=${r}.${n}.${a}-${o} <${r}.${+n+1}.0-0`):i=`>=${r}.${n}.${a} <${r}.${+n+1}.0-0`,s("tilde return",i),i}))},E=(e,t)=>e.trim().split(/\s+/).map((e=>T(e,t))).join(" "),T=(e,t)=>{s("caret",e,t);const r=t.loose?c[u.CARETLOOSE]:c[u.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,((t,r,a,o,i)=>{let l;return s("caret",e,t,r,a,o,i),O(r)?l="":O(a)?l=`>=${r}.0.0${n} <${+r+1}.0.0-0`:O(o)?l="0"===r?`>=${r}.${a}.0${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.0${n} <${+r+1}.0.0-0`:i?(s("replaceCaret pr",i),l="0"===r?"0"===a?`>=${r}.${a}.${o}-${i} <${r}.${a}.${+o+1}-0`:`>=${r}.${a}.${o}-${i} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${o}-${i} <${+r+1}.0.0-0`):(s("no pr"),l="0"===r?"0"===a?`>=${r}.${a}.${o}${n} <${r}.${a}.${+o+1}-0`:`>=${r}.${a}.${o}${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${o} <${+r+1}.0.0-0`),s("caret return",l),l}))},x=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map((e=>P(e,t))).join(" ")),P=(e,t)=>{e=e.trim();const r=t.loose?c[u.XRANGELOOSE]:c[u.XRANGE];return e.replace(r,((r,n,a,o,i,l)=>{s("xRange",e,r,n,a,o,i,l);const c=O(a),u=c||O(o),d=u||O(i),p=d;return"="===n&&p&&(n=""),l=t.includePrerelease?"-0":"",c?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&p?(u&&(o=0),i=0,">"===n?(n=">=",u?(a=+a+1,o=0,i=0):(o=+o+1,i=0)):"<="===n&&(n="<",u?a=+a+1:o=+o+1),"<"===n&&(l="-0"),r=`${n+a}.${o}.${i}${l}`):u?r=`>=${a}.0.0${l} <${+a+1}.0.0-0`:d&&(r=`>=${a}.${o}.0${l} <${a}.${+o+1}.0-0`),s("xRange return",r),r}))},k=(e,t)=>(s("replaceStars",e,t),e.trim().replace(c[u.STAR],"")),j=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?u.GTE0PRE:u.GTE0],"")),N=e=>(t,r,n,a,o,i,s,l,c,u,d,p,f)=>`${r=O(n)?"":O(a)?`>=${n}.0.0${e?"-0":""}`:O(o)?`>=${n}.${a}.0${e?"-0":""}`:i?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=O(c)?"":O(u)?`<${+c+1}.0.0-0`:O(d)?`<${c}.${+u+1}.0-0`:p?`<=${c}.${u}.${d}-${p}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),C=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(s(e[r].semver),e[r].semver!==i.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},696:(e,t,r)=>{const n=r(8356),{MAX_LENGTH:a,MAX_SAFE_INTEGER:o}=r(1112),{safeRe:i,t:s}=r(6560),l=r(8940),{compareIdentifiers:c}=r(7904);class u{constructor(e,t){if(t=l(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a)throw new TypeError(`version is longer than ${a} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?i[s.LOOSE]:i[s.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<o)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],a=e.prerelease[t];if(n("prerelease compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return-1;if(r!==a)return c(r,a)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const r=this.build[t],a=e.build[t];if(n("prerelease compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return-1;if(r!==a)return c(r,a)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},1848:(e,t,r)=>{const n=r(7292);e.exports=(e,t)=>{const r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},2800:(e,t,r)=>{const n=r(7036),a=r(4284),o=r(9549),i=r(7196),s=r(4e3),l=r(2384);e.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,c);case"!=":return a(e,r,c);case">":return o(e,r,c);case">=":return i(e,r,c);case"<":return s(e,r,c);case"<=":return l(e,r,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},1808:(e,t,r)=>{const n=r(696),a=r(7292),{safeRe:o,t:i}=r(6560);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const n=t.includePrerelease?o[i.COERCERTLFULL]:o[i.COERCERTL];let a;for(;(a=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&a.index+a[0].length===r.index+r[0].length||(r=a),n.lastIndex=a.index+a[1].length+a[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?o[i.COERCEFULL]:o[i.COERCE]);if(null===r)return null;const s=r[2],l=r[3]||"0",c=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return a(`${s}.${l}.${c}${u}${d}`,t)}},5876:(e,t,r)=>{const n=r(696);e.exports=(e,t,r)=>{const a=new n(e,r),o=new n(t,r);return a.compare(o)||a.compareBuild(o)}},5636:(e,t,r)=>{const n=r(1524);e.exports=(e,t)=>n(e,t,!0)},1524:(e,t,r)=>{const n=r(696);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},1228:(e,t,r)=>{const n=r(7292);e.exports=(e,t)=>{const r=n(e,null,!0),a=n(t,null,!0),o=r.compare(a);if(0===o)return null;const i=o>0,s=i?r:a,l=i?a:r,c=!!s.prerelease.length;if(l.prerelease.length&&!c)return l.patch||l.minor?s.patch?"patch":s.minor?"minor":"major":"major";const u=c?"pre":"";return r.major!==a.major?u+"major":r.minor!==a.minor?u+"minor":r.patch!==a.patch?u+"patch":"prerelease"}},7036:(e,t,r)=>{const n=r(1524);e.exports=(e,t,r)=>0===n(e,t,r)},9549:(e,t,r)=>{const n=r(1524);e.exports=(e,t,r)=>n(e,t,r)>0},7196:(e,t,r)=>{const n=r(1524);e.exports=(e,t,r)=>n(e,t,r)>=0},7600:(e,t,r)=>{const n=r(696);e.exports=(e,t,r,a,o)=>{"string"==typeof r&&(o=a,a=r,r=void 0);try{return new n(e instanceof n?e.version:e,r).inc(t,a,o).version}catch(e){return null}}},4e3:(e,t,r)=>{const n=r(1524);e.exports=(e,t,r)=>n(e,t,r)<0},2384:(e,t,r)=>{const n=r(1524);e.exports=(e,t,r)=>n(e,t,r)<=0},9800:(e,t,r)=>{const n=r(696);e.exports=(e,t)=>new n(e,t).major},8152:(e,t,r)=>{const n=r(696);e.exports=(e,t)=>new n(e,t).minor},4284:(e,t,r)=>{const n=r(1524);e.exports=(e,t,r)=>0!==n(e,t,r)},7292:(e,t,r)=>{const n=r(696);e.exports=(e,t,r=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!r)return null;throw e}}},4812:(e,t,r)=>{const n=r(696);e.exports=(e,t)=>new n(e,t).patch},2680:(e,t,r)=>{const n=r(7292);e.exports=(e,t)=>{const r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},9948:(e,t,r)=>{const n=r(1524);e.exports=(e,t,r)=>n(t,e,r)},2912:(e,t,r)=>{const n=r(5876);e.exports=(e,t)=>e.sort(((e,r)=>n(r,e,t)))},5776:(e,t,r)=>{const n=r(9416);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},6108:(e,t,r)=>{const n=r(5876);e.exports=(e,t)=>e.sort(((e,r)=>n(e,r,t)))},7827:(e,t,r)=>{const n=r(7292);e.exports=(e,t)=>{const r=n(e,t);return r?r.version:null}},1148:(e,t,r)=>{const n=r(6560),a=r(1112),o=r(696),i=r(7904),s=r(7292),l=r(7827),c=r(1848),u=r(7600),d=r(1228),p=r(9800),f=r(8152),h=r(4812),g=r(2680),m=r(1524),v=r(9948),y=r(5636),b=r(5876),O=r(6108),S=r(2912),w=r(9549),E=r(4e3),T=r(7036),x=r(4284),P=r(7196),k=r(2384),j=r(2800),N=r(1808),C=r(5628),_=r(9416),R=r(5776),D=r(4628),I=r(9384),A=r(4732),F=r(7816),$=r(404),L=r(7908),Q=r(9344),q=r(88),z=r(6640),M=r(576),V=r(5012);e.exports={parse:s,valid:l,clean:c,inc:u,diff:d,major:p,minor:f,patch:h,prerelease:g,compare:m,rcompare:v,compareLoose:y,compareBuild:b,sort:O,rsort:S,gt:w,lt:E,eq:T,neq:x,gte:P,lte:k,cmp:j,coerce:N,Comparator:C,Range:_,satisfies:R,toComparators:D,maxSatisfying:I,minSatisfying:A,minVersion:F,validRange:$,outside:L,gtr:Q,ltr:q,intersects:z,simplifyRange:M,subset:V,SemVer:o,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:i.compareIdentifiers,rcompareIdentifiers:i.rcompareIdentifiers}},1112:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},8356:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},7904:e=>{const t=/^[0-9]+$/,r=(e,r)=>{const n=t.test(e),a=t.test(r);return n&&a&&(e=+e,r=+r),e===r?0:n&&!a?-1:a&&!n?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},8940:e=>{const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},6560:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:o}=r(1112),i=r(8356),s=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.t={};let d=0;const p="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",o],[p,a]],h=(e,t,r)=>{const n=(e=>{for(const[t,r]of f)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),a=d++;i(e,a,t),u[e]=a,c[a]=t,s[a]=new RegExp(t,r?"g":void 0),l[a]=new RegExp(n,r?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","\\d+"),h("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),h("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER",`${p}+`),h("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),h("FULL",`^${c[u.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),h("LOOSE",`^${c[u.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),h("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),h("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),h("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),h("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),h("COERCERTL",c[u.COERCE],!0),h("COERCERTLFULL",c[u.COERCEFULL],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},7136:(e,t,r)=>{"use strict";const n=r(9528),a=Symbol("max"),o=Symbol("length"),i=Symbol("lengthCalculator"),s=Symbol("allowStale"),l=Symbol("maxAge"),c=Symbol("dispose"),u=Symbol("noDisposeOnSet"),d=Symbol("lruList"),p=Symbol("cache"),f=Symbol("updateAgeOnGet"),h=()=>1,g=(e,t,r)=>{const n=e[p].get(t);if(n){const t=n.value;if(m(e,t)){if(y(e,n),!e[s])return}else r&&(e[f]&&(n.value.now=Date.now()),e[d].unshiftNode(n));return t.value}},m=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;const r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[l]&&r>e[l]},v=e=>{if(e[o]>e[a])for(let t=e[d].tail;e[o]>e[a]&&null!==t;){const r=t.prev;y(e,t),t=r}},y=(e,t)=>{if(t){const r=t.value;e[c]&&e[c](r.key,r.value),e[o]-=r.length,e[p].delete(r.key),e[d].removeNode(t)}};class b{constructor(e,t,r,n,a){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=a||0}}const O=(e,t,r,n)=>{let a=r.value;m(e,a)&&(y(e,r),e[s]||(a=void 0)),a&&t.call(n,a.value,a.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[a]=e.max||1/0;const t=e.length||h;if(this[i]="function"!=typeof t?h:t,this[s]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[c]=e.dispose,this[u]=e.noDisposeOnSet||!1,this[f]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[a]=e||1/0,v(this)}get max(){return this[a]}set allowStale(e){this[s]=!!e}get allowStale(){return this[s]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[l]=e,v(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!=typeof e&&(e=h),e!==this[i]&&(this[i]=e,this[o]=0,this[d].forEach((e=>{e.length=this[i](e.value,e.key),this[o]+=e.length}))),v(this)}get lengthCalculator(){return this[i]}get length(){return this[o]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let r=this[d].tail;null!==r;){const n=r.prev;O(this,e,r,t),r=n}}forEach(e,t){t=t||this;for(let r=this[d].head;null!==r;){const n=r.next;O(this,e,r,t),r=n}}keys(){return this[d].toArray().map((e=>e.key))}values(){return this[d].toArray().map((e=>e.value))}reset(){this[c]&&this[d]&&this[d].length&&this[d].forEach((e=>this[c](e.key,e.value))),this[p]=new Map,this[d]=new n,this[o]=0}dump(){return this[d].map((e=>!m(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[d]}set(e,t,r){if((r=r||this[l])&&"number"!=typeof r)throw new TypeError("maxAge must be a number");const n=r?Date.now():0,s=this[i](t,e);if(this[p].has(e)){if(s>this[a])return y(this,this[p].get(e)),!1;const i=this[p].get(e).value;return this[c]&&(this[u]||this[c](e,i.value)),i.now=n,i.maxAge=r,i.value=t,this[o]+=s-i.length,i.length=s,this.get(e),v(this),!0}const f=new b(e,t,s,n,r);return f.length>this[a]?(this[c]&&this[c](e,t),!1):(this[o]+=f.length,this[d].unshift(f),this[p].set(e,this[d].head),v(this),!0)}has(e){if(!this[p].has(e))return!1;const t=this[p].get(e).value;return!m(this,t)}get(e){return g(this,e,!0)}peek(e){return g(this,e,!1)}pop(){const e=this[d].tail;return e?(y(this,e),e.value):null}del(e){y(this,this[p].get(e))}load(e){this.reset();const t=Date.now();for(let r=e.length-1;r>=0;r--){const n=e[r],a=n.e||0;if(0===a)this.set(n.k,n.v);else{const e=a-t;e>0&&this.set(n.k,n.v,e)}}}prune(){this[p].forEach(((e,t)=>g(this,t,!1)))}}},9344:(e,t,r)=>{const n=r(7908);e.exports=(e,t,r)=>n(e,t,">",r)},6640:(e,t,r)=>{const n=r(9416);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t,r))},88:(e,t,r)=>{const n=r(7908);e.exports=(e,t,r)=>n(e,t,"<",r)},9384:(e,t,r)=>{const n=r(696),a=r(9416);e.exports=(e,t,r)=>{let o=null,i=null,s=null;try{s=new a(t,r)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(o&&-1!==i.compare(e)||(o=e,i=new n(o,r)))})),o}},4732:(e,t,r)=>{const n=r(696),a=r(9416);e.exports=(e,t,r)=>{let o=null,i=null,s=null;try{s=new a(t,r)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(o&&1!==i.compare(e)||(o=e,i=new n(o,r)))})),o}},7816:(e,t,r)=>{const n=r(696),a=r(9416),o=r(9549);e.exports=(e,t)=>{e=new a(e,t);let r=new n("0.0.0");if(e.test(r))return r;if(r=new n("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const a=e.set[t];let i=null;a.forEach((e=>{const t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!o(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||r&&!o(r,i)||(r=i)}return r&&e.test(r)?r:null}},7908:(e,t,r)=>{const n=r(696),a=r(5628),{ANY:o}=a,i=r(9416),s=r(5776),l=r(9549),c=r(4e3),u=r(2384),d=r(7196);e.exports=(e,t,r,p)=>{let f,h,g,m,v;switch(e=new n(e,p),t=new i(t,p),r){case">":f=l,h=u,g=c,m=">",v=">=";break;case"<":f=c,h=d,g=l,m="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,p))return!1;for(let r=0;r<t.set.length;++r){const n=t.set[r];let i=null,s=null;if(n.forEach((e=>{e.semver===o&&(e=new a(">=0.0.0")),i=i||e,s=s||e,f(e.semver,i.semver,p)?i=e:g(e.semver,s.semver,p)&&(s=e)})),i.operator===m||i.operator===v)return!1;if((!s.operator||s.operator===m)&&h(e,s.semver))return!1;if(s.operator===v&&g(e,s.semver))return!1}return!0}},576:(e,t,r)=>{const n=r(5776),a=r(1524);e.exports=(e,t,r)=>{const o=[];let i=null,s=null;const l=e.sort(((e,t)=>a(e,t,r)));for(const e of l)n(e,t,r)?(s=e,i||(i=e)):(s&&o.push([i,s]),s=null,i=null);i&&o.push([i,null]);const c=[];for(const[e,t]of o)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},5012:(e,t,r)=>{const n=r(9416),a=r(5628),{ANY:o}=a,i=r(5776),s=r(1524),l=[new a(">=0.0.0-0")],c=[new a(">=0.0.0")],u=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===o){if(1===t.length&&t[0].semver===o)return!0;e=r.includePrerelease?l:c}if(1===t.length&&t[0].semver===o){if(r.includePrerelease)return!0;t=c}const n=new Set;let a,u,f,h,g,m,v;for(const t of e)">"===t.operator||">="===t.operator?a=d(a,t,r):"<"===t.operator||"<="===t.operator?u=p(u,t,r):n.add(t.semver);if(n.size>1)return null;if(a&&u){if(f=s(a.semver,u.semver,r),f>0)return null;if(0===f&&(">="!==a.operator||"<="!==u.operator))return null}for(const e of n){if(a&&!i(e,String(a),r))return null;if(u&&!i(e,String(u),r))return null;for(const n of t)if(!i(e,String(n),r))return!1;return!0}let y=!(!u||r.includePrerelease||!u.semver.prerelease.length)&&u.semver,b=!(!a||r.includePrerelease||!a.semver.prerelease.length)&&a.semver;y&&1===y.prerelease.length&&"<"===u.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(v=v||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,a)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if(h=d(a,e,r),h===e&&h!==a)return!1}else if(">="===a.operator&&!i(a.semver,String(e),r))return!1;if(u)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(g=p(u,e,r),g===e&&g!==u)return!1}else if("<="===u.operator&&!i(u.semver,String(e),r))return!1;if(!e.operator&&(u||a)&&0!==f)return!1}return!(a&&m&&!u&&0!==f||u&&v&&!a&&0!==f||b||y)},d=(e,t,r)=>{if(!e)return t;const n=s(e.semver,t.semver,r);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},p=(e,t,r)=>{if(!e)return t;const n=s(e.semver,t.semver,r);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let a=!1;e:for(const n of e.set){for(const e of t.set){const t=u(n,e,r);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},4628:(e,t,r)=>{const n=r(9416);e.exports=(e,t)=>new n(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},404:(e,t,r)=>{const n=r(9416);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},6104:(e,t,r)=>{"use strict";r.d(t,{c:()=>l});const n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let a;const o=new Uint8Array(16);function i(){if(!a&&(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!a))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(o)}const s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));const l=function(e,t,r){if(n.randomUUID&&!t&&!e)return n.randomUUID();const a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]}(a)}},9304:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},9528:(e,t,r)=>{"use strict";function n(e){var t=this;if(t instanceof n||(t=new n),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var r=0,a=arguments.length;r<a;r++)t.push(arguments[r]);return t}function a(e,t,r,n){if(!(this instanceof a))return new a(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=n,n.Node=a,n.create=n,n.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},n.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},n.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},n.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)n=arguments[e],(r=this).tail=new a(n,r.tail,null,r),r.head||(r.head=r.tail),r.length++;var r,n;return this.length},n.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)n=arguments[e],(r=this).head=new a(n,null,r.head,r),r.tail||(r.tail=r.head),r.length++;var r,n;return this.length},n.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},n.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},n.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},n.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},n.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},n.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},n.prototype.map=function(e,t){t=t||this;for(var r=new n,a=this.head;null!==a;)r.push(e.call(t,a.value,this)),a=a.next;return r},n.prototype.mapReverse=function(e,t){t=t||this;for(var r=new n,a=this.tail;null!==a;)r.push(e.call(t,a.value,this)),a=a.prev;return r},n.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var a=0;null!==n;a++)r=e(r,n.value,a),n=n.next;return r},n.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var a=this.length-1;null!==n;a--)r=e(r,n.value,a),n=n.prev;return r},n.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},n.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},n.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var a=0,o=this.head;null!==o&&a<e;a++)o=o.next;for(;null!==o&&a<t;a++,o=o.next)r.push(o.value);return r},n.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var a=this.length,o=this.tail;null!==o&&a>t;a--)o=o.prev;for(;null!==o&&a>e;a--,o=o.prev)r.push(o.value);return r},n.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,o=this.head;null!==o&&n<e;n++)o=o.next;var i,s,l,c,u=[];for(n=0;o&&n<t;n++)u.push(o.value),o=this.removeNode(o);for(null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev),n=0;n<r.length;n++)i=this,s=o,l=r[n],c=void 0,null===(c=s===i.head?new a(l,null,s,i):new a(l,s,s.next,i)).next&&(i.tail=c),null===c.prev&&(i.head=c),i.length++,o=c;return u},n.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};try{r(9304)(n)}catch(e){}},7696:e=>{"use strict";e.exports=a},3744:t=>{"use strict";t.exports=e},1622:e=>{"use strict";e.exports=t},4568:e=>{"use strict";e.exports=n},1928:e=>{"use strict";e.exports=i},4586:e=>{"use strict";e.exports=l},9010:e=>{"use strict";e.exports=r},6600:e=>{"use strict";e.exports=o},9464:e=>{"use strict";e.exports=s},4916:(e,t,r)=>{"use strict";r.d(t,{oF:()=>ae,ML:()=>U});const n=1024;let a=0;class o{constructor(e,t){this.from=e,this.to=t}}class i{constructor(e={}){this.id=a++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=c.match(e)),t=>{let r=e(t);return void 0===r?null:[this,r]}}}i.closedBy=new i({deserialize:e=>e.split(" ")}),i.openedBy=new i({deserialize:e=>e.split(" ")}),i.group=new i({deserialize:e=>e.split(" ")}),i.isolate=new i({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),i.contextHash=new i({perNode:!0}),i.lookAhead=new i({perNode:!0}),i.mounted=new i({perNode:!0});class s{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[i.mounted.id]}}const l=Object.create(null);class c{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):l,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new c(e.name||"",t,e.id,r);if(e.props)for(let r of e.props)if(Array.isArray(r)||(r=r(n)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(i.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return e=>{for(let r=e.prop(i.group),n=-1;n<(r?r.length:0);n++){let a=t[n<0?e.name:r[n]];if(a)return a}}}}c.none=new c("",Object.create(null),0,8);class u{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let n=null;for(let t of e){let e=t(r);e&&(n||(n=Object.assign({},r.props)),n[e[0].id]=e[1])}t.push(n?new c(r.name,n,r.id,r.flags):r)}return new u(t)}}const d=new WeakMap,p=new WeakMap;var f;!function(e){e[e.ExcludeBuffers=1]="ExcludeBuffers",e[e.IncludeAnonymous=2]="IncludeAnonymous",e[e.IgnoreMounts=4]="IgnoreMounts",e[e.IgnoreOverlays=8]="IgnoreOverlays"}(f||(f={}));class h{constructor(e,t,r,n,a){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,a&&a.length){this.props=Object.create(null);for(let[e,t]of a)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=s.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let r=e.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new k(this.topNode,e)}cursorAt(e,t=0,r=0){let n=d.get(this)||this.topNode,a=new k(n);return a.moveTo(e,t),d.set(this,a._tree),a}get topNode(){return new O(this,0,0,null)}resolve(e,t=0){let r=y(d.get(this)||this.topNode,e,t,!1);return d.set(this,r),r}resolveInner(e,t=0){let r=y(p.get(this)||this.topNode,e,t,!0);return p.set(this,r),r}resolveStack(e,t=0){return function(e,t,r){let n=e.resolveInner(t,r),a=null;for(let e=n instanceof O?n:n.context.parent;e;e=e.parent)if(e.index<0){let o=e.parent;(a||(a=[n])).push(o.resolve(t,r)),e=o}else{let o=s.get(e.tree);if(o&&o.overlay&&o.overlay[0].from<=t&&o.overlay[o.overlay.length-1].to>=t){let i=new O(o.tree,o.overlay[0].from+e.from,-1,e);(a||(a=[n])).push(y(i,t,r,!1))}}return a?x(a):n}(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:a=this.length}=e,o=e.mode||0,i=(o&f.IncludeAnonymous)>0;for(let e=this.cursor(o|f.IncludeAnonymous);;){let o=!1;if(e.from<=a&&e.to>=n&&(!i&&e.type.isAnonymous||!1!==t(e))){if(e.firstChild())continue;o=!0}for(;o&&r&&(i||!e.type.isAnonymous)&&r(e),!e.nextSibling();){if(!e.parent())return;o=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:_(c.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,r)=>new h(this.type,e,t,r,this.propValues)),e.makeTree||((e,t,r)=>new h(c.none,e,t,r)))}static build(e){return function(e){var t;let{buffer:r,nodeSet:a,maxBufferLength:o=n,reused:s=[],minRepeatType:l=a.types.length}=e,c=Array.isArray(r)?new g(r,r.length):r,u=a.types,d=0,p=0;function f(e,t,r,n,g,S){let{id:w,start:E,end:T,size:x}=c,P=p;for(;x<0;){if(c.next(),-1==x){let t=s[w];return r.push(t),void n.push(E-e)}if(-3==x)return void(d=w);if(-4==x)return void(p=w);throw new RangeError(`Unrecognized record size: ${x}`)}let k,j,N=u[w],C=E-e;if(T-E<=o&&(j=function(e,t){let r=c.fork(),n=0,a=0,i=0,s=r.end-o,u={size:0,start:0,skip:0};e:for(let o=r.pos-e;r.pos>o;){let e=r.size;if(r.id==t&&e>=0){u.size=n,u.start=a,u.skip=i,i+=4,n+=4,r.next();continue}let c=r.pos-e;if(e<0||c<o||r.start<s)break;let d=r.id>=l?4:0,p=r.start;for(r.next();r.pos>c;){if(r.size<0){if(-3!=r.size)break e;d+=4}else r.id>=l&&(d+=4);r.next()}a=p,n+=e,i+=d}return(t<0||n==e)&&(u.size=n,u.start=a,u.skip=i),u.size>4?u:void 0}(c.pos-t,g))){let t=new Uint16Array(j.size-j.skip),r=c.pos-j.size,n=t.length;for(;c.pos>r;)n=O(j.start,t,n);k=new m(t,T-j.start,a),C=j.start-e}else{let e=c.pos-x;c.next();let t=[],r=[],n=w>=l?w:-1,a=0,s=T;for(;c.pos>e;)n>=0&&c.id==n&&c.size>=0?(c.end<=s-o&&(y(t,r,E,a,c.end,s,n,P),a=t.length,s=c.end),c.next()):S>2500?v(E,e,t,r):f(E,e,t,r,n,S+1);if(n>=0&&a>0&&a<t.length&&y(t,r,E,a,E,s,n,P),t.reverse(),r.reverse(),n>-1&&a>0){let e=function(e){return(t,r,n)=>{let a,o,s=0,l=t.length-1;if(l>=0&&(a=t[l])instanceof h){if(!l&&a.type==e&&a.length==n)return a;(o=a.prop(i.lookAhead))&&(s=r[l]+a.length+o)}return b(e,t,r,n,s)}}(N);k=_(N,t,r,0,t.length,0,T-E,e,e)}else k=b(N,t,r,T-E,P-T)}r.push(k),n.push(C)}function v(e,t,r,n){let i=[],s=0,l=-1;for(;c.pos>t;){let{id:e,start:t,end:r,size:n}=c;if(n>4)c.next();else{if(l>-1&&t<l)break;l<0&&(l=r-o),i.push(e,t,r),s++,c.next()}}if(s){let t=new Uint16Array(4*s),o=i[i.length-2];for(let e=i.length-3,r=0;e>=0;e-=3)t[r++]=i[e],t[r++]=i[e+1]-o,t[r++]=i[e+2]-o,t[r++]=r;r.push(new m(t,i[2]-o,a)),n.push(o-e)}}function y(e,t,r,n,o,i,s,l){let c=[],u=[];for(;e.length>n;)c.push(e.pop()),u.push(t.pop()+r-o);e.push(b(a.types[s],c,u,i-o,l-i)),t.push(o-r)}function b(e,t,r,n,a=0,o){if(d){let e=[i.contextHash,d];o=o?[e].concat(o):[e]}if(a>25){let e=[i.lookAhead,a];o=o?[e].concat(o):[e]}return new h(e,t,r,n,o)}function O(e,t,r){let{id:n,start:a,end:o,size:i}=c;if(c.next(),i>=0&&n<l){let s=r;if(i>4){let n=c.pos-(i-4);for(;c.pos>n;)r=O(e,t,r)}t[--r]=s,t[--r]=o-e,t[--r]=a-e,t[--r]=n}else-3==i?d=n:-4==i&&(p=n);return r}let S=[],w=[];for(;c.pos>0;)f(e.start||0,e.bufferStart||0,S,w,-1,0);let E=null!==(t=e.length)&&void 0!==t?t:S.length?w[0]+S[0].length:0;return new h(u[e.topID],S.reverse(),w.reverse(),E)}(e)}}h.empty=new h(c.none,[],[],0);class g{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new g(this.buffer,this.index)}}class m{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return c.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],a=n.name;if(/\W/.test(a)&&!n.isError&&(a=JSON.stringify(a)),r==(e+=4))return a;let o=[];for(;e<r;)o.push(this.childString(e)),e=this.buffer[e+3];return a+"("+o.join(",")+")"}findChild(e,t,r,n,a){let{buffer:o}=this,i=-1;for(let s=e;s!=t&&!(v(a,n,o[s+1],o[s+2])&&(i=s,r>0));s=o[s+3]);return i}slice(e,t,r){let n=this.buffer,a=new Uint16Array(t-e),o=0;for(let i=e,s=0;i<t;){a[s++]=n[i++],a[s++]=n[i++]-r;let t=a[s++]=n[i++]-r;a[s++]=n[i++]-e,o=Math.max(o,t)}return new m(a,o,this.set)}}function v(e,t,r,n){switch(e){case-2:return r<t;case-1:return n>=t&&r<t;case 0:return r<t&&n>t;case 1:return r<=t&&n>t;case 2:return n>t;case 4:return!0}}function y(e,t,r,n){for(var a;e.from==e.to||(r<1?e.from>=t:e.from>t)||(r>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof O&&e.index<0?null:e.parent;if(!t)return e;e=t}let o=n?0:f.IgnoreOverlays;if(n)for(let n=e,i=n.parent;i;n=i,i=n.parent)n instanceof O&&n.index<0&&(null===(a=i.enter(t,r,o))||void 0===a?void 0:a.from)!=n.from&&(e=i);for(;;){let n=e.enter(t,r,o);if(!n)return e;e=n}}class b{cursor(e=0){return new k(this,e)}getChild(e,t=null,r=null){let n=S(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return S(this,e,t,r)}resolve(e,t=0){return y(this,e,t,!1)}resolveInner(e,t=0){return y(this,e,t,!0)}matchContext(e){return w(this,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(r=t,t=e.prevSibling):t=e}return r}get node(){return this}get next(){return this.parent}}class O extends b{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,a=0){for(let o=this;;){for(let{children:i,positions:l}=o._tree,c=t>0?i.length:-1;e!=c;e+=t){let c=i[e],u=l[e]+o.from;if(v(n,r,u,u+c.length))if(c instanceof m){if(a&f.ExcludeBuffers)continue;let i=c.findChild(0,c.buffer.length,t,r-u,n);if(i>-1)return new T(new E(o,c,e,u),null,i)}else if(a&f.IncludeAnonymous||!c.type.isAnonymous||j(c)){let i;if(!(a&f.IgnoreMounts)&&(i=s.get(c))&&!i.overlay)return new O(i.tree,u,e,o);let l=new O(c,u,e,o);return a&f.IncludeAnonymous||!l.type.isAnonymous?l:l.nextChild(t<0?c.children.length-1:0,t,r,n)}}if(a&f.IncludeAnonymous||!o.type.isAnonymous)return null;if(e=o.index>=0?o.index+t:t<0?-1:o._parent._tree.children.length,o=o._parent,!o)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let n;if(!(r&f.IgnoreOverlays)&&(n=s.get(this._tree))&&n.overlay){let r=e-this.from;for(let{from:e,to:a}of n.overlay)if((t>0?e<=r:e<r)&&(t<0?a>=r:a>r))return new O(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function S(e,t,r,n){let a=e.cursor(),o=[];if(!a.firstChild())return o;if(null!=r)for(let e=!1;!e;)if(e=a.type.is(r),!a.nextSibling())return o;for(;;){if(null!=n&&a.type.is(n))return o;if(a.type.is(t)&&o.push(a.node),!a.nextSibling())return null==n?o:[]}}function w(e,t,r=t.length-1){for(let n=e.parent;r>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[r]&&t[r]!=n.name)return!1;r--}}return!0}class E{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class T extends b{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,a=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return a<0?null:new T(this.context,this,a)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&f.ExcludeBuffers)return null;let{buffer:n}=this.context,a=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return a<0?null:new T(this.context,this,a)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new T(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new T(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,a=r.buffer[this.index+3];if(a>n){let o=r.buffer[this.index+1];e.push(r.slice(n,a,o)),t.push(0)}return new h(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function x(e){if(!e.length)return null;let t=0,r=e[0];for(let n=1;n<e.length;n++){let a=e[n];(a.from>r.from||a.to<r.to)&&(r=a,t=n)}let n=r instanceof O&&r.index<0?null:r.parent,a=e.slice();return n?a[t]=n:a.splice(t,1),new P(a,r)}class P{constructor(e,t){this.heads=e,this.node=t}get next(){return x(this.heads)}}class k{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof O)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof O?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,a=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return!(a<0)&&(this.stack.push(this.index),this.yieldBuf(a))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?!(r&f.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&f.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&f.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let e=r<0?0:this.stack[r]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(e)}return r<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;({index:t,_parent:r}=r))if(t>-1)for(let n=t+e,a=e<0?-1:r._tree.children.length;n!=a;n+=e){let e=r._tree.children[n];if(this.mode&f.IncludeAnonymous||e instanceof m||!e.type.isAnonymous||j(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,a=this.stack.length;a>=0;){for(let o=e;o;o=o._parent)if(o.index==n){if(n==this.index)return o;t=o,r=a+1;break e}n=this.stack[--a]}for(let e=r;e<this.stack.length;e++)t=new T(this.buffer,t,this.stack[e]);return this.bufferNode=new T(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return w(this.node,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,a=this.stack.length-1;n>=0;a--){if(a<0)return w(this.node,e,n);let o=r[t.buffer[this.stack[a]]];if(!o.isAnonymous){if(e[n]&&e[n]!=o.name)return!1;n--}}return!0}}function j(e){return e.children.some((e=>e instanceof m||!e.type.isAnonymous||j(e)))}const N=new WeakMap;function C(e,t){if(!e.isAnonymous||t instanceof m||t.type!=e)return 1;let r=N.get(t);if(null==r){r=1;for(let n of t.children){if(n.type!=e||!(n instanceof h)){r=1;break}r+=C(e,n)}N.set(t,r)}return r}function _(e,t,r,n,a,o,i,s,l){let c=0;for(let r=n;r<a;r++)c+=C(e,t[r]);let u=Math.ceil(1.5*c/8),d=[],p=[];return function t(r,n,a,i,s){for(let c=a;c<i;){let a=c,f=n[c],h=C(e,r[c]);for(c++;c<i;c++){let t=C(e,r[c]);if(h+t>=u)break;h+=t}if(c==a+1){if(h>u){let e=r[a];t(e.children,e.positions,0,e.children.length,n[a]+s);continue}d.push(r[a])}else{let t=n[c-1]+r[c-1].length-f;d.push(_(e,r,n,a,c,f,t,null,l))}p.push(f+s-o)}}(t,r,n,a,0),(s||l)(d,p,i)}class R{startParse(e,t,r){return"string"==typeof e&&(e=new D(e)),r=r?r.length?r.map((e=>new o(e.from,e.to))):[new o(0,0)]:[new o(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let e=n.advance();if(e)return e}}}class D{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new i({perNode:!0});class I{constructor(e,t,r,n,a,o,i,s,l,c=0,u){this.p=e,this.stack=t,this.state=r,this.reducePos=n,this.pos=a,this.score=o,this.buffer=i,this.bufferBase=s,this.curContext=l,this.lookAhead=c,this.parent=u}toString(){return`[${this.stack.filter(((e,t)=>t%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,r=0){let n=e.parser.context;return new I(e,[],t,r,r,0,[],0,n?new A(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let r=e>>19,n=65535&e,{parser:a}=this.p,o=a.dynamicPrecedence(n);if(o&&(this.score+=o),0==r)return this.pushState(a.getGoto(this.state,n,!0),this.reducePos),n<a.minRepeatTerm&&this.storeNode(n,this.reducePos,this.reducePos,4,!0),void this.reduceContext(n,this.reducePos);let i=this.stack.length-3*(r-1)-(262144&e?6:0),s=i?this.stack[i-2]:this.p.ranges[0].from,l=this.reducePos-s;l>=2e3&&!(null===(t=this.p.parser.nodeSet.types[n])||void 0===t?void 0:t.isAnonymous)&&(s==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=l):this.p.lastBigReductionSize<l&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=s,this.p.lastBigReductionSize=l));let c=i?this.stack[i-1]:0,u=this.bufferBase+this.buffer.length-c;if(n<a.minRepeatTerm||131072&e){let e=a.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(n,s,e,u+4,!0)}if(262144&e)this.state=this.stack[i];else{let e=this.stack[i-3];this.state=a.getGoto(e,n,!0)}for(;this.stack.length>i;)this.stack.pop();this.reduceContext(n,s)}storeNode(e,t,r,n=4,a=!1){if(0==e&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let e=this,n=this.buffer.length;if(0==n&&e.parent&&(n=e.bufferBase-e.parent.bufferBase,e=e.parent),n>0&&0==e.buffer[n-4]&&e.buffer[n-1]>-1){if(t==r)return;if(e.buffer[n-2]>=t)return void(e.buffer[n-2]=r)}}if(a&&this.pos!=r){let a=this.buffer.length;if(a>0&&0!=this.buffer[a-4])for(;a>0&&this.buffer[a-2]>r;)this.buffer[a]=this.buffer[a-4],this.buffer[a+1]=this.buffer[a-3],this.buffer[a+2]=this.buffer[a-2],this.buffer[a+3]=this.buffer[a-1],a-=4,n>4&&(n-=4);this.buffer[a]=e,this.buffer[a+1]=t,this.buffer[a+2]=r,this.buffer[a+3]=n}else this.buffer.push(e,t,r,n)}shift(e,t,r){let n=this.pos;if(131072&e)this.pushState(65535&e,this.pos);else if(0==(262144&e)){let a=e,{parser:o}=this.p;(r>this.pos||t<=o.maxNode)&&(this.pos=r,o.stateFlag(a,1)||(this.reducePos=r)),this.pushState(a,n),this.shiftContext(t,n),t<=o.maxNode&&this.buffer.push(t,n,r,4)}else this.pos=r,this.shiftContext(t,n),t<=this.p.parser.maxNode&&this.buffer.push(t,n,r,4)}apply(e,t,r){65536&e?this.reduce(e):this.shift(e,t,r)}useNode(e,t){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=e)&&(this.p.reused.push(e),r++);let n=this.pos;this.reducePos=this.pos=n+e.length,this.pushState(t,n),this.buffer.push(r,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let r=e.buffer.slice(t),n=e.bufferBase+t;for(;e&&n==e.bufferBase;)e=e.parent;return new I(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,n,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let r=e<=this.p.parser.maxNode;r&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,r?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new $(this);;){let r=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==r)return!1;if(0==(65536&r))return!0;t.reduce(r)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let r=[];for(let n,a=0;a<t.length;a+=2)(n=t[a+1])!=this.state&&this.p.parser.hasAction(n,e)&&r.push(t[a],n);if(this.stack.length<120)for(let e=0;r.length<8&&e<t.length;e+=2){let n=t[e+1];r.some(((e,t)=>1&t&&e==n))||r.push(t[e],n)}t=r}let r=[];for(let e=0;e<t.length&&r.length<4;e+=2){let n=t[e+1];if(n==this.state)continue;let a=this.split();a.pushState(n,this.pos),a.storeNode(0,a.pos,a.pos,4,!0),a.shiftContext(t[e],this.pos),a.score-=200,r.push(a)}return r}forceReduce(){let e=this.p.parser.stateSlot(this.state,5);if(0==(65536&e))return!1;let{parser:t}=this.p;if(!t.validAction(this.state,e)){let r=e>>19,n=65535&e,a=this.stack.length-3*r;if(a<0||t.getGoto(this.stack[a],n,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(e),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:e}=this.p;return 65535==e.data[e.stateSlot(this.state,1)]&&!e.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||-3!=this.buffer[e])&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||-4!=this.buffer[e])&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new A(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class A{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}var F;!function(e){e[e.Insert=200]="Insert",e[e.Delete=190]="Delete",e[e.Reduce=100]="Reduce",e[e.MaxNext=4]="MaxNext",e[e.MaxInsertStackDepth=300]="MaxInsertStackDepth",e[e.DampenInsertStackDepth=120]="DampenInsertStackDepth",e[e.MinBigReduction=2e3]="MinBigReduction"}(F||(F={}));class ${constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=65535&e,r=e>>19;0==r?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(r-1);let n=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=n}}class L{constructor(e,t,r){this.stack=e,this.pos=t,this.index=r,this.buffer=e.buffer,0==this.index&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new L(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;null!=e&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new L(this.stack,this.pos,this.index)}}function Q(e,t=Uint16Array){if("string"!=typeof e)return e;let r=null;for(let n=0,a=0;n<e.length;){let o=0;for(;;){let t=e.charCodeAt(n++),r=!1;if(126==t){o=65535;break}t>=92&&t--,t>=34&&t--;let a=t-32;if(a>=46&&(a-=46,r=!0),o+=a,r)break;o*=46}r?r[a++]=o:r=new t(o)}return r}class q{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const z=new q;class M{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=z,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let r=this.range,n=this.rangeIndex,a=this.pos+e;for(;a<r.from;){if(!n)return null;let e=this.ranges[--n];a-=r.from-e.to,r=e}for(;t<0?a>r.to:a>=r.to;){if(n==this.ranges.length-1)return null;let e=this.ranges[++n];a+=e.from-r.to,r=e}return a}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t,r,n=this.chunkOff+e;if(n>=0&&n<this.chunk.length)t=this.pos+e,r=this.chunk.charCodeAt(n);else{let n=this.resolveOffset(e,1);if(null==n)return-1;if(t=n,t>=this.chunk2Pos&&t<this.chunk2Pos+this.chunk2.length)r=this.chunk2.charCodeAt(t-this.chunk2Pos);else{let e=this.rangeIndex,n=this.range;for(;n.to<=t;)n=this.ranges[++e];this.chunk2=this.input.chunk(this.chunk2Pos=t),t+this.chunk2.length>n.to&&(this.chunk2=this.chunk2.slice(0,n.to-t)),r=this.chunk2.charCodeAt(0)}}return t>=this.token.lookAhead&&(this.token.lookAhead=t+1),r}acceptToken(e,t=0){let r=t?this.resolveOffset(t,-1):this.pos;if(null==r||r<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=r}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=z,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let r="";for(let n of this.ranges){if(n.from>=t)break;n.to>e&&(r+=this.input.read(Math.max(n.from,e),Math.min(n.to,t)))}return r}}class V{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:r}=t.p;B(this.data,e,t,this.id,r.data,r.tokenPrecTable)}}V.prototype.contextual=V.prototype.fallback=V.prototype.extend=!1;class U{constructor(e,t,r){this.precTable=t,this.elseToken=r,this.data="string"==typeof e?Q(e):e}token(e,t){let r,n=e.pos;for(;r=e.pos,B(this.data,e,t,0,this.data,this.precTable),!(e.token.value>-1);){if(null==this.elseToken)return;if(e.next<0)break;e.advance(),e.reset(r+1,e.token)}r>n&&(e.reset(n,e.token),e.acceptToken(this.elseToken,r-n))}}function B(e,t,r,n,a,o){let i=0,s=1<<n,{dialect:l}=r.p.parser;e:for(;0!=(s&e[i]);){let r=e[i+1];for(let n=i+3;n<r;n+=2)if((e[n+1]&s)>0){let r=e[n];if(l.allows(r)&&(-1==t.token.value||t.token.value==r||W(r,t.token.value,a,o))){t.acceptToken(r);break}}let n=t.next,c=0,u=e[i+2];if(!(t.next<0&&u>c&&65535==e[r+3*u-3]&&65535==e[r+3*u-3])){for(;c<u;){let a=c+u>>1,o=r+a+(a<<1),s=e[o],l=e[o+1]||65536;if(n<s)u=a;else{if(!(n>=l)){i=e[o+2],t.advance();continue e}c=a+1}}break}i=e[r+3*u-1]}}function G(e,t,r){for(let n,a=t;65535!=(n=e[a]);a++)if(n==r)return a-t;return-1}function W(e,t,r,n){let a=G(r,n,t);return a<0||G(r,n,e)<a}U.prototype.contextual=V.prototype.fallback=V.prototype.extend=!1;const X="undefined"!=typeof process&&process.env&&/\bparse\b/.test(process.env.LOG);let Y=null;var J,H;function K(e,t,r){let n=e.cursor(f.IncludeAnonymous);for(n.moveTo(t);;)if(!(r<0?n.childBefore(t):n.childAfter(t)))for(;;){if((r<0?n.to<t:n.from>t)&&!n.type.isError)return r<0?Math.max(0,Math.min(n.to-1,t-25)):Math.min(e.length,Math.max(n.from+1,t+25));if(r<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return r<0?0:e.length}}!function(e){e[e.Margin=25]="Margin"}(J||(J={}));class Z{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?K(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?K(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let r=this.trees[t],n=this.index[t];if(n==r.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let a=r.children[n],o=this.start[t]+r.positions[n];if(o>e)return this.nextStart=o,null;if(a instanceof h){if(o==e){if(o<this.safeFrom)return null;let e=o+a.length;if(e<=this.safeTo){let t=a.prop(i.lookAhead);if(!t||e+t<this.fragment.to)return a}}this.index[t]++,o+a.length>=Math.max(this.safeFrom,e)&&(this.trees.push(a),this.start.push(o),this.index.push(0))}else this.index[t]++,this.nextStart=o+a.length}}}class ee{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map((e=>new q))}getActions(e){let t=0,r=null,{parser:n}=e.p,{tokenizers:a}=n,o=n.stateSlot(e.state,3),i=e.curContext?e.curContext.hash:0,s=0;for(let n=0;n<a.length;n++){if(0==(1<<n&o))continue;let l=a[n],c=this.tokens[n];if((!r||l.fallback)&&((l.contextual||c.start!=e.pos||c.mask!=o||c.context!=i)&&(this.updateCachedToken(c,l,e),c.mask=o,c.context=i),c.lookAhead>c.end+25&&(s=Math.max(c.lookAhead,s)),0!=c.value)){let n=t;if(c.extended>-1&&(t=this.addActions(e,c.extended,c.end,t)),t=this.addActions(e,c.value,c.end,t),!l.extend&&(r=c,t>n))break}}for(;this.actions.length>t;)this.actions.pop();return s&&e.setLookAhead(s),r||e.pos!=this.stream.end||(r=new q,r.value=e.p.parser.eofTerm,r.start=r.end=e.pos,t=this.addActions(e,r.value,r.end,t)),this.mainToken=r,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new q,{pos:r,p:n}=e;return t.start=r,t.end=Math.min(r+1,n.stream.end),t.value=r==n.stream.end?n.parser.eofTerm:0,t}updateCachedToken(e,t,r){let n=this.stream.clipPos(r.pos);if(t.token(this.stream.reset(n,e),r),e.value>-1){let{parser:t}=r.p;for(let n=0;n<t.specialized.length;n++)if(t.specialized[n]==e.value){let a=t.specializers[n](this.stream.read(e.start,e.end),r);if(a>=0&&r.p.parser.dialect.allows(a>>1)){0==(1&a)?e.value=a>>1:e.extended=a>>1;break}}}else e.value=0,e.end=this.stream.clipPos(n+1)}putAction(e,t,r,n){for(let t=0;t<n;t+=3)if(this.actions[t]==e)return n;return this.actions[n++]=e,this.actions[n++]=t,this.actions[n++]=r,n}addActions(e,t,r,n){let{state:a}=e,{parser:o}=e.p,{data:i}=o;for(let e=0;e<2;e++)for(let s=o.stateSlot(a,e?2:1);;s+=3){if(65535==i[s]){if(1!=i[s+1]){0==n&&2==i[s+1]&&(n=this.putAction(oe(i,s+2),t,r,n));break}s=oe(i,s+2)}i[s]==t&&(n=this.putAction(oe(i,s+1),t,r,n))}return n}}!function(e){e[e.Distance=5]="Distance",e[e.MaxRemainingPerStep=3]="MaxRemainingPerStep",e[e.MinBufferLengthPrune=500]="MinBufferLengthPrune",e[e.ForceReduceLimit=10]="ForceReduceLimit",e[e.CutDepth=15e3]="CutDepth",e[e.CutTo=9e3]="CutTo",e[e.MaxLeftAssociativeReductionCount=300]="MaxLeftAssociativeReductionCount",e[e.MaxStackCount=12]="MaxStackCount"}(H||(H={}));class te{constructor(e,t,r,n){this.parser=e,this.input=t,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new M(t,n),this.tokens=new ee(e,this.stream),this.topTerm=e.top[1];let{from:a}=n[0];this.stacks=[I.start(this,e.top[0],a)],this.fragments=r.length&&this.stream.end-a>4*e.bufferLength?new Z(r,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e,t,r=this.stacks,n=this.minStackPos,a=this.stacks=[];if(this.bigReductionCount>300&&1==r.length){let[e]=r;for(;e.forceReduce()&&e.stack.length&&e.stack[e.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<r.length;o++){let i=r[o];for(;;){if(this.tokens.mainToken=null,i.pos>n)a.push(i);else{if(this.advanceStack(i,a,r))continue;{e||(e=[],t=[]),e.push(i);let r=this.tokens.getMainToken(i);t.push(r.value,r.end)}}break}}if(!a.length){let t=e&&function(e){let t=null;for(let r of e){let e=r.p.stoppedAt;(r.pos==r.p.stream.end||null!=e&&r.pos>e)&&r.p.parser.stateFlag(r.state,2)&&(!t||t.score<r.score)&&(t=r)}return t}(e);if(t)return this.stackToTree(t);if(this.parser.strict)throw X&&e&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+n);this.recovering||(this.recovering=5)}if(this.recovering&&e){let r=null!=this.stoppedAt&&e[0].pos>this.stoppedAt?e[0]:this.runRecovery(e,t,a);if(r)return this.stackToTree(r.forceAll())}if(this.recovering){let e=1==this.recovering?1:3*this.recovering;if(a.length>e)for(a.sort(((e,t)=>t.score-e.score));a.length>e;)a.pop();a.some((e=>e.reducePos>n))&&this.recovering--}else if(a.length>1){e:for(let e=0;e<a.length-1;e++){let t=a[e];for(let r=e+1;r<a.length;r++){let n=a[r];if(t.sameState(n)||t.buffer.length>500&&n.buffer.length>500){if(!((t.score-n.score||t.buffer.length-n.buffer.length)>0)){a.splice(e--,1);continue e}a.splice(r--,1)}}}a.length>12&&a.splice(12,a.length-12)}this.minStackPos=a[0].pos;for(let e=1;e<a.length;e++)a[e].pos<this.minStackPos&&(this.minStackPos=a[e].pos);return null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,r){let n=e.pos,{parser:a}=this,o=X?this.stackID(e)+" -> ":"";if(null!=this.stoppedAt&&n>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let t=e.curContext&&e.curContext.tracker.strict,r=t?e.curContext.hash:0;for(let s=this.fragments.nodeAt(n);s;){let n=this.parser.nodeSet.types[s.type.id]==s.type?a.getGoto(e.state,s.type.id):-1;if(n>-1&&s.length&&(!t||(s.prop(i.contextHash)||0)==r))return e.useNode(s,n),X&&console.log(o+this.stackID(e)+` (via reuse of ${a.getName(s.type.id)})`),!0;if(!(s instanceof h)||0==s.children.length||s.positions[0]>0)break;let l=s.children[0];if(!(l instanceof h&&0==s.positions[0]))break;s=l}}let s=a.stateSlot(e.state,4);if(s>0)return e.reduce(s),X&&console.log(o+this.stackID(e)+` (via always-reduce ${a.getName(65535&s)})`),!0;if(e.stack.length>=15e3)for(;e.stack.length>9e3&&e.forceReduce(););let l=this.tokens.getActions(e);for(let i=0;i<l.length;){let s=l[i++],c=l[i++],u=l[i++],d=i==l.length||!r,p=d?e:e.split();if(p.apply(s,c,u),X&&console.log(o+this.stackID(p)+` (via ${0==(65536&s)?"shift":`reduce of ${a.getName(65535&s)}`} for ${a.getName(c)} @ ${n}${p==e?"":", split"})`),d)return!0;p.pos>n?t.push(p):r.push(p)}return!1}advanceFully(e,t){let r=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>r)return re(e,t),!0}}runRecovery(e,t,r){let n=null,a=!1;for(let o=0;o<e.length;o++){let i=e[o],s=t[o<<1],l=t[1+(o<<1)],c=X?this.stackID(i)+" -> ":"";if(i.deadEnd){if(a)continue;if(a=!0,i.restart(),X&&console.log(c+this.stackID(i)+" (restarted)"),this.advanceFully(i,r))continue}let u=i.split(),d=c;for(let e=0;u.forceReduce()&&e<10&&(X&&console.log(d+this.stackID(u)+" (via force-reduce)"),!this.advanceFully(u,r));e++)X&&(d=this.stackID(u)+" -> ");for(let e of i.recoverByInsert(s))X&&console.log(c+this.stackID(e)+" (via recover-insert)"),this.advanceFully(e,r);this.stream.end>i.pos?(l==i.pos&&(l++,s=0),i.recoverByDelete(s,l),X&&console.log(c+this.stackID(i)+` (via recover-delete ${this.parser.getName(s)})`),re(i,r)):(!n||n.score<i.score)&&(n=i)}return n}stackToTree(e){return e.close(),h.build({buffer:L.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(Y||(Y=new WeakMap)).get(e);return t||Y.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function re(e,t){for(let r=0;r<t.length;r++){let n=t[r];if(n.pos==e.pos&&n.sameState(e))return void(t[r].score<e.score&&(t[r]=e))}t.push(e)}class ne{constructor(e,t,r){this.source=e,this.flags=t,this.disabled=r}allows(e){return!this.disabled||0==this.disabled[e]}}class ae extends R{constructor(e){if(super(),this.wrappers=[],14!=e.version)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let r=0;r<e.repeatNodeCount;r++)t.push("");let r=Object.keys(e.topRules).map((t=>e.topRules[t][1])),a=[];for(let e=0;e<t.length;e++)a.push([]);function o(e,t,r){a[e].push([t,t.deserialize(String(r))])}if(e.nodeProps)for(let t of e.nodeProps){let e=t[0];"string"==typeof e&&(e=i[e]);for(let r=1;r<t.length;){let n=t[r++];if(n>=0)o(n,e,t[r++]);else{let a=t[r+-n];for(let i=-n;i>0;i--)o(t[r++],e,a);r++}}}this.nodeSet=new u(t.map(((t,n)=>c.define({name:n>=this.minRepeatTerm?void 0:t,id:n,props:a[n],top:r.indexOf(n)>-1,error:0==n,skipped:e.skippedNodes&&e.skippedNodes.indexOf(n)>-1})))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=n;let s=Q(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let e=0;e<this.specializerSpecs.length;e++)this.specialized[e]=this.specializerSpecs[e].term;this.specializers=this.specializerSpecs.map(ie),this.states=Q(e.states,Uint32Array),this.data=Q(e.stateData),this.goto=Q(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map((e=>"number"==typeof e?new V(s,e):e)),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,r){let n=new te(this,e,t,r);for(let a of this.wrappers)n=a(n,e,t,r);return n}getGoto(e,t,r=!1){let n=this.goto;if(t>=n[0])return-1;for(let a=n[t+1];;){let t=n[a++],o=1&t,i=n[a++];if(o&&r)return i;for(let r=a+(t>>1);a<r;a++)if(n[a]==e)return i;if(o)return-1}}hasAction(e,t){let r=this.data;for(let n=0;n<2;n++)for(let a,o=this.stateSlot(e,n?2:1);;o+=3){if(65535==(a=r[o])){if(1!=r[o+1]){if(2==r[o+1])return oe(r,o+2);break}a=r[o=oe(r,o+2)]}if(a==t||0==a)return oe(r,o+1)}return 0}stateSlot(e,t){return this.states[6*e+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){if(t==this.stateSlot(e,4))return!0;for(let r=this.stateSlot(e,1);;r+=3){if(65535==this.data[r]){if(1!=this.data[r+1])return!1;r=oe(this.data,r+2)}if(t==oe(this.data,r+1))return!0}}nextStates(e){let t=[];for(let r=this.stateSlot(e,1);;r+=3){if(65535==this.data[r]){if(1!=this.data[r+1])break;r=oe(this.data,r+2)}if(0==(1&this.data[r+2])){let e=this.data[r+1];t.some(((t,r)=>1&r&&t==e))||t.push(this.data[r],e)}}return t}configure(e){let t=Object.assign(Object.create(ae.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let r=this.topRules[e.top];if(!r)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=r}return e.tokenizers&&(t.tokenizers=this.tokenizers.map((t=>{let r=e.tokenizers.find((e=>e.from==t));return r?r.to:t}))),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map(((r,n)=>{let a=e.specializers.find((e=>e.from==r.external));if(!a)return r;let o=Object.assign(Object.assign({},r),{external:a.to});return t.specializers[n]=ie(o),o}))),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),null!=e.strict&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),null!=e.bufferLength&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return null==t?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),r=t.map((()=>!1));if(e)for(let n of e.split(" ")){let e=t.indexOf(n);e>=0&&(r[e]=!0)}let n=null;for(let e=0;e<t.length;e++)if(!r[e])for(let r,a=this.dialects[t[e]];65535!=(r=this.data[a++]);)(n||(n=new Uint8Array(this.maxTerm+1)))[r]=1;return new ne(e,r,n)}static deserialize(e){return new ae(e)}}function oe(e,t){return e[t]|e[t+1]<<16}function ie(e){if(e.external){let t=e.extend?1:0;return(r,n)=>e.external(r,n)<<1|t}return e.get}},7480:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__addDisposableResource:()=>I,__assign:()=>o,__asyncDelegator:()=>x,__asyncGenerator:()=>T,__asyncValues:()=>P,__await:()=>E,__awaiter:()=>h,__classPrivateFieldGet:()=>_,__classPrivateFieldIn:()=>D,__classPrivateFieldSet:()=>R,__createBinding:()=>m,__decorate:()=>s,__disposeResources:()=>F,__esDecorate:()=>c,__exportStar:()=>v,__extends:()=>a,__generator:()=>g,__importDefault:()=>C,__importStar:()=>N,__makeTemplateObject:()=>k,__metadata:()=>f,__param:()=>l,__propKey:()=>d,__read:()=>b,__rest:()=>i,__runInitializers:()=>u,__setFunctionName:()=>p,__spread:()=>O,__spreadArray:()=>w,__spreadArrays:()=>S,__values:()=>y,default:()=>$});var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},o.apply(this,arguments)};function i(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}function s(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i}function l(e,t){return function(r,n){t(r,n,e)}}function c(e,t,r,n,a,o){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,l=n.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?n.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),p=!1,f=r.length-1;f>=0;f--){var h={};for(var g in n)h[g]="access"===g?{}:n[g];for(var g in n.access)h.access[g]=n.access[g];h.addInitializer=function(e){if(p)throw new TypeError("Cannot add initializers after decoration has completed");o.push(i(e||null))};var m=(0,r[f])("accessor"===l?{get:d.get,set:d.set}:d[c],h);if("accessor"===l){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(s=i(m.get))&&(d.get=s),(s=i(m.set))&&(d.set=s),(s=i(m.init))&&a.unshift(s)}else(s=i(m))&&("field"===l?a.unshift(s):d[c]=s)}u&&Object.defineProperty(u,n.name,d),p=!0}function u(e,t,r){for(var n=arguments.length>2,a=0;a<t.length;a++)r=n?t[a].call(e,r):t[a].call(e);return n?r:void 0}function d(e){return"symbol"==typeof e?e:"".concat(e)}function p(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function f(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}l((n=n.apply(e,t||[])).next())}))}function g(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var m=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function v(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||m(t,e,r)}function y(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i}function O(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}function S(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)n[a]=o[i];return n}function w(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function E(e){return this instanceof E?(this.v=e,this):new E(e)}function T(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),o=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){a[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=a[e](t)).value instanceof E?Promise.resolve(r.value.v).then(l,c):u(o[0][2],r)}catch(e){u(o[0][3],e)}var r}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function x(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,a){t[n]=e[n]?function(t){return(r=!r)?{value:E(e[n](t)),done:!1}:a?a(t):t}:a}}function P(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=y(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,a){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,a,(t=e[r](t)).done,t.value)}))}}}function k(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var j=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function N(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(t,e,r);return j(t,e),t}function C(e){return e&&e.__esModule?e:{default:e}}function _(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function R(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r}function D(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function I(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var n;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose]}if("function"!=typeof n)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var A="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function F(e){function t(t){e.error=e.hasError?new A(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function r(){for(;e.stack.length;){var n=e.stack.pop();try{var a=n.dispose&&n.dispose.call(n.value);if(n.async)return Promise.resolve(a).then(r,(function(e){return t(e),r()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}const $={__extends:a,__assign:o,__rest:i,__decorate:s,__param:l,__metadata:f,__awaiter:h,__generator:g,__createBinding:m,__exportStar:v,__values:y,__read:b,__spread:O,__spreadArrays:S,__spreadArray:w,__await:E,__asyncGenerator:T,__asyncDelegator:x,__asyncValues:P,__makeTemplateObject:k,__importStar:N,__importDefault:C,__classPrivateFieldGet:_,__classPrivateFieldSet:R,__classPrivateFieldIn:D,__addDisposableResource:I,__disposeResources:F}}},p={};function f(e){var t=p[e];if(void 0!==t)return t.exports;var r=p[e]={exports:{}};return d[e](r,r.exports,f),r.exports}f.m=d,f.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return f.d(t,{a:t}),t},f.d=(e,t)=>{for(var r in t)f.o(t,r)&&!f.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},f.f={},f.e=e=>Promise.all(Object.keys(f.f).reduce(((t,r)=>(f.f[r](e,t),t)),[])),f.u=e=>(144===e?"loki-query-field":e)+".js",f.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c={},u="@grafana-plugins/tempo:",f.l=(e,t,r,n)=>{if(c[e])c[e].push(t);else{var a,o;if(void 0!==r)for(var i=document.getElementsByTagName("script"),s=0;s<i.length;s++){var l=i[s];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==u+r){a=l;break}}a||(o=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,f.nc&&a.setAttribute("nonce",f.nc),a.setAttribute("data-webpack",u+r),a.src=e),c[e]=[t];var d=(t,r)=>{a.onerror=a.onload=null,clearTimeout(p);var n=c[e];if(delete c[e],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(r))),t)return t(r)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),o&&document.head.appendChild(a)}},f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.p="public/plugins/tempo/",(()=>{var e={224:0};f.f.j=(t,r)=>{var n=f.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var a=new Promise(((r,a)=>n=e[t]=[r,a]));r.push(n[2]=a);var o=f.p+f.u(t),i=new Error;f.l(o,(r=>{if(f.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",i.name="ChunkLoadError",i.type=a,i.request=o,n[1](i)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,a,[o,i,s]=r,l=0;if(o.some((t=>0!==e[t]))){for(n in i)f.o(i,n)&&(f.m[n]=i[n]);s&&s(f)}for(t&&t(r);l<o.length;l++)a=o[l],f.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=globalThis.webpackChunk_grafana_plugins_tempo=globalThis.webpackChunk_grafana_plugins_tempo||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var h={};return(()=>{"use strict";f.r(h),f.d(h,{plugin:()=>Jp});var e=f(3744),t=f(1622),r=f(9010),n=f.n(r),a=f(4568),o=f(7696),i=f(2532);function s(e){return t=e/1e3,Math.floor(t/60);var t}const l=n().lazy((()=>Promise.all([f.e(704),f.e(144)]).then(f.bind(f,1064)))),c=e=>n().createElement(r.Suspense,{fallback:null},n().createElement(l,e));function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const d=e=>{const t=(0,r.useRef)(null),{onRunQuery:a,onChange:o}=e,i=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,["onRunQuery","onChange"]);return n().createElement(c,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){u(e,t,r[t])}))}return e}({onRunQuery:e=>{t.current=e,o(e),a()},onBlur:e=>{o(e)},onChange:o},i))};function p(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class m extends n().PureComponent{componentDidMount(){var e=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){p(o,n,a,i,s,"next",e)}function s(e){p(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(){e._isMounted=!0,yield e.props.datasource.languageProvider.start(),e._isMounted&&e.setState({labelsLoaded:!0})}))()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e){const{range:t,datasource:{languageProvider:r}}=this.props,n=function(e,t){if(e&&t){const r=s(e.from.valueOf())===s(t.from.valueOf()),n=s(e.to.valueOf())===s(t.to.valueOf());return!(r&&n)}return!1}(t,e.range);n&&r.fetchLabels()}render(){const{ExtraFieldElement:e,query:t,datasource:r,history:a,onRunQuery:o}=this.props;var i;const s=null!==(i=this.props.placeholder)&&void 0!==i?i:"Enter a Loki query (run with Shift+Enter)";var l;return n().createElement(n().Fragment,null,n().createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},n().createElement("div",{className:"gf-form--grow flex-shrink-1 min-width-15"},n().createElement(d,{datasource:r,history:null!=a?a:[],onChange:this.onChangeQuery,onRunQuery:o,initialValue:null!==(l=t.expr)&&void 0!==l?l:"",placeholder:s}))),e)}constructor(e){super(e),g(this,"_isMounted",!1),g(this,"onChangeQuery",((e,t)=>{const{query:r,onChange:n,onRunQuery:a}=this.props;if(n){const s=(o=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){g(e,t,r[t])}))}return e}({},r),i=null!=(i={expr:e})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(i)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})),o);n(s),t&&a&&a()}var o,i})),this.state={labelsLoaded:!1}}}function v(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}const y=(e,t)=>`${t||"Error"}${e?` (${e})`:""}. Please check the server logs for more details.`;function b(e){return O.apply(this,arguments)}function O(){return O=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){v(o,n,a,i,s,"next",e)}function s(e){v(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(e){if(!e)return;const r=(0,t.getDataSourceSrv)();try{return yield r.get(e)}catch(e){return void console.error("Failed to load data source",e)}})),O.apply(this,arguments)}function S({logsDatasourceUid:e,onChange:t,onRunQuery:r,query:o}){const s=(0,i.c)((()=>b(e)),[e]);if(s.loading)return null;const l=s.value;var c;return l?n().createElement(n().Fragment,null,n().createElement(a.InlineLabel,null,"Tempo uses ",l.name," to find traces."),n().createElement(m,{datasource:l,onChange:t,onRunQuery:r,query:null!==(c=o.linkedQuery)&&void 0!==c?c:{refId:"linked"},history:[]})):e?e&&!l?n().createElement("div",{className:"text-warning"},"Loki search datasource is configured but the data source no longer exists. Please configure existing data source to use the search."):null:n().createElement("div",{className:"text-warning"},"Please set up a Loki search datasource in the datasource settings.")}function w(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function E(e){return!!e&&!!e[ce]}function T(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===ue}(e)||Array.isArray(e)||!!e[le]||!!(null===(t=e.constructor)||void 0===t?void 0:t[le])||C(e)||_(e))}function x(e,t,r){void 0===r&&(r=!1),0===P(e)?(r?Object.keys:de)(e).forEach((function(n){r&&"symbol"==typeof n||t(n,e[n],e)})):e.forEach((function(r,n){return t(n,r,e)}))}function P(e){var t=e[ce];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:C(e)?2:_(e)?3:0}function k(e,t){return 2===P(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function j(e,t,r){var n=P(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function N(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function C(e){return ae&&e instanceof Map}function _(e){return oe&&e instanceof Set}function R(e){return e.o||e.t}function D(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=pe(e);delete t[ce];for(var r=de(t),n=0;n<r.length;n++){var a=r[n],o=t[a];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[a]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function I(e,t){return void 0===t&&(t=!1),F(e)||E(e)||!T(e)||(P(e)>1&&(e.set=e.add=e.clear=e.delete=A),Object.freeze(e),t&&x(e,(function(e,t){return I(t,!0)}),!0)),e}function A(){w(2)}function F(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function $(e){var t=fe[e];return t||w(18,e),t}function L(){return re}function Q(e,t){t&&($("Patches"),e.u=[],e.s=[],e.v=t)}function q(e){z(e),e.p.forEach(V),e.p=null}function z(e){e===re&&(re=e.l)}function M(e){return re={p:[],l:re,h:e,m:!0,_:0}}function V(e){var t=e[ce];0===t.i||1===t.i?t.j():t.g=!0}function U(e,t){t._=t.p.length;var r=t.p[0],n=void 0!==e&&e!==r;return t.h.O||$("ES5").S(t,e,n),n?(r[ce].P&&(q(t),w(4)),T(e)&&(e=B(t,e),t.l||W(t,e)),t.u&&$("Patches").M(r[ce].t,e,t.u,t.s)):e=B(t,r,[]),q(t),t.u&&t.v(t.u,t.s),e!==se?e:void 0}function B(e,t,r){if(F(t))return t;var n=t[ce];if(!n)return x(t,(function(a,o){return G(e,n,t,a,o,r)}),!0),t;if(n.A!==e)return t;if(!n.P)return W(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=4===n.i||5===n.i?n.o=D(n.k):n.o,o=a,i=!1;3===n.i&&(o=new Set(a),a.clear(),i=!0),x(o,(function(t,o){return G(e,n,a,t,o,r,i)})),W(e,a,!1),r&&e.u&&$("Patches").N(n,r,e.u,e.s)}return n.o}function G(e,t,r,n,a,o,i){if(E(a)){var s=B(e,a,o&&t&&3!==t.i&&!k(t.R,n)?o.concat(n):void 0);if(j(r,n,s),!E(s))return;e.m=!1}else i&&r.add(a);if(T(a)&&!F(a)){if(!e.h.D&&e._<1)return;B(e,a),t&&t.A.l||W(e,a)}}function W(e,t,r){void 0===r&&(r=!1),!e.l&&e.h.D&&e.m&&I(t,r)}function X(e,t){var r=e[ce];return(r?R(r):e)[t]}function Y(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function J(e){e.P||(e.P=!0,e.l&&J(e.l))}function H(e){e.o||(e.o=D(e.t))}function K(e,t,r){var n=C(t)?$("MapSet").F(t,r):_(t)?$("MapSet").T(t,r):e.O?function(e,t){var r=Array.isArray(e),n={i:r?1:0,A:t?t.A:L(),P:!1,I:!1,R:{},l:t,t:e,k:null,o:null,j:null,C:!1},a=n,o=he;r&&(a=[n],o=ge);var i=Proxy.revocable(a,o),s=i.revoke,l=i.proxy;return n.k=l,n.j=s,l}(t,r):$("ES5").J(t,r);return(r?r.A:L()).p.push(n),n}function Z(e){return E(e)||w(22,e),function e(t){if(!T(t))return t;var r,n=t[ce],a=P(t);if(n){if(!n.P&&(n.i<4||!$("ES5").K(n)))return n.t;n.I=!0,r=ee(t,a),n.I=!1}else r=ee(t,a);return x(r,(function(t,a){n&&function(e,t){return 2===P(e)?e.get(t):e[t]}(n.t,t)===a||j(r,t,e(a))})),3===a?new Set(r):r}(e)}function ee(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return D(e)}var te,re,ne="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),ae="undefined"!=typeof Map,oe="undefined"!=typeof Set,ie="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,se=ne?Symbol.for("immer-nothing"):((te={})["immer-nothing"]=!0,te),le=ne?Symbol.for("immer-draftable"):"__$immer_draftable",ce=ne?Symbol.for("immer-state"):"__$immer_state",ue=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),de="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,pe=Object.getOwnPropertyDescriptors||function(e){var t={};return de(e).forEach((function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)})),t},fe={},he={get:function(e,t){if(t===ce)return e;var r=R(e);if(!k(r,t))return function(e,t,r){var n,a=Y(t,r);return a?"value"in a?a.value:null===(n=a.get)||void 0===n?void 0:n.call(e.k):void 0}(e,r,t);var n=r[t];return e.I||!T(n)?n:n===X(e.t,t)?(H(e),e.o[t]=K(e.A.h,n,e)):n},has:function(e,t){return t in R(e)},ownKeys:function(e){return Reflect.ownKeys(R(e))},set:function(e,t,r){var n=Y(R(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var a=X(R(e),t),o=null==a?void 0:a[ce];if(o&&o.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(N(r,a)&&(void 0!==r||k(e.t,t)))return!0;H(e),J(e)}return e.o[t]===r&&(void 0!==r||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==X(e.t,t)||t in e.t?(e.R[t]=!1,H(e),J(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=R(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty:function(){w(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){w(12)}},ge={};x(he,(function(e,t){ge[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),ge.deleteProperty=function(e,t){return ge.set.call(this,e,t,void 0)},ge.set=function(e,t,r){return he.set.call(this,e[0],t,r,e[0])};var me=function(){function e(e){var t=this;this.O=ie,this.D=!0,this.produce=function(e,r,n){if("function"==typeof e&&"function"!=typeof r){var a=r;r=e;var o=t;return function(e){var t=this;void 0===e&&(e=a);for(var n=arguments.length,i=Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return o.produce(e,(function(e){var n;return(n=r).call.apply(n,[t,e].concat(i))}))}}var i;if("function"!=typeof r&&w(6),void 0!==n&&"function"!=typeof n&&w(7),T(e)){var s=M(t),l=K(t,e,void 0),c=!0;try{i=r(l),c=!1}finally{c?q(s):z(s)}return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return Q(s,n),U(e,s)}),(function(e){throw q(s),e})):(Q(s,n),U(i,s))}if(!e||"object"!=typeof e){if(void 0===(i=r(e))&&(i=e),i===se&&(i=void 0),t.D&&I(i,!0),n){var u=[],d=[];$("Patches").M(e,i,u,d),n(u,d)}return i}w(21,e)},this.produceWithPatches=function(e,r){if("function"==typeof e)return function(r){for(var n=arguments.length,a=Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return t.produceWithPatches(r,(function(t){return e.apply(void 0,[t].concat(a))}))};var n,a,o=t.produce(e,r,(function(e,t){n=e,a=t}));return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(e){return[e,n,a]})):[o,n,a]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){T(e)||w(8),E(e)&&(e=Z(e));var t=M(this),r=K(this,e,void 0);return r[ce].C=!0,z(t),r},t.finishDraft=function(e,t){var r=(e&&e[ce]).A;return Q(r,t),U(void 0,r)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!ie&&w(20),this.O=e},t.applyPatches=function(e,t){var r;for(r=t.length-1;r>=0;r--){var n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}r>-1&&(t=t.slice(r+1));var a=$("Patches").$;return E(e)?a(e,t):this.produce(e,(function(e){return a(e,t)}))},e}(),ve=new me,ye=ve.produce;ve.produceWithPatches.bind(ve),ve.setAutoFreeze.bind(ve),ve.setUseProxies.bind(ve),ve.applyPatches.bind(ve),ve.createDraft.bind(ve),ve.finishDraft.bind(ve);const be=ye;f(6600);var Oe,Se=(Oe=function(e,t){return Oe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Oe(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Oe(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),we=function(e,t){for(var r=0,n=t.length,a=e.length;r<n;r++,a++)e[a]=t[r];return e},Ee=Object.defineProperty,Te=Object.defineProperties,xe=Object.getOwnPropertyDescriptors,Pe=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable,Ne=function(e,t,r){return t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Ce=function(e,t){for(var r in t||(t={}))ke.call(t,r)&&Ne(e,r,t[r]);if(Pe)for(var n=0,a=Pe(t);n<a.length;n++)r=a[n],je.call(t,r)&&Ne(e,r,t[r]);return e},_e=function(e,t){return Te(e,xe(t))};function Re(e){return T(e)?be(e,(function(){})):e}function De(e,t){function r(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t){var a=t.apply(void 0,r);if(!a)throw new Error("prepareAction did not return an object");return Ce(Ce({type:e,payload:a.payload},"meta"in a&&{meta:a.meta}),"error"in a&&{error:a.error})}return{type:e,payload:r[0]}}return r.toString=function(){return""+e},r.type=e,r.match=function(t){return t.type===e},r}function Ie(e){var t,r={},n=[],a={addCase:function(e,t){var n="string"==typeof e?e:e.type;if(n in r)throw new Error("addCase cannot be called with two reducers for the same action type");return r[n]=t,a},addMatcher:function(e,t){return n.push({matcher:e,reducer:t}),a},addDefaultCase:function(e){return t=e,a}};return e(a),[r,n,t]}"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__,"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__,function(e){function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=e.apply(this,r)||this;return Object.setPrototypeOf(a,t.prototype),a}Se(t,e),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.prototype.concat.apply(this,t)},t.prototype.prepend=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 1===e.length&&Array.isArray(e[0])?new(t.bind.apply(t,we([void 0],e[0].concat(this)))):new(t.bind.apply(t,we([void 0],e.concat(this))))}}(Array),function(e){function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=e.apply(this,r)||this;return Object.setPrototypeOf(a,t.prototype),a}Se(t,e),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.prototype.concat.apply(this,t)},t.prototype.prepend=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 1===e.length&&Array.isArray(e[0])?new(t.bind.apply(t,we([void 0],e[0].concat(this)))):new(t.bind.apply(t,we([void 0],e.concat(this))))}}(Array);var Ae=["name","message","stack","code"],Fe=function(e,t){this.payload=e,this.meta=t},$e=function(e,t){this.payload=e,this.meta=t},Le=function(e){if("object"==typeof e&&null!==e){for(var t={},r=0,n=Ae;r<n.length;r++){var a=n[r];"string"==typeof e[a]&&(t[a]=e[a])}return t}return{message:String(e)}};function Qe(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}!function(){function e(e,t,r){var n=De(e+"/fulfilled",(function(e,t,r,n){return{payload:e,meta:_e(Ce({},n||{}),{arg:r,requestId:t,requestStatus:"fulfilled"})}})),a=De(e+"/pending",(function(e,t,r){return{payload:void 0,meta:_e(Ce({},r||{}),{arg:t,requestId:e,requestStatus:"pending"})}})),o=De(e+"/rejected",(function(e,t,n,a,o){return{payload:a,error:(r&&r.serializeError||Le)(e||"Rejected"),meta:_e(Ce({},o||{}),{arg:n,requestId:t,rejectedWithValue:!!a,requestStatus:"rejected",aborted:"AbortError"===(null==e?void 0:e.name),condition:"ConditionError"===(null==e?void 0:e.name)})}})),i="undefined"!=typeof AbortController?AbortController:function(){function e(){this.signal={aborted:!1,addEventListener:function(){},dispatchEvent:function(){return!1},onabort:function(){},removeEventListener:function(){},reason:void 0,throwIfAborted:function(){}}}return e.prototype.abort=function(){},e}();return Object.assign((function(e){return function(s,l,c){var u,d=(null==r?void 0:r.idGenerator)?r.idGenerator(e):function(e){void 0===e&&(e=21);for(var t="",r=e;r--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t}(),p=new i;function f(e){u=e,p.abort()}var h=function(){return i=this,h=null,g=function(){var i,h,g,m,v,y;return function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(b){switch(b.label){case 0:return b.trys.push([0,4,,5]),null===(O=m=null==(i=null==r?void 0:r.condition)?void 0:i.call(r,e,{getState:l,extra:c}))||"object"!=typeof O||"function"!=typeof O.then?[3,2]:[4,m];case 1:m=b.sent(),b.label=2;case 2:if(!1===m||p.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};return v=new Promise((function(e,t){return p.signal.addEventListener("abort",(function(){return t({name:"AbortError",message:u||"Aborted"})}))})),s(a(d,e,null==(h=null==r?void 0:r.getPendingMeta)?void 0:h.call(r,{requestId:d,arg:e},{getState:l,extra:c}))),[4,Promise.race([v,Promise.resolve(t(e,{dispatch:s,getState:l,extra:c,requestId:d,signal:p.signal,abort:f,rejectWithValue:function(e,t){return new Fe(e,t)},fulfillWithValue:function(e,t){return new $e(e,t)}})).then((function(t){if(t instanceof Fe)throw t;return t instanceof $e?n(t.payload,d,e,t.meta):n(t,d,e)}))])];case 3:return g=b.sent(),[3,5];case 4:return y=b.sent(),g=y instanceof Fe?o(null,d,e,y.payload,y.meta):o(y,d,e),[3,5];case 5:return r&&!r.dispatchConditionRejection&&o.match(g)&&g.meta.condition||s(g),[2,g]}var O}))},new Promise((function(e,t){var r=function(e){try{a(g.next(e))}catch(e){t(e)}},n=function(e){try{a(g.throw(e))}catch(e){t(e)}},a=function(t){return t.done?e(t.value):Promise.resolve(t.value).then(r,n)};a((g=g.apply(i,h)).next())}));var i,h,g}();return Object.assign(h,{abort:f,requestId:d,arg:e,unwrap:function(){return h.then(Qe)}})}}),{pending:a,rejected:o,fulfilled:n,typePrefix:e})}e.withTypes=function(){return e}}(),Object.assign;var qe="listenerMiddleware";De(qe+"/add"),De(qe+"/removeAll"),De(qe+"/remove"),"function"==typeof queueMicrotask&&queueMicrotask.bind("undefined"!=typeof window?window:void 0!==f.g?f.g:globalThis);"undefined"!=typeof window&&window.requestAnimationFrame&&window.requestAnimationFrame,function(){function e(e,t){var r=a[e];return r?r.enumerable=t:a[e]=r={configurable:!0,enumerable:t,get:function(){var t=this[ce];return he.get(t,e)},set:function(t){var r=this[ce];he.set(r,e,t)}},r}function t(e){for(var t=e.length-1;t>=0;t--){var a=e[t][ce];if(!a.P)switch(a.i){case 5:n(a)&&J(a);break;case 4:r(a)&&J(a)}}}function r(e){for(var t=e.t,r=e.k,n=de(r),a=n.length-1;a>=0;a--){var o=n[a];if(o!==ce){var i=t[o];if(void 0===i&&!k(t,o))return!0;var s=r[o],l=s&&s[ce];if(l?l.t!==i:!N(s,i))return!0}}var c=!!t[ce];return n.length!==de(t).length+(c?0:1)}function n(e){var t=e.k;if(t.length!==e.t.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);if(r&&!r.get)return!0;for(var n=0;n<t.length;n++)if(!t.hasOwnProperty(n))return!0;return!1}var a={};!function(e,t){fe[e]||(fe[e]=t)}("ES5",{J:function(t,r){var n=Array.isArray(t),a=function(t,r){if(t){for(var n=Array(r.length),a=0;a<r.length;a++)Object.defineProperty(n,""+a,e(a,!0));return n}var o=pe(r);delete o[ce];for(var i=de(o),s=0;s<i.length;s++){var l=i[s];o[l]=e(l,t||!!o[l].enumerable)}return Object.create(Object.getPrototypeOf(r),o)}(n,t),o={i:n?5:4,A:r?r.A:L(),P:!1,I:!1,R:{},l:r,t,k:a,o:null,g:!1,C:!1};return Object.defineProperty(a,ce,{value:o,writable:!0}),a},S:function(e,r,a){a?E(r)&&r[ce].A===e&&t(e.p):(e.u&&function e(t){if(t&&"object"==typeof t){var r=t[ce];if(r){var a=r.t,o=r.k,i=r.R,s=r.i;if(4===s)x(o,(function(t){t!==ce&&(void 0!==a[t]||k(a,t)?i[t]||e(o[t]):(i[t]=!0,J(r)))})),x(a,(function(e){void 0!==o[e]||k(o,e)||(i[e]=!1,J(r))}));else if(5===s){if(n(r)&&(J(r),i.length=!0),o.length<a.length)for(var l=o.length;l<a.length;l++)i[l]=!1;else for(var c=a.length;c<o.length;c++)i[c]=!0;for(var u=Math.min(o.length,a.length),d=0;d<u;d++)o.hasOwnProperty(d)||(i[d]=!0),void 0===i[d]&&e(o[d])}}}}(e.p[0]),t(e.p))},K:function(e){return 4===e.i?r(e):n(e)}})}();var ze="NOT_FOUND",Me=function(e,t){return e===t};function Ve(e,t){var r,n,a="object"==typeof t?t:{equalityCheck:t},o=a.equalityCheck,i=void 0===o?Me:o,s=a.maxSize,l=void 0===s?1:s,c=a.resultEqualityCheck,u=function(e){return function(t,r){if(null===t||null===r||t.length!==r.length)return!1;for(var n=t.length,a=0;a<n;a++)if(!e(t[a],r[a]))return!1;return!0}}(i),d=1===l?(r=u,{get:function(e){return n&&r(n.key,e)?n.value:ze},put:function(e,t){n={key:e,value:t}},getEntries:function(){return n?[n]:[]},clear:function(){n=void 0}}):function(e,t){var r=[];function n(e){var n=r.findIndex((function(r){return t(e,r.key)}));if(n>-1){var a=r[n];return n>0&&(r.splice(n,1),r.unshift(a)),a.value}return ze}return{get:n,put:function(t,a){n(t)===ze&&(r.unshift({key:t,value:a}),r.length>e&&r.pop())},getEntries:function(){return r},clear:function(){r=[]}}}(l,u);function p(){var t=d.get(arguments);if(t===ze){if(t=e.apply(null,arguments),c){var r=d.getEntries().find((function(e){return c(e.value,t)}));r&&(t=r.value)}d.put(arguments,t)}return t}return p.clearCache=function(){return d.clear()},p}function Ue(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var o,i=0,s={memoizeOptions:void 0},l=n.pop();if("object"==typeof l&&(s=l,l=n.pop()),"function"!=typeof l)throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof l+"]");var c=s.memoizeOptions,u=void 0===c?r:c,d=Array.isArray(u)?u:[u],p=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var r=t.map((function(e){return"function"==typeof e?"function "+(e.name||"unnamed")+"()":typeof e})).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+r+"]")}return t}(n),f=e.apply(void 0,[function(){return i++,l.apply(null,arguments)}].concat(d)),h=e((function(){for(var e=[],t=p.length,r=0;r<t;r++)e.push(p[r].apply(null,arguments));return o=f.apply(null,e)}));return Object.assign(h,{resultFunc:l,memoizedResultFunc:f,dependencies:p,lastResult:function(){return o},recomputations:function(){return i},resetRecomputations:function(){return i=0}}),h}}var Be,Ge,We=Ue(Ve);!function(e){e.Success="success",e.Warning="warning",e.Error="error",e.Info="info"}(Be||(Be={})),function(e){e[e.Success=3e3]="Success",e[e.Warning=5e3]="Warning",e[e.Error=7e3]="Error"}(Ge||(Ge={}));const Xe="notifications",Ye=`${Xe}/lastRead`;var Je;const He={byId:function(){const e=window.localStorage.getItem(Xe);if(!e)return{};const t=JSON.parse(e);return Object.values(t).every((e=>{return"object"==typeof(t=e)&&null!==t&&"id"in t&&"icon"in t&&"title"in t&&"text"in t;var t}))?t:{}}(),lastRead:Number.parseInt(null!==(Je=window.localStorage.getItem(Ye))&&void 0!==Je?Je:`${Date.now()}`,10)},Ke=function(e){var t=e.name;if(!t)throw new Error("`name` is a required option for createSlice");var r,n="function"==typeof e.initialState?e.initialState:Re(e.initialState),a=e.reducers||{},o=Object.keys(a),i={},s={},l={};function c(){var t="function"==typeof e.extraReducers?Ie(e.extraReducers):[e.extraReducers],r=t[0],a=void 0===r?{}:r,o=t[1],i=void 0===o?[]:o,l=t[2],c=void 0===l?void 0:l,u=Ce(Ce({},a),s);return function(e,t,r,n){void 0===r&&(r=[]);var a,o=Ie(t),i=o[0],s=o[1],l=o[2];if(function(e){return"function"==typeof e}(e))a=function(){return Re(e())};else{var c=Re(e);a=function(){return c}}function u(e,t){void 0===e&&(e=a());var r=we([i[t.type]],s.filter((function(e){return(0,e.matcher)(t)})).map((function(e){return e.reducer})));return 0===r.filter((function(e){return!!e})).length&&(r=[l]),r.reduce((function(e,r){if(r){var n;if(E(e))return void 0===(n=r(e,t))?e:n;if(T(e))return be(e,(function(e){return r(e,t)}));if(void 0===(n=r(e,t))){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return n}return e}),e)}return u.getInitialState=a,u}(n,(function(e){for(var t in u)e.addCase(t,u[t]);for(var r=0,n=i;r<n.length;r++){var a=n[r];e.addMatcher(a.matcher,a.reducer)}c&&e.addDefaultCase(c)}))}return o.forEach((function(e){var r,n,o=a[e],c=t+"/"+e;"reducer"in o?(r=o.reducer,n=o.prepare):r=o,i[e]=r,s[c]=r,l[e]=n?De(c,n):De(c)})),{name:t,reducer:function(e,t){return r||(r=c()),r(e,t)},actions:l,caseReducers:i,getInitialState:function(){return r||(r=c()),r.getInitialState()}}}({name:"appNotifications",initialState:He,reducers:{notifyApp:(e,{payload:t})=>{Object.values(e.byId).some((e=>function(e,t){return e.icon===t.icon&&e.severity===t.severity&&e.text===t.text&&e.title===t.title}(t,e)&&e.showing))||(e.byId[t.id]=t,st(e.byId))},hideAppNotification:(e,{payload:t})=>{t in e.byId&&(e.byId[t].showing=!1,st(e.byId))},clearNotification:(e,{payload:t})=>{delete e.byId[t],st(e.byId)},clearAllNotifications:e=>{e.byId={},st(e.byId)},readAllNotifications:(e,{payload:t})=>{e.lastRead=t}}}),{notifyApp:Ze,hideAppNotification:et,clearNotification:tt,clearAllNotifications:rt,readAllNotifications:nt}=Ke.actions,at=(Ke.reducer,e=>e.byId),ot=We(at,(e=>Object.values(e).sort(((e,t)=>t.timestamp-e.timestamp))));function it(e){return e.severity===Be.Warning||e.severity===Be.Error}function st(e){const t=Object.values(e).filter(it).sort(((e,t)=>t.timestamp-e.timestamp)).slice(0,25).reduce(((e,t)=>(e[t.id]={id:t.id,severity:t.severity,icon:t.icon,title:t.title,text:t.text,traceId:t.traceId,timestamp:t.timestamp,showing:!1},e)),{});try{window.localStorage.setItem(Xe,JSON.stringify(t))}catch(e){console.error("Unable to persist notifications to local storage"),console.error(e)}}We(ot,(e=>e.filter(it))),We(at,(e=>Object.values(e).filter((e=>e.showing))));var lt=f(6104);function ct(e){if("string"==typeof e)return e;if(e){if(e instanceof Error)return e.message;if((0,t.isFetchError)(e)){if(e.data&&e.data.message)return e.data.message;if(e.statusText)return e.statusText}}return JSON.stringify(e)}function ut(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Be.Success;const dt={title:"",text:"",severity:Be.Error,icon:"exclamation-triangle"},pt=(e,t="",r,n)=>{return a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ut(e,t,r[t])}))}return e}({},dt),o=null!=(o={text:ct(t),title:e,id:(0,lt.c)(),traceId:r,component:n,timestamp:Date.now(),showing:!0})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(o)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(o,e))})),a;var a,o};let ft;function ht(e){if(ft&&ft.getState)return ft.dispatch(e)}var gt=f(1928),mt=f(9464);function vt(e){return"function"==typeof e}function yt(e){return function(t){if(function(e){return vt(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var bt,Ot,St=f(7480),wt=(bt=function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}},Ot=bt((function(e){Error.call(e),e.stack=(new Error).stack})),Ot.prototype=Object.create(Error.prototype),Ot.prototype.constructor=Ot,Ot);function Et(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Tt=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,a;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var i=(0,St.__values)(o),s=i.next();!s.done;s=i.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(vt(l))try{l()}catch(e){a=e instanceof wt?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=(0,St.__values)(c),d=u.next();!d.done;d=u.next()){var p=d.value;try{Pt(p)}catch(e){a=null!=a?a:[],e instanceof wt?a=(0,St.__spreadArray)((0,St.__spreadArray)([],(0,St.__read)(a)),(0,St.__read)(e.errors)):a.push(e)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(a)throw new wt(a)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Pt(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Et(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&Et(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function xt(e){return e instanceof Tt||e&&"closed"in e&&vt(e.remove)&&vt(e.add)&&vt(e.unsubscribe)}function Pt(e){vt(e)?e():e.unsubscribe()}Tt.EMPTY;var kt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},jt={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=jt.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,(0,St.__spreadArray)([e,t],(0,St.__read)(r))):setTimeout.apply(void 0,(0,St.__spreadArray)([e,t],(0,St.__read)(r)))},clearTimeout:function(e){var t=jt.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Nt(e){jt.setTimeout((function(){var t=kt.onUnhandledError;if(!t)throw e;t(e)}))}function Ct(){}var _t=Rt("C",void 0,void 0);function Rt(e,t,r){return{kind:e,value:t,error:r}}var Dt=null,It=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,xt(t)&&t.add(r)):r.destination=zt,r}return(0,St.__extends)(t,e),t.create=function(e,t,r){return new Lt(e,t,r)},t.prototype.next=function(e){this.isStopped?qt(function(e){return Rt("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?qt(Rt("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?qt(_t,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Tt),At=Function.prototype.bind;function Ft(e,t){return At.call(e,t)}var $t=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Qt(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Qt(e)}else Qt(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Qt(e)}},e}(),Lt=function(e){function t(t,r,n){var a,o,i=e.call(this)||this;return vt(t)||!t?a={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:i&&kt.useDeprecatedNextContext?((o=Object.create(t)).unsubscribe=function(){return i.unsubscribe()},a={next:t.next&&Ft(t.next,o),error:t.error&&Ft(t.error,o),complete:t.complete&&Ft(t.complete,o)}):a=t,i.destination=new $t(a),i}return(0,St.__extends)(t,e),t}(It);function Qt(e){var t;kt.useDeprecatedSynchronousErrorHandling?(t=e,kt.useDeprecatedSynchronousErrorHandling&&Dt&&(Dt.errorThrown=!0,Dt.error=t)):Nt(e)}function qt(e,t){var r=kt.onStoppedNotification;r&&jt.setTimeout((function(){return r(e,t)}))}var zt={closed:!0,next:Ct,error:function(e){throw e},complete:Ct};function Mt(e,t,r,n,a){return new Vt(e,t,r,n,a)}var Vt=function(e){function t(t,r,n,a,o,i){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=i,s._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return(0,St.__extends)(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(It);function Ut(e,t){return yt((function(r,n){var a=0;r.subscribe(Mt(n,(function(r){n.next(e.call(t,r,a++))})))}))}var Bt=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},Gt="function"==typeof Symbol&&Symbol.observable||"@@observable";function Wt(e){return e}var Xt=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,a=this,o=(n=e)&&n instanceof It||function(e){return e&&vt(e.next)&&vt(e.error)&&vt(e.complete)}(n)&&xt(n)?e:new Lt(e,t,r);return function(e){if(kt.useDeprecatedSynchronousErrorHandling){var t=!Dt;if(t&&(Dt={errorThrown:!1,error:null}),e(),t){var r=Dt,n=r.errorThrown,a=r.error;if(Dt=null,n)throw a}}else e()}((function(){var e=a,t=e.operator,r=e.source;o.add(t?t.call(o,r):r?a._subscribe(o):a._trySubscribe(o))})),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Yt(t))((function(t,n){var a=new Lt({next:function(t){try{e(t)}catch(e){n(e),a.unsubscribe()}},error:n,complete:t});r.subscribe(a)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Gt]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?Wt:1===r.length?r[0]:function(e){return r.reduce((function(e,t){return t(e)}),e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=Yt(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function Yt(e){var t;return null!==(t=null!=e?e:kt.Promise)&&void 0!==t?t:Promise}var Jt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Ht(e){if(e instanceof Xt)return e;if(null!=e){if(function(e){return vt(e[Gt])}(e))return a=e,new Xt((function(e){var t=a[Gt]();if(vt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Bt(e))return n=e,new Xt((function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()}));if(vt(null==(r=e)?void 0:r.then))return function(e){return new Xt((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Nt)}))}(e);if(function(e){return Symbol.asyncIterator&&vt(null==e?void 0:e[Symbol.asyncIterator])}(e))return Kt(e);if(function(e){return vt(null==e?void 0:e[Jt])}(e))return t=e,new Xt((function(e){var r,n;try{for(var a=(0,St.__values)(t),o=a.next();!o.done;o=a.next()){var i=o.value;if(e.next(i),e.closed)return}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}e.complete()}));if(function(e){return vt(null==e?void 0:e.getReader)}(e))return Kt(function(e){return(0,St.__asyncGenerator)(this,arguments,(function(){var t,r,n;return(0,St.__generator)(this,(function(a){switch(a.label){case 0:t=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,(0,St.__await)(t.read())];case 3:return r=a.sent(),n=r.value,r.done?[4,(0,St.__await)(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,(0,St.__await)(n)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,r,n,a;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function Kt(e){return new Xt((function(t){(function(e,t){var r,n,a,o;return(0,St.__awaiter)(this,void 0,void 0,(function(){var i,s;return(0,St.__generator)(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=(0,St.__asyncValues)(e),l.label=1;case 1:return[4,r.next()];case 2:if((n=l.sent()).done)return[3,4];if(i=n.value,t.next(i),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=l.sent(),a={error:s},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Zt(e,t,r){return void 0===r&&(r=1/0),vt(t)?Zt((function(r,n){return Ut((function(e,a){return t(r,e,n,a)}))(Ht(e(r,n)))}),r):("number"==typeof t&&(r=t),yt((function(t,n){return function(e,t,r,n,a,o,i,s){var l=[],c=0,u=0,d=!1,p=function(){!d||l.length||c||t.complete()},f=function(e){return c<n?h(e):l.push(e)},h=function(e){c++;var a=!1;Ht(r(e,u++)).subscribe(Mt(t,(function(e){t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{c--;for(var e=function(){var e=l.shift();h(e)};l.length&&c<n;)e();p()}catch(e){t.error(e)}})))};return e.subscribe(Mt(t,f,(function(){d=!0,p()}))),function(){}}(t,n,e,r)})))}function er(e){return yt((function(t,r){var n,a=null,o=!1;a=t.subscribe(Mt(r,void 0,void 0,(function(i){n=Ht(e(i,er(e)(t))),a?(a.unsubscribe(),a=null,n.subscribe(r)):o=!0}))),o&&(a.unsubscribe(),a=null,n.subscribe(r))}))}function tr(e,t){return vt(t)?Zt(e,t,1):Zt(e,1)}var rr=function(e,t){return e.push(t),e};function nr(){return yt((function(e,t){(function(e,t){return yt(function(e,t,r,n,a){return function(n,a){var o=r,i=t,s=0;n.subscribe(Mt(a,(function(t){var r=s++;i=o?e(i,t,r):(o=!0,t)}),(function(){o&&a.next(i),a.complete()})))}}(e,t,arguments.length>=2))})(rr,[])(e).subscribe(t)}))}var ar,or,ir,sr,lr,cr,ur,dr,pr,fr,hr,gr,mr,vr,yr,br,Or,Sr,wr,Er,Tr,xr,Pr,kr,jr,Nr,Cr,_r,Rr,Dr,Ir,Ar,Fr,$r,Lr,Qr,qr,zr,Mr,Vr,Ur,Br,Gr,Wr=f(1148),Xr=f.n(Wr);!function(e){e.AlertStates="alertStates",e.Annotations="annotations",e.Series="series"}(ar||(ar={})),function(e){e.Linear="linear",e.Quad="quad"}(or||(or={})),function(e){e.Clamped="clamped",e.Mod="mod"}(ir||(ir={})),function(e){e.Field="field",e.Fixed="fixed",e.Template="template"}(sr||(sr={})),function(e){e.Field="field",e.Fixed="fixed",e.Mapping="mapping"}(lr||(lr={})),function(e){e.Auto="auto",e.Coords="coords",e.Geohash="geohash",e.Lookup="lookup"}(cr||(cr={})),function(e){e.Count="count",e.Size="size"}(ur||(ur={})),function(e){e.auto="auto",e.ge="ge",e.le="le",e.unknown="unknown"}(dr||(dr={})),function(e){e.Ascending="Ascending",e.Descending="Descending"}(pr||(pr={})),function(e){e.Auto="auto",e.Bottom="bottom",e.Hidden="hidden",e.Left="left",e.Right="right",e.Top="top"}(fr||(fr={})),function(e){e.Series="series",e.Text="text"}(hr||(hr={})),function(e){e.Always="always",e.Auto="auto",e.Never="never"}(gr||(gr={})),function(e){e.Bars="bars",e.Line="line",e.Points="points"}(mr||(mr={})),function(e){e.Constant="constant",e.NegativeY="negative-Y"}(vr||(vr={})),function(e){e.Linear="linear",e.Smooth="smooth",e.StepAfter="stepAfter",e.StepBefore="stepBefore"}(yr||(yr={})),function(e){e.Linear="linear",e.Log="log",e.Ordinal="ordinal",e.Symlog="symlog"}(br||(br={})),function(e){e.Hue="hue",e.None="none",e.Opacity="opacity",e.Scheme="scheme"}(Or||(Or={})),function(e){e.None="none",e.Normal="normal",e.Percent="percent"}(Sr||(Sr={})),function(e){e[e.After=1]="After",e[e.Before=-1]="Before",e[e.Center=0]="Center"}(wr||(wr={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(Er||(Er={})),function(e){e[e.Down=-1]="Down",e[e.Left=-1]="Left",e[e.Right=1]="Right",e[e.Up=1]="Up"}(Tr||(Tr={})),function(e){e.Area="area",e.Dashed="dashed",e.DashedAndArea="dashed+area",e.Line="line",e.LineAndArea="line+area",e.Off="off",e.Series="series"}(xr||(xr={})),function(e){e.Hidden="hidden",e.List="list",e.Table="table"}(Pr||(Pr={})),function(e){e.Auto="auto",e.Horizontal="horizontal",e.Vertical="vertical"}(kr||(kr={})),function(e){e.Background="background",e.BackgroundSolid="background_solid",e.None="none",e.Value="value"}(jr||(jr={})),function(e){e.Area="area",e.Line="line",e.None="none"}(Nr||(Nr={})),function(e){e.Auto="auto",e.Center="center"}(Cr||(Cr={})),function(e){e.Auto="auto",e.Name="name",e.None="none",e.Value="value",e.ValueAndName="value_and_name"}(_r||(_r={})),function(e){e.Multi="multi",e.None="none",e.Single="single"}(Rr||(Rr={})),function(e){e.Ascending="asc",e.Descending="desc",e.None="none"}(Dr||(Dr={})),function(e){e.Basic="basic",e.Gradient="gradient",e.Lcd="lcd"}(Ir||(Ir={})),function(e){e.Color="color",e.Hidden="hidden",e.Text="text"}(Ar||(Ar={})),function(e){e.Auto="auto",e.Left="left",e.Top="top"}(Fr||(Fr={})),function(e){e.Auto="auto",e.Manual="manual"}($r||($r={})),function(e){e.Auto="auto",e.BasicGauge="basic",e.ColorBackground="color-background",e.ColorBackgroundSolid="color-background-solid",e.ColorText="color-text",e.Custom="custom",e.DataLinks="data-links",e.Gauge="gauge",e.GradientGauge="gradient-gauge",e.Image="image",e.JSONView="json-view",e.LcdGauge="lcd-gauge",e.Sparkline="sparkline"}(Lr||(Lr={})),function(e){e.Basic="basic",e.Gradient="gradient"}(Qr||(Qr={})),function(e){e.Lg="lg",e.Md="md",e.Sm="sm"}(qr||(qr={})),function(e){e.CSV="csv",e.Date="date",e.Distributed="distributed",e.DoubleQuote="doublequote",e.Glob="glob",e.HTML="html",e.JSON="json",e.Lucene="lucene",e.PercentEncode="percentencode",e.Pipe="pipe",e.QueryParam="queryparam",e.Raw="raw",e.Regex="regex",e.SQLString="sqlstring",e.SingleQuote="singlequote",e.Text="text",e.UriEncode="uriencode"}(zr||(zr={})),function(e){e.exact="exact",e.none="none",e.numbers="numbers",e.signature="signature"}(Mr||(Mr={})),function(e){e.EQ="eq",e.GT="gt",e.GTE="gte",e.LT="lt",e.LTE="lte",e.NEQ="neq"}(Vr||(Vr={})),function(e){e.Done="done",e.Error="error",e.Pending="pending",e.Streaming="streaming"}(Ur||(Ur={})),function(e){e.Spans="spans",e.Traces="traces"}(Br||(Br={})),function(e){e.Intrinsic="intrinsic",e.Resource="resource",e.Span="span",e.Unscoped="unscoped"}(Gr||(Gr={}));const Yr=["=","!=",">","<",">=","<=","=~","!~"],Jr=["=","!="],Hr=["=","!=","=~","!~"],Kr=["=","!=",">","<",">=","<="],Zr=["duration","kind","name","rootName","rootServiceName","status","statusMessage","traceDuration"],en=["resource","span"],tn=Zr.concat(en),rn={id:"traceql",extensions:[".traceql"],aliases:["tempo","traceql"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".traceql",keywords:tn,operators:Yr,statusValues:["ok","unset","error","false","true"],functions:["avg","min","max","sum","count","by"],symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,tokenizer:{root:[[/\/\/.*/,"comment"],[/\/\*.*\*\//,"comment"],[/[0-9]+(.[0-9]+)?(us|s|ns|ms|s|m|h)/,"number"],[/^\s*[0-9A-Fa-f]+\s*$/,"tag"],[`(?:${tn.join("|")})`,{cases:{"@keywords":"keyword","@default":"tag"}}],[/(?:\w|^[^{}()=~!<>&|," ]|"(?:\\"|\\\\|[^\\"])*")+/,{cases:{"@functions":"predefined","@statusValues":"type","@default":"tag"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/([^\w])(")/,[{token:""},{token:"string",next:"@string_double"}]],[/([^\w])(')/,[{token:""},{token:"string",next:"@string_single"}]],[/([^\w])(`)/,[{token:""},{token:"string",next:"@string_back"}]],[/[{}()\[\]]/,"delimiter.bracket"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?[fFdD]?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?[fFdD]?/,"number.float"],[/0(@octaldigits)[Ll]?/,"number.octal"],[/0[bB](@binarydigits)[Ll]?/,"number.binary"],[/(@digits)[fFdD]/,"number.float"],[/(@digits)[lL]?/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_back:[[/[^\\`]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}},nn={comment:{pattern:/\/\/.*/},"span-set":{pattern:/\{[^}]*}/,inside:{filter:{pattern:/([\w.\/-]+)?(\s*)(([!=+\-<>~]+)\s*("([^"\n&]+)?"?|([^"\n\s&|}]+))?)/g,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_.][\w./_-]*(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,alias:"attr-name"},"label-value":{pattern:/("(?:\\.|[^\\"])*")|(\w+)/,alias:"attr-value"}}},punctuation:/[}{&|]/}},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp("/[-+*/=%^~]|&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?|","i"),punctuation:/[{};()`,.]/},an=e=>`{${e.filter((e=>{var t;return e.tag&&e.operator&&(null===(t=e.value)||void 0===t?void 0:t.length)})).map((t=>`${sn(t)}${ln(t,e)}${t.operator}${on(t)}`)).join(" && ")}}`,on=e=>Array.isArray(e.value)&&e.value.length>1?`"${e.value.join("|")}"`:"string"===e.valueType?`"${e.value}"`:e.value,sn=e=>{var t;return Zr.find((t=>t===e.tag))?"":(e.scope===Gr.Resource||e.scope===Gr.Span?null===(t=e.scope)||void 0===t?void 0:t.toLowerCase():"")+"."},ln=(e,t)=>{if("duration"===e.tag){const r=t.find((e=>"duration-type"===e.id));return r?"trace"===r.value?"traceDuration":"duration":e.tag}return e.tag},cn=e=>sn(e)+e.tag,un=e=>"name"===e.tag?"Span Name":"service.name"===e.tag&&e.scope===Gr.Resource?"Service Name":(0,gt.startCase)(cn(e)),dn=e=>(0,gt.uniq)(e.map((e=>e.name&&"intrinsic"!==e.name&&e.tags?e.tags:[])).flat()),pn=(e,t)=>(0,gt.uniq)(e.map((e=>e.name&&e.name===t&&e.tags?e.tags:[])).flat());function fn(e,t,r){const n=e.slice(0);return n[t]=r,n}const hn=e=>{const t={label:e,value:e};switch(e){case"=":t.description="Equals";break;case"!=":t.description="Not equals";break;case">":t.description="Greater";break;case">=":t.description="Greater or Equal";break;case"<":t.description="Less";break;case"<=":t.description="Less or Equal";break;case"=~":t.description="Matches regex";break;case"!~":t.description="Does not match regex"}return t};var gn;!function(e){e[e.LabelNames=0]="LabelNames",e[e.LabelValues=1]="LabelValues"}(gn||(gn={}));const mn=[{label:"Label names",value:0},{label:"Label values",value:1}],vn="TempoDatasourceVariableQueryEditor-VariableQuery",yn=({onChange:e,query:t,datasource:o})=>{const[i,s]=(0,r.useState)(t.label||""),[l,c]=(0,r.useState)(t.type),[u,d]=(0,r.useState)([]);(0,r.useEffect)((()=>{1===l&&o.labelNamesQuery().then((e=>{d(e.map((({text:e})=>({label:e,value:e}))))}))}),[o,t,l]);const p=()=>{void 0!==l&&e({type:l,label:i,refId:vn})};return n().createElement(n().Fragment,null,n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Query type",labelWidth:20},n().createElement(a.Select,{"aria-label":"Query type",onChange:t=>{c(t.value),void 0!==t.value&&e({type:t.value,label:i,refId:vn})},onBlur:p,value:l,options:mn,width:32}))),1===l&&n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Label",labelWidth:20},n().createElement(a.Select,{"aria-label":"Label",onChange:t=>{const r=t.value||"";s(r),void 0!==l&&e({type:l,label:r,refId:vn})},onBlur:p,value:{label:i,value:i},options:u,width:32,allowCustomValue:!0}))))};function bn(e){return e.sort(((e,t)=>e[0]-t[0])),e.reduce(((e,t)=>{if(!e.length)return[t];const r=e.slice(-1)[0],[n,a]=r,[o,i]=t;return i<a?e:o>a?[...e,t]:[...e.slice(0,-1),[n,i]]}),[]).reduce(((e,t)=>e+(t[1]-t[0])),0)}function On(e,t,r){return{main:`${Sn(e)}ms (${Sn(e/t*100)}%)`,secondary:`${Sn(r)}ms (${Sn(r/e*100)}%)`}}function Sn(e){return parseFloat(e.toFixed(2))}function wn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function En(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){wn(e,t,r[t])}))}return e}function Tn(t){const{nodes:r,edges:n}=function(t){const r=[],n=[],a=new e.DataFrameView(t),o=function(e){let t=0,r=1/0;for(let n=0;n<e.length;n++){const a=e.get(n);a.startTime<r&&(r=a.startTime),a.startTime+a.duration>t&&(t=a.startTime+a.duration)}return t-r}(a),i=function(e){const t={};let r;for(let n=0;r=e(n),r;n++){t[r.id]?t[r.id].span=r.span:t[r.id]={span:r.span,children:[]};for(const e of r.parentIds)e&&(t[e]?t[e].children.push(r.id):t[e]={span:void 0,children:[r.id]})}return t}((e=>{if(e>=t.length)return;const r=a.get(e);return{span:En({},r),id:r.spanID,parentIds:r.parentSpanID?[r.parentSpanID]:[]}}));for(let t=0;t<a.length;t++){const l=a.get(t),c=i[l.spanID].children.map((e=>{const t=i[e].span;return[t.startTime,t.startTime+t.duration]})),u=bn(c),d=l.duration-u,p=On(l.duration,o,d);var s;r.push({[e.NodeGraphDataFrameFieldNames.id]:l.spanID,[e.NodeGraphDataFrameFieldNames.title]:null!==(s=l.serviceName)&&void 0!==s?s:"",[e.NodeGraphDataFrameFieldNames.subTitle]:l.operationName,[e.NodeGraphDataFrameFieldNames.mainStat]:p.main,[e.NodeGraphDataFrameFieldNames.secondaryStat]:p.secondary,[e.NodeGraphDataFrameFieldNames.color]:d/o}),l.parentSpanID&&i[l.parentSpanID].span&&n.push({[e.NodeGraphDataFrameFieldNames.id]:l.parentSpanID+"--"+l.spanID,[e.NodeGraphDataFrameFieldNames.target]:l.spanID,[e.NodeGraphDataFrameFieldNames.source]:l.parentSpanID})}return{nodes:r,edges:n}}(t),[a,o]=[new e.MutableDataFrame({fields:[{name:e.NodeGraphDataFrameFieldNames.id,type:e.FieldType.string},{name:e.NodeGraphDataFrameFieldNames.title,type:e.FieldType.string},{name:e.NodeGraphDataFrameFieldNames.subTitle,type:e.FieldType.string},{name:e.NodeGraphDataFrameFieldNames.mainStat,type:e.FieldType.string,config:{displayName:"Total time (% of trace)"}},{name:e.NodeGraphDataFrameFieldNames.secondaryStat,type:e.FieldType.string,config:{displayName:"Self time (% of total)"}},{name:e.NodeGraphDataFrameFieldNames.color,type:e.FieldType.number,config:{color:{mode:"continuous-GrYlRd"},displayName:"Self time / Trace duration"}}],meta:{preferredVisualisationType:"nodeGraph"}}),new e.MutableDataFrame({fields:[{name:e.NodeGraphDataFrameFieldNames.id,type:e.FieldType.string},{name:e.NodeGraphDataFrameFieldNames.target,type:e.FieldType.string},{name:e.NodeGraphDataFrameFieldNames.source,type:e.FieldType.string}],meta:{preferredVisualisationType:"nodeGraph"}})];for(const e of r)a.add(e);for(const e of n)o.add(e);return[a,o]}const xn="traces_service_graph_request_server_seconds_sum",Pn="traces_service_graph_request_total",kn="traces_service_graph_request_failed_total",jn="traces_service_graph_request_server_seconds_bucket",Nn={expr:"sum(rate(traces_spanmetrics_calls_total{}[$__range])) by (span_name)",topk:5,params:[]},Cn={expr:"sum(rate(traces_spanmetrics_calls_total{}[$__range])) by (span_name)",topk:5,params:['status_code="STATUS_CODE_ERROR"']},_n={expr:"histogram_quantile(.9, sum(rate(traces_spanmetrics_latency_bucket{}[$__range])) by (le))",params:[]},Rn='span_kind="SPAN_KIND_SERVER"',Dn=[xn,Pn,kn,jn];var In;function An(e,t,r,n,a){if(!e)return;const o=`Value #${r}`;for(let r=0;r<e.length;r++){const i=e.get(r),s=i.server_service_namespace?`${i.server_service_namespace}/${i.server}`:i.server,l=i.client_service_namespace?`${i.client_service_namespace}/${i.client}`:i.client,c=`${l}_${s}`;a[c]?a[c][t]=(a[c][t]||0)+i[o]:a[c]={target:s,targetName:i.server,targetNamespace:i.server_service_namespace,source:l,sourceName:i.client,sourceNamespace:i.client_service_namespace,[t]:i[o]},n[s]?n[s][t]=(n[s][t]||0)+i[o]:n[s]={name:i.server,namespace:i.server_service_namespace,[t]:i[o]},n[l]||(n[l]={name:i.client,namespace:i.client_service_namespace,[t]:0})}}function Fn(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function $n(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Fn(o,n,a,i,s,"next",e)}function s(e){Fn(o,n,a,i,s,"throw",e)}i(void 0)}))}}function Ln(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){e.sourceName="sourceName",e.sourceNamespace="sourceNamespace",e.targetName="targetName",e.targetNamespace="targetNamespace"}(In||(In={}));class Qn extends e.LanguageProvider{fetchTags(){var e=this;return $n((function*(){let t,r;try{r=yield e.request("/api/v2/search/tags",[])}catch(r){t=yield e.request("/api/search/tags",[])}r&&r.scopes?e.setV2Tags(r.scopes):t&&e.setV1Tags(t.tagNames)}))()}getOptionsV1(e){var t=this;return $n((function*(){const r=t.encodeTag(e),n=yield t.request(`/api/search/tag/${r}/values`);let a=[];return n&&n.tagValues&&(a=n.tagValues.map((e=>({value:e,label:e})))),a}))()}getOptionsV2(e,t){var r=this;return $n((function*(){const n=r.encodeTag(e),a=yield r.request(`/api/v2/search/tag/${n}/values`,t?{q:t}:{});let o=[];return a&&a.tagValues&&a.tagValues.forEach((e=>{e.value&&o.push({type:e.type,value:e.value,label:e.value})})),o}))()}constructor(e,t){super(),Ln(this,"datasource",void 0),Ln(this,"tagsV1",void 0),Ln(this,"tagsV2",void 0);var r,n=this;Ln(this,"request",(r=$n((function*(e,t={}){const r=yield n.datasource.metadataRequest(e,t);return null==r?void 0:r.data})),function(e){return r.apply(this,arguments)}));var a=this;Ln(this,"start",$n((function*(){return a.startTask||(a.startTask=a.fetchTags().then((()=>[]))),a.startTask}))),Ln(this,"setV1Tags",(e=>{this.tagsV1=e})),Ln(this,"setV2Tags",(e=>{this.tagsV2=e})),Ln(this,"getTags",(e=>this.tagsV2&&e?e===Gr.Unscoped?dn(this.tagsV2):pn(this.tagsV2,e):this.tagsV1?(this.tagsV1.find((e=>"status"===e))||this.tagsV1.push("status"),this.tagsV1):[])),Ln(this,"getMetricsSummaryTags",(e=>this.tagsV2&&e?e===Gr.Unscoped?dn(this.tagsV2):pn(this.tagsV2,e):this.tagsV1?this.tagsV1:[])),Ln(this,"getTraceqlAutocompleteTags",(e=>this.tagsV2?e?e===Gr.Unscoped?dn(this.tagsV2):pn(this.tagsV2,e):dn(this.tagsV2):this.tagsV1?(this.tagsV1.find((e=>"status"===e))||this.tagsV1.push("status"),this.tagsV1):[])),Ln(this,"getAutocompleteTags",(()=>this.tagsV2?(e=>(0,gt.uniq)(e.map((e=>e.tags?e.tags:[])).flat()))(this.tagsV2):this.tagsV1?(this.tagsV1.find((e=>"status.code"===e))||this.tagsV1.push("status.code"),this.tagsV1):[])),Ln(this,"encodeTag",(e=>encodeURIComponent(encodeURIComponent(e)))),this.datasource=e,Object.assign(this,t)}}function qn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){qn(e,t,r[t])}))}return e}function Mn(t,r,n){let a;if(!t.length)return Hn;const o={};t.forEach((t=>{const a=Un(t.series,r);t.series.forEach((t=>{o[t.key]={name:`${t.key}`,type:e.FieldType.string,config:Bn(t,a,n),values:[]}}))})),a=(0,e.createDataFrame)({name:"Metrics Summary",refId:"metrics-summary",fields:[...Object.values(o).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"kind",type:e.FieldType.string,config:{displayNameFromDS:"Kind",custom:{width:150}}},{name:"spanCount",type:e.FieldType.number,config:{displayNameFromDS:"Span count",custom:{width:150}}},{name:"errorPercentage",type:e.FieldType.number,config:{displayNameFromDS:"Error",unit:"percent",custom:{width:150}}},Yn("p50"),Yn("p90"),Yn("p95"),Yn("p99")],meta:{preferredVisualisationType:"table"}});const i=t.map(Vn);a.length=i.length;for(const e of i)for(const t of a.fields)t.values.push(e[t.name]);return a=(0,e.sortDataFrame)(a,0),[a]}const Vn=e=>{const t=e.errorSpanCount?Jn(e.errorSpanCount)/Jn(e.spanCount)*100:"0%",r={kind:"server",spanCount:Jn(e.spanCount),errorPercentage:t,p50:Jn(e.p50),p90:Jn(e.p90),p95:Jn(e.p95),p99:Jn(e.p99)};return e.series.forEach((e=>{r[`${e.key}`]=Gn(e)||""})),r},Un=(e,t)=>{const r=e.map((e=>{const t=3===e.value.type||4===e.value.type,r=8===e.value.type||9===e.value.type,n=t||r?"":'"';return`${e.key}=${n}\${__data.fields["`+e.key+'"]}'+`${n}`}));let n="";const a=t.indexOf("}");if(-1!==a){const e=t.substring(a+1);n=t.substring(0,a),r.length>0&&(n+=t.replace(/\s/g,"").includes("{}")?"":" && ",n+=`${r.join(" && ")} && kind=server`,n+="}"),n+=`${e}`}else n=`{${r.join(" && ")} && kind=server} | ${t}`;return n},Bn=(e,t,r)=>{const n={displayNameFromDS:e.key,noValue:"<no value>",links:[{title:"Query in explore",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:t,queryType:"traceql"}}}]};return 7===e.value.type?(a=zn({},n),o=null!=(o={unit:"ns"})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(o)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(o,e))})),a):zn({},n);var a,o},Gn=e=>{if(!e.value.type)return"";switch(e.value.type){case 3:return e.value.n;case 4:return e.value.f;case 5:return e.value.s;case 6:return e.value.b;case 7:return e.value.d;case 8:return Wn(e.value.status);case 9:return Xn(e.value.kind);default:return""}},Wn=e=>{if(!e)return"";switch(e){case 0:return"error";case 1:return"ok";default:return"unset"}},Xn=e=>{if(!e)return"";switch(e){case 1:return"internal";case 2:return"client";case 3:return"server";case 4:return"producer";case 5:return"consumer";default:return"unspecified"}},Yn=t=>({name:t,type:e.FieldType.number,config:{displayNameFromDS:t,unit:"ns",custom:{width:150}}}),Jn=e=>{const t=parseInt(e,10);return isNaN(t)?0:t},Hn=new e.MutableDataFrame({name:"Metrics Summary",refId:"metrics-summary",fields:[],meta:{preferredVisualisationType:"table"}});var Kn="service.name";function Zn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ea(e){if(e.stringValue)return e.stringValue;if(void 0!==e.boolValue)return Boolean(e.boolValue);if(void 0!==e.intValue)return Number.parseInt(e.intValue,10);if(e.doubleValue)return Number.parseFloat(e.doubleValue);if(e.arrayValue){const t=[];for(const r of e.arrayValue.values)t.push(ea(r));return t}return""}function ta(e){const t=[];let r="OTLPResourceNoServiceName";if(!e)return{serviceName:r,serviceTags:t};for(const n of e.attributes)n.key===Kn&&(r=n.value.stringValue||r),t.push({key:n.key,value:ea(n.value)});return{serviceName:r,serviceTags:t}}function ra(e){const t=[];if(e.attributes)for(const r of e.attributes)t.push({key:r.key,value:ea(r.value)});return t}function na(e){let t;if(e.kind){const r=e.kind.toString().toLowerCase().split("_");t=r.length?r[r.length-1]:e.kind.toString()}return t}function aa(e){const t=[];if(e.links)for(const r of e.links){const{traceId:e,spanId:n}=r,a=[];if(r.attributes)for(const e of r.attributes)a.push({key:e.key,value:ea(e.value)});t.push({traceID:e,spanID:n,tags:a})}return t}function oa(e){const t=[];if(e.events)for(const r of e.events){const e=[];if(r.attributes)for(const t of r.attributes)e.push({key:t.key,value:ea(t.value)});t.push({fields:e,timestamp:r.timeUnixNano/1e6})}return t}function ia(r,n,a=!1){const o=r.data[0];if(!o)return fa;const i=null==n?void 0:n.jsonData,s=null==i?void 0:i.tracesToProfiles;let l;if((null==s?void 0:s.datasourceUid)&&(l=(0,t.getDataSourceSrv)().getInstanceSettings(s.datasourceUid)),s&&l){const t=s.customQuery?s.query:void 0;var c;const r={title:"Related profiles",url:"",internal:{datasourceUid:l.uid,datasourceName:l.name,query:{labelSelector:t||"{${__tags}}",groupBy:[],profileTypeId:null!==(c=s.profileTypeId)&&void 0!==c?c:"",queryType:"profile",spanSelector:['${__span.tags["pyroscope.profile.id"]}'],refId:"profile"}},origin:e.DataLinkConfigOrigin.Datasource};o.fields.forEach((e=>{"tags"===e.name&&(e.config.links=[r])}))}let u=[...r.data];return a&&u.push(...Tn((0,e.toDataFrame)(o))),d=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Zn(e,t,r[t])}))}return e}({},r),p=null!=(p={data:u})?p:{},Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(p)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(p)).forEach((function(e){Object.defineProperty(d,e,Object.getOwnPropertyDescriptor(p,e))})),d;var d,p}function sa(t,r){const n=new e.MutableDataFrame({name:"Traces",refId:"traces",fields:[{name:"traceID",type:e.FieldType.string,values:[],config:{unit:"string",displayNameFromDS:"Trace ID",links:[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:"${__value.raw}",queryType:"traceql"}}}]}},{name:"traceService",type:e.FieldType.string,config:{displayNameFromDS:"Trace service"},values:[]},{name:"traceName",type:e.FieldType.string,config:{displayNameFromDS:"Trace name"},values:[]},{name:"startTime",type:e.FieldType.time,config:{displayNameFromDS:"Start time"},values:[]},{name:"traceDuration",type:e.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ms"},values:[]}],meta:{preferredVisualisationType:"table"}});if(!(null==t?void 0:t.length))return n;const a=t.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).map(la);for(const e of a)n.add(e);return n}function la(e){return{traceID:e.traceID,startTime:parseInt(e.startTimeUnixNano,10)/1e6,traceDuration:e.durationMs,traceService:e.rootServiceName||"",traceName:e.rootTraceName||""}}function ca(t,r,n){return n===Br.Spans?function(t,r){const n={};let a=!1;null==t||t.forEach((t=>ua(t).forEach((t=>{var r;null===(r=t.attributes)||void 0===r||r.forEach((t=>{n[t.key]={name:t.key,type:e.FieldType.string,config:{displayNameFromDS:t.key}}})),t.spans.forEach((t=>{var r;t.name&&(a=!0),null===(r=t.attributes)||void 0===r||r.forEach((t=>{n[t.key]={name:t.key,type:e.FieldType.string,config:{displayNameFromDS:t.key}}}))}))}))));const o=new e.MutableDataFrame({name:"Spans",refId:"traces",fields:[{name:"traceIdHidden",type:e.FieldType.string,config:{custom:{hidden:!0}}},{name:"traceService",type:e.FieldType.string,config:{displayNameFromDS:"Trace Service",custom:{width:200}}},{name:"traceName",type:e.FieldType.string,config:{displayNameFromDS:"Trace Name",custom:{width:200}}},{name:"spanID",type:e.FieldType.string,config:{unit:"string",displayNameFromDS:"Span ID",custom:{width:200},links:[{title:"Span: ${__value.raw}",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:"${__data.fields.traceIdHidden}",queryType:"traceql"},panelsState:{trace:{spanId:"${__value.raw}"}}}}]}},{name:"time",type:e.FieldType.time,config:{displayNameFromDS:"Start time"}},{name:"name",type:e.FieldType.string,config:{displayNameFromDS:"Name",custom:{hidden:!a}}},...Object.values(n).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"duration",type:e.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ns",custom:{width:120}}}],meta:{preferredVisualisationType:"table"}});return t&&t.length?(t.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).forEach((e=>{ua(e).forEach((t=>{t.spans.forEach((r=>{o.add(pa(r,t,e))}))}))})),[o]):[o]}(t,r):function(t,r){const n=(0,e.createDataFrame)({name:"Traces",refId:"traces",fields:[{name:"traceID",type:e.FieldType.string,config:{unit:"string",displayNameFromDS:"Trace ID",custom:{width:200},links:[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:"${__value.raw}",queryType:"traceql"}}}]}},{name:"startTime",type:e.FieldType.time,config:{displayNameFromDS:"Start time",custom:{width:200}}},{name:"traceService",type:e.FieldType.string,config:{displayNameFromDS:"Service"}},{name:"traceName",type:e.FieldType.string,config:{displayNameFromDS:"Name"}},{name:"traceDuration",type:e.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ms",custom:{width:120}}},{name:"nested",type:e.FieldType.nestedFrames}],meta:{preferredVisualisationType:"table",uniqueRowIdFields:[0]}});return(null==t?void 0:t.length)?(n.length=t.length,t.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).forEach((e=>{const t=la(e);n.fields[0].values.push(t.traceID),n.fields[1].values.push(t.startTime),n.fields[2].values.push(t.traceService),n.fields[3].values.push(t.traceName),n.fields[4].values.push(t.traceDuration),e.spanSets?n.fields[5].values.push(e.spanSets.map((t=>da(e,t,r)))):e.spanSet&&n.fields[5].values.push([da(e,e.spanSet,r)])})),[n]):[n]}(t,r)}const ua=e=>(e.spanSets&&e.spanSet&&console.warn("Both `spanSets` and `spanSet` are set. `spanSet` will be ignored"),e.spanSets||(e.spanSet?[e.spanSet]:[])),da=(t,r,n)=>{var a;const o={};let i=!1;null===(a=r.attributes)||void 0===a||a.map((t=>{o[t.key]={name:t.key,type:e.FieldType.string,config:{displayNameFromDS:t.key},values:[]}})),r.spans.forEach((t=>{var r;t.name&&(i=!0),null===(r=t.attributes)||void 0===r||r.forEach((t=>{o[t.key]={name:t.key,type:e.FieldType.string,config:{displayNameFromDS:t.key},values:[]}}))}));const s=new e.MutableDataFrame({fields:[{name:"traceIdHidden",type:e.FieldType.string,config:{custom:{hidden:!0}},values:[]},{name:"spanID",type:e.FieldType.string,values:[],config:{unit:"string",displayNameFromDS:"Span ID",custom:{width:200},links:[{title:"Span: ${__value.raw}",url:"",internal:{datasourceUid:n.uid,datasourceName:n.name,query:{query:"${__data.fields.traceIdHidden}",queryType:"traceql"},panelsState:{trace:{spanId:"${__value.raw}"}}}}]}},{name:"time",type:e.FieldType.time,config:{displayNameFromDS:"Start time",custom:{width:200}}},{name:"name",type:e.FieldType.string,values:[],config:{displayNameFromDS:"Name",custom:{hidden:!i}}},...Object.values(o).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"duration",type:e.FieldType.number,values:[],config:{displayNameFromDS:"Duration",unit:"ns",custom:{width:120}}}],meta:{preferredVisualisationType:"table"}}),l=(0,e.createTheme)();for(const t of s.fields)t.display=(0,e.getDisplayProcessor)({field:t,theme:l});return r.spans.forEach((e=>{s.add(pa(e,r,t))})),s};function pa(e,t,r){const n=parseInt(e.startTimeUnixNano,10)/1e6,a={traceIdHidden:r.traceID,traceService:r.rootServiceName||"",traceName:r.rootTraceName||"",spanID:e.spanID,time:n,duration:parseInt(e.durationNanos,10),name:e.name};let o=[];return t.attributes&&(o=o.concat(t.attributes)),e.attributes&&(o=o.concat(e.attributes)),o.forEach((e=>{var t,r,n,o,i,s,l,c;(e.value.boolValue||(null===(t=e.value.Value)||void 0===t?void 0:t.bool_value))&&(a[e.key]=e.value.boolValue||(null===(i=e.value.Value)||void 0===i?void 0:i.bool_value)),(e.value.doubleValue||(null===(r=e.value.Value)||void 0===r?void 0:r.double_value))&&(a[e.key]=e.value.doubleValue||(null===(s=e.value.Value)||void 0===s?void 0:s.double_value)),(e.value.intValue||(null===(n=e.value.Value)||void 0===n?void 0:n.int_value))&&(a[e.key]=e.value.intValue||(null===(l=e.value.Value)||void 0===l?void 0:l.int_value)),(e.value.stringValue||(null===(o=e.value.Value)||void 0===o?void 0:o.string_value))&&(a[e.key]=e.value.stringValue||(null===(c=e.value.Value)||void 0===c?void 0:c.string_value))})),a}const fa={data:[new e.MutableDataFrame({fields:[{name:"trace",type:e.FieldType.trace,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}})]};function ha(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ga(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ha(e,t,r[t])}))}return e}function ma(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function va(t,r,n){const a={steps:[{color:"blue",value:-1/0},{color:"green",value:75}],mode:e.ThresholdsMode.Absolute};return{refId:"streaming-progress",name:"Streaming Progress",length:1,fields:[{name:"state",type:e.FieldType.string,values:[(0,gt.capitalize)(r.toString())],config:{displayNameFromDS:"State"}},{name:"elapsedTime",type:e.FieldType.number,values:[n],config:{unit:"ms",displayNameFromDS:"Elapsed Time"}},{name:"totalBlocks",type:e.FieldType.number,values:[t.totalBlocks],config:{displayNameFromDS:"Total Blocks"}},{name:"completedJobs",type:e.FieldType.number,values:[t.completedJobs],config:{displayNameFromDS:"Completed Jobs"}},{name:"totalJobs",type:e.FieldType.number,values:[t.totalJobs],config:{displayNameFromDS:"Total Jobs"}},{name:"progress",type:e.FieldType.number,values:[r===Ur.Done?100:(t.completedJobs||0)/(t.totalJobs||1)*100],config:{displayNameFromDS:"Progress",unit:"percent",min:0,max:100,custom:{cellOptions:{type:"gauge",mode:"gradient"}},thresholds:a}}],meta:{preferredVisualisationType:"table"}}}function ya(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ba extends e.CustomVariableSupport{query(e){if(!this.datasource)throw new Error("Datasource not initialized");const t=this.datasource.executeVariableQuery(e.targets[0]);return(0,mt.from)(t).pipe(Ut((e=>({data:e}))))}constructor(e){super(),ya(this,"datasource",void 0),ya(this,"editor",void 0),this.datasource=e,this.editor=yn}}function Oa(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Sa(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Oa(o,n,a,i,s,"next",e)}function s(e){Oa(o,n,a,i,s,"throw",e)}i(void 0)}))}}function wa(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ea(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){wa(e,t,r[t])}))}return e}function Ta(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const xa=20;var Pa;!function(e){e.streaming="streaming"}(Pa||(Pa={}));const ka={streaming:"2.2.0"};class ja extends t.DataSourceWithBackend{executeVariableQuery(e){var t=this;return Sa((function*(){if(void 0===e.type)return new Promise((()=>[]));switch(e.type){case gn.LabelNames:return yield t.labelNamesQuery();case gn.LabelValues:return t.labelValuesQuery(e.label);default:throw Error("Invalid query type: "+e.type)}}))()}labelNamesQuery(){var e=this;return Sa((function*(){return yield e.languageProvider.fetchTags(),e.languageProvider.getAutocompleteTags().filter((e=>void 0!==e)).map((e=>({text:e})))}))()}labelValuesQuery(e){var t=this;return Sa((function*(){if(!e)return[];let r;try{var n;const a=null===(n=(t.languageProvider.tagsV2||[]).flatMap((e=>e.tags.map((t=>({scope:e.name,name:t}))))).find((t=>t.name===e)))||void 0===n?void 0:n.scope;if(!a)throw Error(`Scope for tag ${e} not found`);const o="intrinsic"===a?e:`${a}.${e}`;r=yield t.languageProvider.getOptionsV2(o)}catch(n){r=yield t.languageProvider.getOptionsV1(e)}return r.filter((e=>void 0!==e.value)).map((e=>({text:e.value})))}))()}isFeatureAvailable(e){var t;const r=null!==(t=this.tempoVersion)&&void 0!==t?t:"2.1.0";try{return Xr().gte(r,ka[e])}catch(e){return!0}}query(r){var n,a,o,i,s,l,c;const u=[],d=r.targets.filter((e=>!e.hide)),p=(0,gt.groupBy)(d,(e=>e.queryType||"traceql"));if(p.clear)return(0,mt.of)({data:[],state:e.LoadingState.Done});const f=this.getLokiSearchDS();if(f&&(null===(n=p.search)||void 0===n?void 0:n.length)>0){var h,g,m;(0,t.reportInteraction)("grafana_traces_loki_search_queried",{datasourceType:"tempo",app:null!==(m=r.app)&&void 0!==m?m:"",grafana_version:t.config.buildInfo.version,hasLinkedQueryExpr:!(!(null===(h=p.search[0].linkedQuery)||void 0===h?void 0:h.expr)||""===(null===(g=p.search[0].linkedQuery)||void 0===g?void 0:g.expr))});const n=(0,t.getDataSourceSrv)();u.push((0,mt.from)(n.get(f)).pipe(Zt((t=>{var n;const a=Ta(Ea({},r),{targets:p.search.map((e=>e.linkedQuery))}),o=(null===(n=t.instanceSettings.jsonData.derivedFields)||void 0===n?void 0:n.filter((e=>e.datasourceUid===this.uid&&e.matcherRegex)).map((e=>e.matcherRegex)))||[];return o&&0!==o.length?t.query(a).pipe(Ut((t=>t.error?t:function(t,r,n,a){return t.data.forEach(((o,i)=>{const s=function(t,r,n,a){const o=new e.MutableDataFrame({fields:[{name:"Time",type:e.FieldType.time,config:{custom:{width:200}},values:[]},{name:"traceID",type:e.FieldType.string,config:{displayNameFromDS:"Trace ID",custom:{width:180},links:[{title:"Click to open trace ${__value.raw}",url:"",internal:{datasourceUid:r,datasourceName:n,query:{query:"${__value.raw}"}}}]},values:[]},{name:"Message",type:e.FieldType.string,values:[]}],meta:{preferredVisualisationType:"table"}});if(!t||0===a.length)return o;const i=t.fields.find((t=>t.type===e.FieldType.time));for(let r of t.fields){let t=!1;if(r.type===e.FieldType.string){const e=r.values;for(let r=0;r<e.length;r++){const n=e[r];if(n)for(let e of a){const a=n.match(e);if(a){const e=a[1],s=i?i.values[r]:null;o.fields[0].values.push(s),o.fields[1].values.push(e),o.fields[2].values.push(n),t=!0}}}}if(t)break}return o}(o,r,n,a);t.data[i]=s})),t}(t,this.uid,this.name,o)))):(0,mt.throwError)((()=>new Error("No Loki datasource configured for search. Set up Derived Fields for traces in a Loki datasource settings and link it to this Tempo datasource.")))}))))}if(null===(a=p.nativeSearch)||void 0===a?void 0:a.length)try{var v,b,O,S;(0,t.reportInteraction)("grafana_traces_search_queried",{datasourceType:"tempo",app:null!==(v=r.app)&&void 0!==v?v:"",grafana_version:t.config.buildInfo.version,hasServiceName:!!p.nativeSearch[0].serviceName,hasSpanName:!!p.nativeSearch[0].spanName,resultLimit:null!==(b=p.nativeSearch[0].limit)&&void 0!==b?b:"",hasSearch:!!p.nativeSearch[0].search,minDuration:null!==(O=p.nativeSearch[0].minDuration)&&void 0!==O?O:"",maxDuration:null!==(S=p.nativeSearch[0].maxDuration)&&void 0!==S?S:""});const e={startTime:r.range.from.unix(),endTime:r.range.to.unix()},n=this.applyVariables(p.nativeSearch[0],r.scopedVars),a=this.buildSearchQuery(n,e);u.push(this._request("/api/search",a).pipe(Ut((e=>({data:[sa(e.data.traces,this.instanceSettings)]}))),er((e=>(0,mt.of)({error:{message:y(e.data.message)},data:[]})))))}catch(e){return(0,mt.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}if(null===(o=p.traceql)||void 0===o?void 0:o.length)try{const e=this.applyVariables(p.traceql[0],r.scopedVars),n=(null==e?void 0:e.query)||"",a=/^[0-9A-Fa-f]*$/;var w,E,T,x;n.trim().match(a)?((0,t.reportInteraction)("grafana_traces_traceID_queried",{datasourceType:"tempo",app:null!==(w=r.app)&&void 0!==w?w:"",grafana_version:t.config.buildInfo.version,hasQuery:""!==n}),u.push(this.handleTraceIdQuery(r,p.traceql))):((0,t.reportInteraction)("grafana_traces_traceql_queried",{datasourceType:"tempo",app:null!==(E=r.app)&&void 0!==E?E:"",grafana_version:t.config.buildInfo.version,query:null!=n?n:"",streaming:t.config.featureToggles.traceQLStreaming}),t.config.featureToggles.traceQLStreaming&&this.isFeatureAvailable("streaming")?u.push(this.handleStreamingSearch(r,p.traceql,n)):u.push(this._request("/api/search",{q:n,limit:null!==(T=r.targets[0].limit)&&void 0!==T?T:xa,spss:null!==(x=r.targets[0].spss)&&void 0!==x?x:3,start:r.range.from.unix(),end:r.range.to.unix()}).pipe(Ut((e=>({data:ca(e.data.traces,this.instanceSettings,p.traceql[0].tableType)}))),er((e=>(0,mt.of)({error:{message:y(e.data.message)},data:[]}))))))}catch(e){return(0,mt.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}if(null===(i=p.traceqlSearch)||void 0===i?void 0:i.length)try{if(t.config.featureToggles.metricsSummary){const e=p.traceqlSearch.find((e=>this.hasGroupBy(e)));e&&u.push(this.handleMetricsSummary(e,an(e.filters),r))}const e=t.config.featureToggles.metricsSummary?p.traceqlSearch.filter((e=>!this.hasGroupBy(e))):p.traceqlSearch;if(e.length>0){const n=an(e[0].filters),a=this.templateSrv.replace(n,r.scopedVars);var P,k,j;(0,t.reportInteraction)("grafana_traces_traceql_search_queried",{datasourceType:"tempo",app:null!==(P=r.app)&&void 0!==P?P:"",grafana_version:t.config.buildInfo.version,query:null!=a?a:"",streaming:t.config.featureToggles.traceQLStreaming}),t.config.featureToggles.traceQLStreaming&&this.isFeatureAvailable("streaming")?u.push(this.handleStreamingSearch(r,e,a)):u.push(this._request("/api/search",{q:a,limit:null!==(k=r.targets[0].limit)&&void 0!==k?k:xa,spss:null!==(j=r.targets[0].spss)&&void 0!==j?j:3,start:r.range.from.unix(),end:r.range.to.unix()}).pipe(Ut((e=>({data:ca(e.data.traces,this.instanceSettings,p.traceqlSearch[0].tableType)}))),er((e=>(0,mt.of)({error:{message:y(e.data.message)},data:[]})))))}}catch(e){return(0,mt.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}if(null===(s=p.upload)||void 0===s?void 0:s.length)if(this.uploadedJson){var N;(0,t.reportInteraction)("grafana_traces_json_file_uploaded",{datasourceType:"tempo",app:null!==(N=r.app)&&void 0!==N?N:"",grafana_version:t.config.buildInfo.version});const n=JSON.parse(this.uploadedJson),a=n.batches,o=Array.isArray(n)&&n.some((e=>{var t;return"nodeGraph"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)}));var C;a?u.push((0,mt.of)(function(t,r=!1){const n=new e.MutableDataFrame({fields:[{name:"traceID",type:e.FieldType.string,values:[]},{name:"spanID",type:e.FieldType.string,values:[]},{name:"parentSpanID",type:e.FieldType.string,values:[]},{name:"operationName",type:e.FieldType.string,values:[]},{name:"serviceName",type:e.FieldType.string,values:[]},{name:"kind",type:e.FieldType.string,values:[]},{name:"statusCode",type:e.FieldType.number,values:[]},{name:"statusMessage",type:e.FieldType.string,values:[]},{name:"instrumentationLibraryName",type:e.FieldType.string,values:[]},{name:"instrumentationLibraryVersion",type:e.FieldType.string,values:[]},{name:"traceState",type:e.FieldType.string,values:[]},{name:"serviceTags",type:e.FieldType.other,values:[]},{name:"startTime",type:e.FieldType.number,values:[]},{name:"duration",type:e.FieldType.number,values:[]},{name:"logs",type:e.FieldType.other,values:[]},{name:"references",type:e.FieldType.other,values:[]},{name:"tags",type:e.FieldType.other,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}});try{for(const e of t){const{serviceName:t,serviceTags:r}=ta(e.resource);for(const l of e.instrumentationLibrarySpans)for(const e of l.spans){var a,o,i,s;n.add({traceID:e.traceId.length>16?e.traceId.slice(16):e.traceId,spanID:e.spanId,parentSpanID:e.parentSpanId||"",operationName:e.name||"",serviceName:t,kind:na(e),statusCode:null===(a=e.status)||void 0===a?void 0:a.code,statusMessage:null===(o=e.status)||void 0===o?void 0:o.message,instrumentationLibraryName:null===(i=l.instrumentationLibrary)||void 0===i?void 0:i.name,instrumentationLibraryVersion:null===(s=l.instrumentationLibrary)||void 0===s?void 0:s.version,traceState:e.traceState,serviceTags:r,startTime:e.startTimeUnixNano/1e6,duration:(e.endTimeUnixNano-e.startTimeUnixNano)/1e6,tags:ra(e),logs:oa(e),references:aa(e)})}}}catch(e){return console.error(e),{error:{message:"JSON is not valid OpenTelemetry format: "+e},data:[]}}let l=[n];return r&&l.push(...Tn(n)),{data:l}}(n.batches,null===(C=this.nodeGraph)||void 0===C?void 0:C.enabled))):o?u.push((0,mt.of)({data:n,state:e.LoadingState.Done})):u.push((0,mt.of)({error:{message:"Unable to parse uploaded data."},data:[]}))}else u.push((0,mt.of)({data:[],state:e.LoadingState.Done}));if((null===(l=this.serviceMap)||void 0===l?void 0:l.datasourceUid)&&(null===(c=p.serviceMap)||void 0===c?void 0:c.length)>0){var _;(0,t.reportInteraction)("grafana_traces_service_graph_queried",{datasourceType:"tempo",app:null!==(_=r.app)&&void 0!==_?_:"",grafana_version:t.config.buildInfo.version,hasServiceMapQuery:!!p.serviceMap[0].serviceMapQuery});const n=this.serviceMap.datasourceUid,a=this.uid;u.push((R=r,D=n,I=a,Na(Da(R),D).pipe(nr(),Ut((r=>{const n=r.find((e=>!!e.error));var a;if(n)throw new Error(y(null===(a=n.error)||void 0===a?void 0:a.message));const{nodes:o,edges:i}=function(t,r){const n=function(t){var r;return((null===(r=t[0])||void 0===r?void 0:r.data)||[]).reduce(((t,r)=>{const n=(0,e.toDataFrame)(r);var a;return t[null!==(a=n.refId)&&void 0!==a?a:"A"]=new e.DataFrameView(n),t}),{})}(t),a={},o={};return An(n[Pn],"total",Pn,a,o),An(n[xn],"seconds",xn,a,o),An(n[kn],"failed",kn,a,o),function(t,r,n){const[a,o]=function(){function t(t,r){return new e.MutableDataFrame({name:t,fields:r,meta:{preferredVisualisationType:"nodeGraph"}})}return[t("Nodes",[{name:e.NodeGraphDataFrameFieldNames.id,type:e.FieldType.string,values:[]},{name:e.NodeGraphDataFrameFieldNames.title,type:e.FieldType.string,config:{displayName:"Service name"},values:[]},{name:e.NodeGraphDataFrameFieldNames.subTitle,type:e.FieldType.string,config:{displayName:"Service namespace"},values:[]},{name:e.NodeGraphDataFrameFieldNames.mainStat,type:e.FieldType.number,config:{unit:"ms/r",displayName:"Average response time"},values:[]},{name:e.NodeGraphDataFrameFieldNames.secondaryStat,type:e.FieldType.number,config:{unit:"r/sec",displayName:"Requests per second"},values:[]},{name:e.NodeGraphDataFrameFieldNames.arc+"success",type:e.FieldType.number,config:{displayName:"Success",color:{fixedColor:"green",mode:e.FieldColorModeId.Fixed}},values:[]},{name:e.NodeGraphDataFrameFieldNames.arc+"failed",type:e.FieldType.number,config:{displayName:"Failed",color:{fixedColor:"red",mode:e.FieldColorModeId.Fixed}},values:[]}]),t("Edges",[{name:e.NodeGraphDataFrameFieldNames.id,type:e.FieldType.string,values:[]},{name:e.NodeGraphDataFrameFieldNames.source,type:e.FieldType.string,values:[]},{name:"sourceName",type:e.FieldType.string,values:[]},{name:"sourceNamespace",type:e.FieldType.string,values:[]},{name:e.NodeGraphDataFrameFieldNames.target,type:e.FieldType.string,values:[]},{name:"targetName",type:e.FieldType.string,values:[]},{name:"targetNamespace",type:e.FieldType.string,values:[]},{name:e.NodeGraphDataFrameFieldNames.mainStat,type:e.FieldType.number,config:{unit:"ms/r",displayName:"Average response time"},values:[]},{name:e.NodeGraphDataFrameFieldNames.secondaryStat,type:e.FieldType.number,config:{unit:"r/sec",displayName:"Requests per second"},values:[]}])]}();for(const r of Object.keys(t)){const n=t[r];a.add({[e.NodeGraphDataFrameFieldNames.id]:r,[e.NodeGraphDataFrameFieldNames.title]:n.name,[e.NodeGraphDataFrameFieldNames.subTitle]:n.namespace,[e.NodeGraphDataFrameFieldNames.mainStat]:n.total?n.seconds/n.total*1e3:Number.NaN,[e.NodeGraphDataFrameFieldNames.secondaryStat]:n.total?Math.round(100*n.total)/100:Number.NaN,[e.NodeGraphDataFrameFieldNames.arc+"success"]:n.total?(n.total-Math.min(n.failed||0,n.total))/n.total:1,[e.NodeGraphDataFrameFieldNames.arc+"failed"]:n.total?Math.min(n.failed||0,n.total)/n.total:0})}for(const t of Object.keys(r)){const n=r[t];o.add({[e.NodeGraphDataFrameFieldNames.id]:t,[e.NodeGraphDataFrameFieldNames.source]:n.source,sourceName:n.sourceName,sourceNamespace:n.sourceNamespace,[e.NodeGraphDataFrameFieldNames.target]:n.target,targetName:n.targetName,targetNamespace:n.targetNamespace,[e.NodeGraphDataFrameFieldNames.mainStat]:n.total?n.seconds/n.total*1e3:Number.NaN,[e.NodeGraphDataFrameFieldNames.secondaryStat]:n.total?Math.round(100*n.total)/100:Number.NaN})}return{nodes:a,edges:o}}(a,o)}(r,R.range);if(o.fields.length>0&&i.fields.length>0){const e=o.fields[0].values.length,r=i.fields[0].values.length;(0,t.reportInteraction)("grafana_traces_service_graph_size",{datasourceType:"tempo",grafana_version:t.config.buildInfo.version,nodeLength:e,edgeLength:r})}const{serviceMapIncludeNamespace:s,refId:l}=R.targets[0];return o.refId=l,i.refId=l,s?(o.fields[0].config=_a(D,I,"__data.fields.title","__data.fields[0]",void 0,{targetNamespace:"__data.fields.subtitle"}),i.fields[0].config=_a(D,I,"__data.fields.targetName","__data.fields.target","__data.fields.sourceName",{targetNamespace:"__data.fields.targetNamespace",sourceNamespace:"__data.fields.sourceNamespace"})):(o.fields[0].config=_a(D,I,"__data.fields.id","__data.fields[0]"),i.fields[0].config=_a(D,I,"__data.fields.target","__data.fields.target","__data.fields.source")),{nodes:o,edges:i,state:e.LoadingState.Done}})))).pipe(tr((t=>function(e,t,r){const n=Da(e);return n.targets=$a([Ia(Nn,Rn,e)]),Na(n,r).pipe(nr(),Ut((e=>{var r;const n=e.find((e=>!!e.error));var a,o;if(n)throw new Error(y(null===(a=n.error)||void 0===a?void 0:a.message));return{rates:null!==(o=null===(r=e[0])||void 0===r?void 0:r.data)&&void 0!==o?o:[],nodes:t.nodes,edges:t.edges}})))}(r,t,n).pipe(tr((t=>function(t,r,n,a){let o=[],i="",s=[],l=[];if(r.rates[0]&&t.app===e.CoreApp.Explore){const e=r.rates[0].fields.find((e=>"span_name"===e.name));e&&e.values&&(l=e.values)}else r.rates&&r.rates.map((e=>{const t=e.fields.find((e=>{var t;return null===(t=e.labels)||void 0===t?void 0:t.span_name}));var r;t&&l.push(null===(r=t.labels)||void 0===r?void 0:r.span_name)}));const c=l.map((e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\\\$&")));c.length>0&&(i=Ia(Cn,'span_name=~"'+c.join("|")+'"',t),o.push(i),c.map((e=>{const r=Ia(_n,'span_name=~"'+e+'"',t);s.push(r),o.push(r)})));const u=Da(t);return u.targets=$a(o),Na(u,n).pipe(nr(),Ut((o=>{const l=o.find((e=>!!e.error));var c;if(l)throw new Error(y(null===(c=l.error)||void 0===c?void 0:c.message));const u=function(t,r,n,a,o,i,s){var l,c;let u={fields:[]};const d=r.rates.filter((e=>e.refId===Ia(Nn,Rn,t))),p=n.data.filter((e=>e.refId===a)),f=n.data.filter((e=>{var t;return o.includes(null!==(t=e.refId)&&void 0!==t?t:"")}));if(d.length>0&&(null===(l=d[0].fields)||void 0===l?void 0:l.length)>2&&(u.fields.push(Ta(Ea({},d[0].fields[1]),{name:"Name",config:{filterable:!1}})),u.fields.push(Ta(Ea({},d[0].fields[2]),{name:"Rate",config:{links:[Ca("Rate",Aa(Ia(Nn,'span_name="${__data.fields[0]}"',t)),i,!1)],decimals:2}})),u.fields.push(Ta(Ea({},d[0].fields[2]),{name:"  ",labels:null,config:{color:{mode:"continuous-BlPu"},custom:{cellOptions:{mode:Ir.Lcd,type:Lr.Gauge}},decimals:3}}))),p.length>0&&(null===(c=p[0].fields)||void 0===c?void 0:c.length)>2){var h,g,m;const e=null!==(m=null===(h=p[0].fields[1])||void 0===h?void 0:h.values)&&void 0!==m?m:[];var v;const r=null!==(v=null===(g=p[0].fields[2])||void 0===g?void 0:g.values)&&void 0!==v?v:[];let n={};e.map(((e,t)=>{n[e]={value:r[t]}}));const a=Fa(Ea({},d),n);u.fields.push(Ta(Ea({},p[0].fields[2]),{name:"Error Rate",values:a,config:{links:[Ca("Error Rate",Aa(Ia(Cn,'span_name="${__data.fields[0]}"',t)),i,!1)],decimals:2}})),u.fields.push(Ta(Ea({},p[0].fields[2]),{name:"   ",values:a,labels:null,config:{color:{mode:"continuous-RdYlGr"},custom:{cellOptions:{mode:Ir.Lcd,type:Lr.Gauge}},decimals:3}}))}if(f.length>0){let e={};f.forEach((t=>{if(t.fields.length>1){var r,n;const a=(null===(r=t.refId)||void 0===r?void 0:r.includes('span_name=~"'))?'span_name=~"':'span_name="',o=null===(n=t.refId)||void 0===n?void 0:n.split(a)[1].split('"}')[0];e[o]={value:t.fields[1].values[0]}}})),Object.keys(e).length>0&&u.fields.push(Ta(Ea({},f[0].fields[1]),{name:"Duration (p90)",values:Fa(Ea({},d),e),config:{links:[Ca("Duration",Aa(Ia(_n,'span_name="${__data.fields[0]}"',t)),i,!1)],unit:"s"}}))}return u.fields.length>0&&u.fields[0].values&&u.fields.push({name:"Links",type:e.FieldType.string,values:u.fields[0].values.map((()=>"Tempo")),config:{links:[Ra("Tempo","","${__data.fields[0]}",s)]}}),u}(t,r,o[0],i,s,n,a);return 0===u.fields.length?{data:[r.nodes,r.edges],state:e.LoadingState.Done}:{data:[u,r.nodes,r.edges],state:e.LoadingState.Done}})))}(r,t,n,a))))))))}var R,D,I;return(0,mt.merge)(...u)}applyTemplateVariables(e,t){return this.applyVariables(e,t)}interpolateVariablesInQueries(e,t){return e&&0!==e.length?e.map((e=>Ea(Ta(Ea({},e),{datasource:this.getRef()}),this.applyVariables(e,t)))):[]}applyVariables(e,t){const r=Ea({},e);var n,a,o,i,s,l,c,u,d;return e.linkedQuery&&(r.linkedQuery=Ta(Ea({},e.linkedQuery),{expr:this.templateSrv.replace(null!==(a=null===(n=e.linkedQuery)||void 0===n?void 0:n.expr)&&void 0!==a?a:"",t)})),Ta(Ea({},r),{query:this.templateSrv.replace(null!==(o=e.query)&&void 0!==o?o:"",t,zr.Pipe),serviceName:this.templateSrv.replace(null!==(i=e.serviceName)&&void 0!==i?i:"",t),spanName:this.templateSrv.replace(null!==(s=e.spanName)&&void 0!==s?s:"",t),search:this.templateSrv.replace(null!==(l=e.search)&&void 0!==l?l:"",t),minDuration:this.templateSrv.replace(null!==(c=e.minDuration)&&void 0!==c?c:"",t),maxDuration:this.templateSrv.replace(null!==(u=e.maxDuration)&&void 0!==u?u:"",t),serviceMapQuery:Array.isArray(e.serviceMapQuery)?e.serviceMapQuery.map((e=>this.templateSrv.replace(e,t))):this.templateSrv.replace(null!==(d=e.serviceMapQuery)&&void 0!==d?d:"",t)})}handleTraceIdQuery(e,t){const r=t.filter((e=>e.query)).map((e=>{var t;return Ta(Ea({},e),{query:null===(t=e.query)||void 0===t?void 0:t.trim(),queryType:"traceId"})}));if(!r.length)return mt.EMPTY;const n=this.traceIdQueryRequest(e,r);return super.query(n).pipe(Ut((e=>{var t;return e.error?e:ia(e,this.instanceSettings,null===(t=this.nodeGraph)||void 0===t?void 0:t.enabled)})))}traceIdQueryRequest(t,r){var n;const a=Ta(Ea({},t),{targets:r});var o,i;return(null===(n=this.traceQuery)||void 0===n?void 0:n.timeShiftEnabled)?a.range=t.range&&Ta(Ea({},t.range),{from:t.range.from.subtract(e.rangeUtil.intervalToMs((null===(o=this.traceQuery)||void 0===o?void 0:o.spanStartTimeShift)||"30m"),"milliseconds"),to:t.range.to.add(e.rangeUtil.intervalToMs((null===(i=this.traceQuery)||void 0===i?void 0:i.spanEndTimeShift)||"30m"),"milliseconds")}):a.range={from:(0,e.dateTime)(0),to:(0,e.dateTime)(0),raw:{from:(0,e.dateTime)(0),to:(0,e.dateTime)(0)}},a}handleStreamingSearch(r,n,a){return""===a?mt.EMPTY:(0,mt.merge)(...n.map((n=>function(r,n,a,o){const i=a.range;let s,l=e.LoadingState.NotStarted;const c=performance.now();var u;return(0,t.getGrafanaLiveSrv)().getStream({scope:e.LiveChannelScope.DataSource,namespace:n.uid,path:`search/${(0,lt.c)()}`,data:ma(ga({},r),{SpansPerSpanSet:null!==(u=r.spss)&&void 0!==u?u:3,timeRange:{from:i.from.toISOString(),to:i.to.toISOString()}})}).pipe((0,mt.takeWhile)((e=>{if("message"in e&&(null==e?void 0:e.message)){const t=e.message.data.values[2][0];if(t===Ur.Done||t===Ur.Error)return!1}return!0}),!0)).pipe((0,mt.map)((t=>{if("message"in t&&(null==t?void 0:t.message)){const n=performance.now()-c,a=t.message.data.values[0][0],i=t.message.data.values[1][0],u=t.message.data.values[2][0],d=t.message.data.values[3][0];switch(u){case Ur.Done:l=e.LoadingState.Done;break;case Ur.Streaming:l=e.LoadingState.Streaming;break;case Ur.Error:throw new Error(d)}s=[va(i,u,n),...ca(a,o,r.tableType)]}return{data:s||[],state:l}})))}(Ta(Ea({},n),{query:a}),this,r,this.instanceSettings))))}metadataRequest(e,t={}){var r=this;return Sa((function*(){return yield(0,mt.lastValueFrom)(r._request(e,t,{method:"GET",hideFromInspector:!0}))}))()}_request(r,n,a){const o=n?e.urlUtil.serializeParams(n):"",i=`${this.instanceSettings.url}${r}${o.length?`?${o}`:""}`,s=Ta(Ea({},a),{url:i});return(0,t.getBackendSrv)().fetch(s)}testDatasource(){var e=this;return Sa((function*(){const r={headers:{},method:"GET",url:`${e.instanceSettings.url}/api/echo`};return yield(0,mt.lastValueFrom)((0,t.getBackendSrv)().fetch(r).pipe(Zt((()=>(0,mt.of)({status:"success",message:"Data source successfully connected."}))),er((e=>(0,mt.of)({status:"error",message:y(e.data.message,"Unable to connect with Tempo")})))))}))()}getQueryDisplayText(e){if("nativeSearch"===e.queryType){let t=[];for(const r of["serviceName","spanName","search","minDuration","maxDuration","limit"])e.hasOwnProperty(r)&&e[r]&&t.push(`${(0,gt.startCase)(r)}: ${e[r]}`);return t.join(", ")}var t;return null!==(t=e.query)&&void 0!==t?t:""}buildSearchQuery(t,r){var n;let a=null!==(n=t.search)&&void 0!==n?n:"",o=(0,gt.pick)(t,["minDuration","maxDuration","limit"]);if(o=(0,gt.pickBy)(o,gt.identity),t.serviceName&&(a+=` service.name="${t.serviceName}"`),t.spanName&&(a+=` name="${t.spanName}"`),o.limit||(o.limit=xa),o.minDuration){var i;if(o.minDuration=this.templateSrv.replace(null!==(i=o.minDuration)&&void 0!==i?i:""),!(0,e.isValidGoDuration)(o.minDuration))throw new Error("Please enter a valid min duration.");o.minDuration=o.minDuration.replace(/\s/g,"")}if(o.maxDuration){var s;if(o.maxDuration=this.templateSrv.replace(null!==(s=o.maxDuration)&&void 0!==s?s:""),!(0,e.isValidGoDuration)(o.maxDuration))throw new Error("Please enter a valid max duration.");o.maxDuration=o.maxDuration.replace(/\s/g,"")}if(!Number.isInteger(o.limit)||o.limit<=0)throw new Error("Please enter a valid limit.");let l=Ea({tags:a},o);return r&&(l.start=r.startTime,l.end=r.endTime),l}constructor(e,r=(0,t.getTemplateSrv)()){var n;super(e),wa(this,"instanceSettings",void 0),wa(this,"templateSrv",void 0),wa(this,"tracesToLogs",void 0),wa(this,"serviceMap",void 0),wa(this,"search",void 0),wa(this,"nodeGraph",void 0),wa(this,"lokiSearch",void 0),wa(this,"traceQuery",void 0),wa(this,"uploadedJson",void 0),wa(this,"spanBar",void 0),wa(this,"languageProvider",void 0),wa(this,"tempoVersion",void 0),wa(this,"init",void 0),wa(this,"handleMetricsSummary",void 0),wa(this,"formatGroupBy",void 0),wa(this,"hasGroupBy",void 0),wa(this,"getLokiSearchDS",void 0),this.instanceSettings=e,this.templateSrv=r,this.uploadedJson=null;var a=this;this.init=Sa((function*(){const e=yield(0,mt.lastValueFrom)(a._request("/api/status/buildinfo").pipe(Ut((e=>e)),er((e=>(console.error("Failure in retrieving build information",e.data.message),(0,mt.of)({error:e,data:{version:null}}))))));a.tempoVersion=e.data.version})),this.handleMetricsSummary=(e,r,n)=>{var a,o,i;if((0,t.reportInteraction)("grafana_traces_metrics_summary_queried",{datasourceType:"tempo",app:null!==(o=n.app)&&void 0!==o?o:"",grafana_version:t.config.buildInfo.version,filterCount:null!==(i=null===(a=e.groupBy)||void 0===a?void 0:a.length)&&void 0!==i?i:0}),"{}"===r)return(0,mt.of)({error:{message:"Please ensure you do not have an empty query. This is so filters are applied and the metrics summary is not generated from all spans."},data:Hn});const s=e.groupBy?this.formatGroupBy(e.groupBy):"";return this._request("/api/metrics/summary",{q:r,groupBy:s,start:n.range.from.unix(),end:n.range.to.unix()}).pipe(Ut((e=>e.data.summaries?e.data.summaries.some((e=>e.series.length>0))?{data:Mn(e.data.summaries,r,this.instanceSettings)}:{error:{message:y("No series data. Ensure you are using an up to date version of Tempo")},data:Hn}:{error:{message:y(`No summary data for '${s}'. Note: the metrics summary API only considers spans of kind = server. You can check if the attributes exist by running a TraceQL query like { attr_key = attr_value && kind = server }`)},data:Hn})),er((e=>(0,mt.of)({error:{message:y(e.data.message)},data:Hn}))))},this.formatGroupBy=e=>null==e?void 0:e.filter((e=>e.tag)).map((e=>e.scope===Gr.Unscoped?`.${e.tag}`:e.scope!==Gr.Intrinsic?`${e.scope}.${e.tag}`:e.tag)).join(", "),this.hasGroupBy=e=>{var t;return null===(t=e.groupBy)||void 0===t?void 0:t.find((e=>e.tag))},this.getLokiSearchDS=()=>{var e,t,r;const n=!1!==(null===(e=this.tracesToLogs)||void 0===e?void 0:e.lokiSearch)&&void 0===this.lokiSearch?null===(t=this.tracesToLogs)||void 0===t?void 0:t.datasourceUid:void 0;var a;return null!==(a=null===(r=this.lokiSearch)||void 0===r?void 0:r.datasourceUid)&&void 0!==a?a:n},this.tracesToLogs=e.jsonData.tracesToLogs,this.serviceMap=e.jsonData.serviceMap,this.search=e.jsonData.search,this.nodeGraph=e.jsonData.nodeGraph,this.lokiSearch=e.jsonData.lokiSearch,this.traceQuery=e.jsonData.traceQuery,this.languageProvider=new Qn(this),(null===(n=this.search)||void 0===n?void 0:n.filters)||(this.search=Ta(Ea({},this.search),{filters:[{id:"service-name",tag:"service.name",operator:"=",scope:Gr.Resource},{id:"span-name",tag:"name",operator:"=",scope:Gr.Span}]})),this.variables=new ba(this)}}function Na(e,r){return(0,mt.from)((0,t.getDataSourceSrv)().get(r)).pipe(Zt((t=>t.query(e))))}function Ca(e,r,n,a){var o,i;return{url:"",title:e,internal:{query:{expr:r,range:!a,exemplar:!a,instant:a},datasourceUid:n,datasourceName:null!==(i=null===(o=(0,t.getDataSourceSrv)().getInstanceSettings(n))||void 0===o?void 0:o.name)&&void 0!==i?i:""}}}function _a(e,t,r,n,a,o){let i=a?`client="\${${a}}",`:"",s=`server="\${${r}}"`,l="server";if(void 0!==o){const{targetNamespace:e}=o;if(s+=`,server_service_namespace="\${${e}}"`,l+=", server_service_namespace",i){const{sourceNamespace:e}=o;i+=`client_service_namespace="\${${e}}",`,l+=", client_service_namespace"}}return{links:[Ca("Request rate",`sum by (client, ${l})(rate(${Pn}{${i}${s}}[$__rate_interval]))`,e,!1),Ca("Request histogram",`histogram_quantile(0.9, sum(rate(${jn}{${i}${s}}[$__rate_interval])) by (le, client, ${l}))`,e,!1),Ca("Failed request rate",`sum by (client, ${l})(rate(${kn}{${i}${s}}[$__rate_interval]))`,e,!1),Ra("View traces",`\${${n}}`,"",t)]}}function Ra(e,r,n,a){var o;let i={refId:"A",queryType:"traceqlSearch",filters:[]};var s;return""!==r&&i.filters.push({id:"service-name",scope:Gr.Resource,tag:"service.name",value:r,operator:"=",valueType:"string"}),""!==n&&i.filters.push({id:"span-name",scope:Gr.Span,tag:"name",value:n,operator:"=",valueType:"string"}),{url:"",title:e,internal:{query:i,datasourceUid:a,datasourceName:null!==(s=null===(o=(0,t.getDataSourceSrv)().getInstanceSettings(a))||void 0===o?void 0:o.name)&&void 0!==s?s:""}}}function Da(e){return Ta(Ea({},e),{targets:Dn.map((t=>{const{serviceMapQuery:r,serviceMapIncludeNamespace:n}=e.targets[0],a=n?", client_service_namespace, server_service_namespace":"",o=(Array.isArray(r)?r:[r]).map((e=>`sum by (client, server${a}) (rate(${t}${e||""}[$__range]))`));return{format:"table",refId:t,expr:o.join(" OR "),instant:!0}}))})}function Ia(e,t,r){var n,a;let o=null!==(a=null===(n=r.targets[0])||void 0===n?void 0:n.serviceMapQuery)&&void 0!==a?a:"";const i=(Array.isArray(o)?o:[o]).map((r=>{const n=r.match(/^{(.*)}$/);return(null==n?void 0:n.length)&&(r=n[1]),(r=r.replace("client","service").replace("server","service")).includes("span_name")?e.params.concat(r):e.params.concat(r).concat(t).filter((e=>e))})).map((t=>e.expr.replace("{}","{"+t.join(",")+"}"))).join(" OR ");return e.topk?`topk(${e.topk}, ${i})`:i}function Aa(e){return(e=e.replace("topk(5, ","").replace(" by (span_name))","")).replace("__range","__rate_interval")}function Fa(e,t){var r,n,a;const o=null!==(a=null===(n=e[0])||void 0===n||null===(r=n.fields[1])||void 0===r?void 0:r.values)&&void 0!==a?a:[];let i=[];for(let e=0;e<o.length;e++)Object.keys(t).includes(o[e])?i.push(t[o[e]].value):i.push("0");return i}function $a(e){return e.map((e=>({refId:e,expr:e,instant:!0})))}function La(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Qa(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){La(o,n,a,i,s,"next",e)}function s(e){La(o,n,a,i,s,"throw",e)}i(void 0)}))}}function qa(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class za{provideCompletionItems(e,t){var r;if(!this.monaco||!this.editor)throw new Error("provideCompletionItems called before CompletionProvider was initialized");if((null===(r=this.editor.getModel())||void 0===r?void 0:r.id)!==e.id)return{suggestions:[]};const{range:n,offset:a}=function(e,t,r){const n=t.getWordAtPosition(r),a=null!=n?e.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn}):e.Range.fromPositions(r),o={column:r.column,lineNumber:r.lineNumber};return{offset:t.getOffsetAt(o),range:a}}(this.monaco,e,t),o=this.getSituation(e.getValue(),a);return this.getCompletions(o).then((e=>{const t=e.length.toString().length;return{suggestions:e.map(((e,r)=>({kind:Ma(e.type,this.monaco),label:e.label,insertText:e.insertText,sortText:r.toString().padStart(t,"0"),range:n})))}}))}getTagValues(e){var t=this;return Qa((function*(){let r;return t.cachedValues.hasOwnProperty(e)?r=t.cachedValues[e]:(r=yield t.languageProvider.getOptionsV1(e),t.cachedValues[e]=r),r}))()}getCompletions(e){var t=this;return Qa((function*(){switch(e.type){case"UNKNOWN":return[];case"EMPTY":case"IN_NAME":return t.getTagsCompletions();case"IN_VALUE":const r=yield t.getTagValues(e.tagName),n=[],a=e=>`"${e.label}"`;return r.forEach((e=>{(null==e?void 0:e.label)&&n.push({label:e.label,insertText:a(e),type:"TAG_VALUE"})})),n;default:throw new Error(`Unexpected situation ${e}`)}}))()}getTagsCompletions(){return this.languageProvider.getAutocompleteTags().sort(((e,t)=>e.localeCompare(t,void 0,{sensitivity:"accent"}))).map((e=>({label:e,insertText:e,type:"TAG_NAME"})))}getSituation(e,t){if(""===e||0===t||" "===e[e.length-1])return{type:"EMPTY"};const r=e.substring(0,t),n=RegExp('(?<key>[^= ]+)(?<equals>=)?(?<value>([^ "]+)|"([^"]*)")?'),a=r.match(new RegExp(n,"g"));if(null==a?void 0:a.length){const e=a[a.length-1].match(n);if(e){var o,i;const t=null===(o=e.groups)||void 0===o?void 0:o.key,r=null===(i=e.groups)||void 0===i?void 0:i.equals;return t?r?{type:"IN_VALUE",tagName:t}:{type:"IN_NAME"}:{type:"EMPTY"}}}return{type:"EMPTY"}}constructor(e){qa(this,"languageProvider",void 0),qa(this,"triggerCharacters",["="," "]),qa(this,"monaco",void 0),qa(this,"editor",void 0),qa(this,"cachedValues",{}),this.languageProvider=e.languageProvider}}function Ma(e,t){switch(e){case"TAG_NAME":return t.languages.CompletionItemKind.Enum;case"KEYWORD":return t.languages.CompletionItemKind.Keyword;case"OPERATOR":return t.languages.CompletionItemKind.Operator;case"TAG_VALUE":return t.languages.CompletionItemKind.EnumMember;case"SCOPE":return t.languages.CompletionItemKind.Class;default:throw new Error(`Unexpected CompletionType: ${e}`)}}const Va={id:"tagsfield",extensions:[".tagsfield"],aliases:["tagsfield"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".tagsfield",operators:["="],symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/[a-z_.][\w./_-]*(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,"tag"],[/[a-zA-Z_.]\w*/,{cases:{"@default":"identifier"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}};function Ua(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Ba(e){const{onChange:t,onBlur:o,placeholder:i}=e,s=function(e){const t=(0,r.useRef)(new za({languageProvider:e.languageProvider}));(0,r.useEffect)((()=>{const t=(r=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ua(o,n,a,i,s,"next",e)}function s(e){Ua(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(){try{yield e.languageProvider.start()}catch(e){e instanceof Error&&ht(Ze(pt("Error",e)))}})),function(){return r.apply(this,arguments)});var r;t()}),[e]);const n=(0,r.useRef)(null);return(0,r.useEffect)((()=>()=>{var e;null===(e=n.current)||void 0===e||e.call(n)}),[]),(e,r)=>{t.current.editor=e,t.current.monaco=r;const{dispose:a}=r.languages.registerCompletionItemProvider(Wa,t.current);n.current=a}}(e.datasource),l=(0,a.useTheme2)(),c=Ya(l,i);return n().createElement(a.CodeEditor,{value:e.value,language:Wa,onBlur:o,onChange:t,containerStyles:c.queryField,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on"},onBeforeEditorMount:Xa,onEditorDidMount:(e,t)=>{s(e,t),function(e,t,r){const n=[{range:new t.Range(1,1,1,1),options:{className:r.placeholder,isWholeLine:!0}}];let a=[];const o=()=>{const t=e.getModel();if(!t)return;const r=0===t.getValueLength()?n:[];a=t.deltaDecorations(a,r)};o(),e.onDidChangeModelContent(o)}(e,t,c),function(e){const t=e.getDomNode(),r=()=>{if(t){const r=Math.min(1e3,e.getContentHeight()),n=parseInt(t.style.width,10);t.style.width=`${n}px`,t.style.height=`${r}px`,e.layout({width:n,height:r})}};e.onDidContentSizeChange(r),r()}(e)}})}let Ga=!1;const Wa="tagsfield";function Xa(e){if(!Ga){Ga=!0;const{aliases:t,extensions:r,mimetypes:n,def:a}=Va;e.languages.register({id:Wa,aliases:t,extensions:r,mimetypes:n}),e.languages.setMonarchTokensProvider(Wa,a.language),e.languages.setLanguageConfiguration(Wa,a.languageConfiguration)}}const Ya=(e,t)=>({queryField:(0,o.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,flex:1}),placeholder:(0,o.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.3}})});function Ja(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Ha(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ja(o,n,a,i,s,"next",e)}function s(e){Ja(o,n,a,i,s,"throw",e)}i(void 0)}))}}function Ka(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Za(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ka(e,t,r[t])}))}return e}function eo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const to="e.g. 1.2s, 100ms",ro=({datasource:o,query:i,onChange:s,onBlur:l,onRunQuery:c})=>{const u=(0,a.useStyles2)(no),d=(0,r.useMemo)((()=>new Qn(o)),[o]),[p,f]=(0,r.useState)(),[h,g]=(0,r.useState)(),[m,v]=(0,r.useState)(null),[y,b]=(0,r.useState)({}),[O,S]=(0,r.useState)({serviceName:!1,spanName:!1}),w=(0,r.useCallback)((E=Ha((function*(e,r=""){const n="serviceName"===e?"service.name":"name";S((t=>eo(Za({},t),{[e]:!0})));try{return(yield d.getOptionsV1(n)).filter((e=>!!e.value&&(0,a.fuzzyMatch)(e.value,r).found))}catch(e){return(0,t.isFetchError)(e)&&404===(null==e?void 0:e.status)?v(e):e instanceof Error&&ht(Ze(pt("Error",e))),[]}finally{S((t=>eo(Za({},t),{[e]:!1})))}})),function(e){return E.apply(this,arguments)}),[d]);var E;(0,r.useEffect)((()=>{const r=function(){var r=Ha((function*(){try{const[r,n]=yield Promise.all([w("serviceName"),w("spanName")]);i.serviceName&&(0,t.getTemplateSrv)().containsTemplate(i.serviceName)&&r.push((0,e.toOption)(i.serviceName)),f(r),i.spanName&&(0,t.getTemplateSrv)().containsTemplate(i.spanName)&&n.push((0,e.toOption)(i.spanName)),g(n)}catch(e){(0,t.isFetchError)(e)&&404===(null==e?void 0:e.status)?v(e):e instanceof Error&&ht(Ze(pt("Error",e)))}}));return function(){return r.apply(this,arguments)}}();r()}),[d,w,i.serviceName,i.spanName]);const T=e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&c()},x=(0,r.useCallback)((e=>{s(eo(Za({},i),{search:e}))}),[s,i]),P=(0,t.getTemplateSrv)();return n().createElement(n().Fragment,null,n().createElement("div",{className:u.container},n().createElement(a.Alert,{title:"Deprecated query type",severity:"warning"},"This query type has been deprecated and will be removed in Grafana v10.3. Please migrate to another Tempo query type."),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Service Name",labelWidth:14,grow:!0},n().createElement(a.Select,{inputId:"service",options:p,onOpenMenu:()=>{w("serviceName")},isLoading:O.serviceName,value:(null==p?void 0:p.find((e=>(null==e?void 0:e.value)===i.serviceName)))||i.serviceName,onChange:e=>{s(eo(Za({},i),{serviceName:null==e?void 0:e.value}))},placeholder:"Select a service",isClearable:!0,onKeyDown:T,"aria-label":"select-service-name",allowCustomValue:!0}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Span Name",labelWidth:14,grow:!0},n().createElement(a.Select,{inputId:"spanName",options:h,onOpenMenu:()=>{w("spanName")},isLoading:O.spanName,value:(null==h?void 0:h.find((e=>(null==e?void 0:e.value)===i.spanName)))||i.spanName,onChange:e=>{s(eo(Za({},i),{spanName:null==e?void 0:e.value}))},placeholder:"Select a span",isClearable:!0,onKeyDown:T,"aria-label":"select-span-name",allowCustomValue:!0}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Tags",labelWidth:14,grow:!0,tooltip:"Values should be in logfmt."},n().createElement(Ba,{placeholder:"http.status_code=200 error=true",value:i.search||"",onChange:x,onBlur:l,datasource:o}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Min Duration",invalid:!!y.minDuration,labelWidth:14,grow:!0},n().createElement(a.Input,{id:"minDuration",value:i.minDuration||"",placeholder:to,onBlur:()=>{var t;const r=P.replace(null!==(t=i.minDuration)&&void 0!==t?t:"");i.minDuration&&!(0,e.isValidGoDuration)(r)?b(eo(Za({},y),{minDuration:!0})):b(eo(Za({},y),{minDuration:!1}))},onChange:e=>s(eo(Za({},i),{minDuration:e.currentTarget.value})),onKeyDown:T}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Max Duration",invalid:!!y.maxDuration,labelWidth:14,grow:!0},n().createElement(a.Input,{id:"maxDuration",value:i.maxDuration||"",placeholder:to,onBlur:()=>{var t;const r=P.replace(null!==(t=i.maxDuration)&&void 0!==t?t:"");i.maxDuration&&!(0,e.isValidGoDuration)(r)?b(eo(Za({},y),{maxDuration:!0})):b(eo(Za({},y),{maxDuration:!1}))},onChange:e=>s(eo(Za({},i),{maxDuration:e.currentTarget.value})),onKeyDown:T}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Limit",invalid:!!y.limit,labelWidth:14,grow:!0,tooltip:"Maximum number of returned results"},n().createElement(a.Input,{id:"limit",value:i.limit||"",placeholder:"Default: 20",type:"number",onChange:e=>{let t=e.currentTarget.value?parseInt(e.currentTarget.value,10):void 0;t&&(!Number.isInteger(t)||t<=0)?b(eo(Za({},y),{limit:!0})):b(eo(Za({},y),{limit:!1})),s(eo(Za({},i),{limit:e.currentTarget.value?parseInt(e.currentTarget.value,10):void 0}))},onKeyDown:T})))),m?n().createElement(a.Alert,{title:"Unable to connect to Tempo search",severity:"info",className:u.alert},"Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can configure it in the ",n().createElement("a",{href:`/datasources/edit/${o.uid}`},"datasource settings"),"."):null)},no=e=>({container:(0,o.css)({maxWidth:"500px"}),alert:(0,o.css)({maxWidth:"75ch",marginTop:e.spacing(2)})});var ao=f(4586),oo=f.n(ao);f(8e3);let io=null;function so({query:t,lang:a,className:i}){const s=(0,r.useContext)(io||e.ThemeContext),l=lo(s),c=oo().highlight(t,a.grammar,a.name);return n().createElement("div",{className:(0,o.cx)(l.editorField,"prism-syntax-highlight",i),"aria-label":"selector",dangerouslySetInnerHTML:{__html:c}})}new WeakMap;const lo=e=>({editorField:(0,o.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})});var co=Object.getOwnPropertySymbols,uo=Object.prototype.hasOwnProperty,po=Object.prototype.propertyIsEnumerable;const fo=e=>{var t=e,{children:o}=t,i=((e,t)=>{var r={};for(var n in e)uo.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&co)for(var n of co(e))t.indexOf(n)<0&&po.call(e,n)&&(r[n]=e[n]);return r})(t,["children"]);const s=(0,a.useStyles2)((0,r.useCallback)((e=>ho(e,i)),[i]));return n().createElement("div",{className:s.root},o)},ho=(e,t)=>{var r,n,a;return{root:(0,o.css)({display:"flex",flexDirection:null!=(r=t.direction)?r:"row",flexWrap:null==(n=t.wrap)||n?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!=(a=t.gap)?a:2),flexGrow:t.flexGrow})}},go=({children:e})=>{const t=(0,a.useStyles2)(mo);return n().createElement("div",{className:t.root},n().createElement(fo,{gap:2},e))},mo=e=>({root:(0,o.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)})}),vo=e=>{const t=(0,a.useStyles2)((0,r.useCallback)((t=>yo(t,e)),[e]));return n().createElement("span",{className:(0,o.cx)(t.wrapper)})};vo.defaultProps={v:0,h:0,layout:"block"};const yo=(e,t)=>{var r,n;return{wrapper:(0,o.css)([{paddingRight:e.spacing(null!=(r=t.h)?r:0),paddingBottom:e.spacing(null!=(n=t.v)?n:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}};var bo=Object.defineProperty,Oo=Object.getOwnPropertySymbols,So=Object.prototype.hasOwnProperty,wo=Object.prototype.propertyIsEnumerable,Eo=(e,t,r)=>t in e?bo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const To=e=>{var t;const o=e,{label:i,optional:s,tooltip:l,tooltipInteractive:c,children:u,width:d}=o,p=((e,t)=>{var r={};for(var n in e)So.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Oo)for(var n of Oo(e))t.indexOf(n)<0&&wo.call(e,n)&&(r[n]=e[n]);return r})(o,["label","optional","tooltip","tooltipInteractive","children","width"]),f=(0,a.useStyles2)((0,r.useCallback)((e=>xo(e,d)),[d])),h=(null==p?void 0:p.htmlFor)||(null==(t=a.ReactUtils)?void 0:t.getChildId(u)),g=n().createElement(n().Fragment,null,n().createElement("label",{className:f.label,htmlFor:h},i,s&&n().createElement("span",{className:f.optional}," - optional"),l&&n().createElement(a.Tooltip,{placement:"top",content:l,theme:"info",interactive:c},n().createElement(a.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:f.icon}))),n().createElement(vo,{v:.5}));return n().createElement("div",{className:f.root},n().createElement(a.Field,((e,t)=>{for(var r in t||(t={}))So.call(t,r)&&Eo(e,r,t[r]);if(Oo)for(var r of Oo(t))wo.call(t,r)&&Eo(e,r,t[r]);return e})({className:f.field,label:g},p),u))},xo=(e,t)=>({root:(0,o.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,o.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,o.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,o.css)({marginBottom:0}),icon:(0,o.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})});var Po=function(e,t){return"boolean"==typeof t?t:!e};function ko({title:e,children:o,collapsedInfo:i,queryStats:s}){const[l,c]=(d=!1,(0,r.useReducer)(Po,d)),u=(0,a.useStyles2)(jo);var d;return n().createElement("div",{className:u.wrapper},n().createElement(a.Collapse,{className:u.collapse,collapsible:!0,isOpen:l,onToggle:c,label:n().createElement(a.Stack,{gap:0},n().createElement("h6",{className:u.title},e),!l&&n().createElement("div",{className:u.description},i.map(((e,t)=>n().createElement("span",{key:t},e)))))},n().createElement("div",{className:u.body},o)),s&&t.config.featureToggles.lokiQuerySplitting&&n().createElement(a.Tooltip,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},n().createElement(a.Icon,{tabIndex:0,name:"info-circle",className:u.tooltip,size:"sm"})),s&&n().createElement("p",{className:u.stats},No(s)))}const jo=e=>({collapse:(0,o.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,o.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,o.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,o.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,o.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,o.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,o.css)({marginRight:e.spacing(.25)})}),No=e=>e.message?e.message:`This query will process approximately ${Co(e)}.`,Co=t=>{const{text:r,suffix:n}=(0,e.getValueFormat)("bytes")(t.bytes,1);return r+n};function _o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ro(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_o(e,t,r[t])}))}return e}function Do(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Io=(e,t)=>{const r=parseInt(e,10);return isNaN(r)?t:r},Ao=n().memo((({onChange:e,query:t})=>{t.hasOwnProperty("limit")||(t.limit=xa),t.hasOwnProperty("tableType")||(t.tableType=Br.Traces);const r=[`Limit: ${t.limit||xa}`,`Spans Limit: ${t.spss||3}`,"Table Format: "+(t.tableType===Br.Traces?"Traces":"Spans")];return n().createElement(n().Fragment,null,n().createElement(go,null,n().createElement(ko,{title:"Options",collapsedInfo:r},n().createElement(To,{label:"Limit",tooltip:"Maximum number of traces to return."},n().createElement(a.AutoSizeInput,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.limit||xa,onCommitChange:r=>{e(Do(Ro({},t),{limit:Io(r.currentTarget.value,xa)}))},value:t.limit})),n().createElement(To,{label:"Span Limit",tooltip:"Maximum number of spans to return for each span set."},n().createElement(a.AutoSizeInput,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.spss||3,onCommitChange:r=>{e(Do(Ro({},t),{spss:Io(r.currentTarget.value,3)}))},value:t.spss})),n().createElement(To,{label:"Table Format",tooltip:"How the query data should be displayed in the results table"},n().createElement(a.RadioButtonGroup,{options:[{label:"Traces",value:Br.Traces},{label:"Spans",value:Br.Spans}],value:t.tableType,onChange:r=>{e(Do(Ro({},t),{tableType:r}))}})))))}));function Fo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Fo(e,t,r[t])}))}return e}function Lo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}Ao.displayName="TempoQueryBuilderOptions";const Qo=/^(\$\w+)|(\d+(?:\.\d)?\d*(?:us|s|ns|ms|s|m|h))$/,qo=()=>({noBoxShadow:(0,o.css)({boxShadow:"none","*:focus":{boxShadow:"none"}})}),zo=({filter:e,operators:t,updateFilter:r})=>{const o=(0,a.useStyles2)(qo);let i=!1;return"string"==typeof e.value&&(i=!!e.value&&!Qo.test(e.value.concat(""))),n().createElement(a.HorizontalGroup,{spacing:"none"},n().createElement(a.Select,{className:o.noBoxShadow,inputId:`${e.id}-operator`,options:t.map(hn),value:e.operator,onChange:t=>{r(Lo($o({},e),{operator:null==t?void 0:t.value}))},isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),n().createElement(a.Input,{className:o.noBoxShadow,value:e.value,onChange:t=>{r(Lo($o({},e),{value:t.currentTarget.value}))},placeholder:"e.g. 100ms, 1.2s","aria-label":`select ${e.id} value`,invalid:i,width:18}))};var Mo=Object.defineProperty,Vo=Object.defineProperties,Uo=Object.getOwnPropertyDescriptors,Bo=Object.getOwnPropertySymbols,Go=Object.prototype.hasOwnProperty,Wo=Object.prototype.propertyIsEnumerable,Xo=(e,t,r)=>t in e?Mo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Yo=e=>{var t=e,{className:r}=t,i=((e,t)=>{var r={};for(var n in e)Go.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Bo)for(var n of Bo(e))t.indexOf(n)<0&&Wo.call(e,n)&&(r[n]=e[n]);return r})(t,["className"]);const s=(0,a.useStyles2)(Jo);return n().createElement(a.Button,((e,t)=>Vo(e,Uo(t)))(((e,t)=>{for(var r in t||(t={}))Go.call(t,r)&&Xo(e,r,t[r]);if(Bo)for(var r of Bo(t))Wo.call(t,r)&&Xo(e,r,t[r]);return e})({},i),{className:(0,o.cx)(r,s.button)}))},Jo=e=>({button:(0,o.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})}),Ho=({label:e,tooltip:t,children:r})=>n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:e,labelWidth:28,grow:!0,tooltip:t},r));function Ko(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ko(e,t,r[t])}))}return e}function ei(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ti=e=>{var t;const{datasource:o,onChange:i,query:s,isTagsLoading:l}=e,c=(0,a.useStyles2)(ri),u=()=>(0,lt.c)().slice(0,8);(0,r.useEffect)((()=>{s.groupBy&&0!==s.groupBy.length||i(ei(Zo({},s),{groupBy:[{id:u(),scope:Gr.Span}]}))}),[i,s]);const d=e=>o.languageProvider.getMetricsSummaryTags(e.scope),p=e=>{var t;const r=Zo({},s);(t=r).groupBy||(t.groupBy=[]);const n=r.groupBy.findIndex((t=>t.id===e.id));n>=0?r.groupBy=fn(r.groupBy,n,e):r.groupBy.push(e),i(r)},f=Object.values(Gr).map((e=>({label:e,value:e})));return n().createElement(Ho,{label:"Aggregate by",tooltip:"Select one or more tags to see the metrics summary. Note: the metrics summary API only considers spans of kind = server."},n().createElement(n().Fragment,null,null===(t=s.groupBy)||void 0===t?void 0:t.map(((e,t)=>{var r,o,h,g,m;return n().createElement("div",{key:e.id},n().createElement(a.HorizontalGroup,{spacing:"none",width:"auto"},n().createElement(a.Select,{"aria-label":`Select scope for filter ${t+1}`,onChange:t=>{p(ei(Zo({},e),{scope:null==t?void 0:t.value,tag:""}))},options:f,placeholder:"Select scope",value:e.scope}),n().createElement(a.Select,{"aria-label":`Select tag for filter ${t+1}`,isClearable:!0,isLoading:l,key:e.tag,onChange:t=>{p(ei(Zo({},e),{tag:null==t?void 0:t.value}))},options:null===(r=d(e))||void 0===r?void 0:r.map((e=>({label:e,value:e}))),placeholder:"Select tag",value:e.tag||""}),(e.tag||(null!==(g=null===(o=s.groupBy)||void 0===o?void 0:o.length)&&void 0!==g?g:0)>1)&&n().createElement(Yo,{"aria-label":`Remove tag for filter ${t+1}`,icon:"times",onClick:()=>(e=>{var t;i(ei(Zo({},s),{groupBy:null===(t=s.groupBy)||void 0===t?void 0:t.filter((t=>t.id!==e.id))}))})(e),tooltip:"Remove tag",title:`Remove tag for filter ${t+1}`,variant:"secondary"}),e.tag&&t===(null!==(m=null===(h=s.groupBy)||void 0===h?void 0:h.length)&&void 0!==m?m:0)-1&&n().createElement("span",{className:c.addTag},n().createElement(Yo,{"aria-label":"Add tag",icon:"plus",onClick:()=>{p({id:u(),scope:Gr.Span})},tooltip:"Add tag",variant:"secondary"}))))}))))},ri=e=>({addTag:(0,o.css)({marginLeft:e.spacing(1)})});function ni(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function ai(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ai(e,t,r[t])}))}return e}function ii(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const si=()=>({dropdown:(0,o.css)({boxShadow:"none"})}),li=({filter:e,datasource:o,updateFilter:s,isTagsLoading:l,tags:c,setError:u,hideScope:d,hideTag:p,hideValue:f,query:h})=>{var g;const m=(0,a.useStyles2)(si),v=(0,r.useMemo)((()=>cn(e)),[e]),[y,b]=(0,r.useState)(e.operator),[O,S]=(0,r.useState)(e.value),w=(E=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){ni(o,n,a,i,s,"next",e)}function s(e){ni(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(){try{return e.tag?yield o.languageProvider.getOptionsV2(v,h):[]}catch(e){(0,t.isFetchError)(e)&&404===(null==e?void 0:e.status)?u(e):e instanceof Error&&ht(Ze(pt("Error",e)))}return[]})),function(){return E.apply(this,arguments)});var E;const{loading:T,value:x}=(0,i.c)(w,[v,o.languageProvider,u,h]);e.value&&!Array.isArray(e.value)&&x&&!x.find((t=>t.value===e.value))&&x.push({label:e.value.toString(),value:e.value.toString(),type:e.valueType}),(0,r.useEffect)((()=>{Array.isArray(e.value)&&e.value.length>1&&"=~"!==e.operator&&"!~"!==e.operator&&(b(e.operator),s(ii(oi({},e),{operator:"=~"}))),Array.isArray(e.value)&&e.value.length<=1&&((null==O?void 0:O.length)||0)>1&&s(ii(oi({},e),{operator:y,value:e.value[0]}))}),[O,y,s,e]),(0,r.useEffect)((()=>{S(e.value)}),[e.value]);const P=Object.values(Gr).filter((e=>e!==Gr.Intrinsic)).map((e=>({label:e,value:e}))),k=null==x?void 0:x.filter((e=>{var t;return e.type===(null===(t=x[0])||void 0===t?void 0:t.type)})),j=(null==x?void 0:x.length)===(null==k?void 0:k.length)?null==x||null===(g=x[0])||void 0===g?void 0:g.type:void 0;let N=Yr;switch(j){case"keyword":N=Jr;break;case"string":N=Hr;break;case"int":case"float":N=Kr}const C=e=>[...e||[],...(0,t.getTemplateSrv)().getVariables().map((e=>({label:`$${e.name}`,value:`$${e.name}`})))];return n().createElement(a.HorizontalGroup,{spacing:"none",width:"auto"},!d&&n().createElement(a.Select,{className:m.dropdown,inputId:`${e.id}-scope`,options:C(P),value:e.scope,onChange:t=>{s(ii(oi({},e),{scope:null==t?void 0:t.value}))},placeholder:"Select scope","aria-label":`select ${e.id} scope`}),!p&&n().createElement(a.Select,{className:m.dropdown,inputId:`${e.id}-tag`,isLoading:l,options:C((void 0!==e.tag?(0,gt.uniq)([e.tag,...c]):c).map((e=>({label:e,value:e})))),value:e.tag,onChange:t=>{s(ii(oi({},e),{tag:null==t?void 0:t.value}))},placeholder:"Select tag",isClearable:!0,"aria-label":`select ${e.id} tag`,allowCustomValue:!0}),n().createElement(a.Select,{className:m.dropdown,inputId:`${e.id}-operator`,options:C(N.map(hn)),value:e.operator,onChange:t=>{s(ii(oi({},e),{operator:null==t?void 0:t.value}))},isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),!f&&n().createElement(a.Select,{className:m.dropdown,inputId:`${e.id}-value`,isLoading:T,options:C(x),value:e.value,onChange:t=>{var r;Array.isArray(t)?s(ii(oi({},e),{value:t.map((e=>e.value)),valueType:(null===(r=t[0])||void 0===r?void 0:r.type)||j})):s(ii(oi({},e),{value:null==t?void 0:t.value,valueType:(null==t?void 0:t.type)||j}))},placeholder:"Select value",isClearable:!1,"aria-label":`select ${e.id} value`,allowCustomValue:!0,isMulti:!0,allowCreateWhileLoading:!0}))},ci=e=>({vertical:(0,o.css)({display:"flex",flexDirection:"column",gap:e.spacing(.25)}),horizontal:(0,o.css)({display:"flex",flexDirection:"row",gap:e.spacing(1)}),addTag:(0,o.css)({marginLeft:e.spacing(1)})}),ui=({updateFilter:e,deleteFilter:t,filters:o,datasource:i,setError:s,staticTags:l,isTagsLoading:c,hideValues:u,requireTagAndValue:d,query:p})=>{const f=(0,a.useStyles2)(ci),h=(0,r.useCallback)((()=>e({id:(0,lt.c)().slice(0,8),operator:"=",scope:Gr.Span})),[e]);(0,r.useEffect)((()=>{(null==o?void 0:o.length)||h()}),[o,h]);const g=e=>((e,t)=>[...Zr,...e].filter((e=>!t.includes(e))))(i.languageProvider.getTags(e.scope),l),m=e=>d?e.tag&&e.value&&e.value.length>0:e.tag;return n().createElement("div",{className:f.vertical},null==o?void 0:o.map(((r,a)=>n().createElement("div",{className:f.horizontal,key:r.id},n().createElement(li,{filter:r,datasource:i,setError:s,updateFilter:e,tags:g(r),isTagsLoading:c,hideValue:u,query:p}),(m(r)||o.length>1)&&n().createElement(Yo,{"aria-label":`Remove tag with ID ${r.id}`,variant:"secondary",icon:"times",onClick:()=>null==t?void 0:t(r),tooltip:"Remove tag"}),m(r)&&a===o.length-1&&n().createElement("span",{className:f.addTag},n().createElement(Yo,{"aria-label":"Add tag",variant:"secondary",icon:"plus",onClick:h,tooltip:"Add tag"}))))))};function di(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function pi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){pi(e,t,r[t])}))}return e}function hi(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const gi=["min-duration","max-duration","status"],mi=({datasource:e,query:o,onChange:i,onClearResults:s,app:l})=>{var c,u,d,p,f,h;const g=(0,a.useStyles2)(vi),[m,v]=(0,r.useState)(null),[y,b]=(0,r.useState)(!0),[O,S]=(0,r.useState)(""),w=(0,t.getTemplateSrv)(),E=(0,r.useCallback)((e=>{var t;const r=fi({},o);(t=r).filters||(t.filters=[]);const n=r.filters.findIndex((t=>t.id===e.id));n>=0?r.filters=fn(r.filters,n,e):r.filters.push(e),i(r)}),[i,o]);(0,r.useEffect)((()=>{S(an(o.filters||[]))}),[o]);const T=(0,r.useCallback)((e=>{var t;return null===(t=o.filters)||void 0===t?void 0:t.find((t=>t.id===e))}),[o.filters]);(0,r.useEffect)((()=>{const t=(r=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){di(o,n,a,i,s,"next",e)}function s(e){di(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(){try{yield e.languageProvider.start(),b(!1)}catch(e){e instanceof Error&&ht(Ze(pt("Error",e)))}})),function(){return r.apply(this,arguments)});var r;t()}),[e]),(0,r.useEffect)((()=>{var t,r;null===(r=e.search)||void 0===r||null===(t=r.filters)||void 0===t||t.filter((e=>e.value)).forEach((e=>{T(e.id)||E(e)}))}),[null===(c=e.search)||void 0===c?void 0:c.filters,T,E]);const x=(null===(d=e.search)||void 0===d||null===(u=d.filters)||void 0===u?void 0:u.map((e=>e.tag)))||[];x.push("duration"),x.push("traceDuration");const P=(o.filters||[]).filter((t=>{var r,n;return!gi.includes(t.id)&&-1===((null===(n=e.search)||void 0===n||null===(r=n.filters)||void 0===r?void 0:r.findIndex((e=>e.id===t.id)))||0)&&"duration-type"!==t.id}));var k;return n().createElement(n().Fragment,null,n().createElement("div",{className:g.container},n().createElement("div",null,null===(f=e.search)||void 0===f||null===(p=f.filters)||void 0===p?void 0:p.map((t=>t.tag&&n().createElement(Ho,{key:t.id,label:un(t),tooltip:`Filter your search by ${cn(t)}. To modify the default filters shown for search visit the Tempo datasource configuration page.`},n().createElement(li,{filter:T(t.id)||t,datasource:e,setError:v,updateFilter:E,tags:[],hideScope:!0,hideTag:!0,query:O})))),n().createElement(Ho,{label:"Status"},n().createElement(li,{filter:T("status")||{id:"status",tag:"status",scope:Gr.Intrinsic,operator:"="},datasource:e,setError:v,updateFilter:E,tags:[],hideScope:!0,hideTag:!0,query:O})),n().createElement(Ho,{label:"Duration",tooltip:"The trace or span duration, i.e. end - start time of the trace/span. Accepted units are ns, ms, s, m, h"},n().createElement(a.HorizontalGroup,{spacing:"none"},n().createElement(a.Select,{options:[{label:"span",value:"span"},{label:"trace",value:"trace"}],value:null!==(k=null===(h=T("duration-type"))||void 0===h?void 0:h.value)&&void 0!==k?k:"span",onChange:e=>{const t=T("duration-type")||{id:"duration-type",value:"span"};E(hi(fi({},t),{value:null==e?void 0:e.value}))},"aria-label":"duration type"}),n().createElement(zo,{filter:T("min-duration")||{id:"min-duration",tag:"duration",operator:">",valueType:"duration"},operators:[">",">="],updateFilter:E}),n().createElement(zo,{filter:T("max-duration")||{id:"max-duration",tag:"duration",operator:"<",valueType:"duration"},operators:["<","<="],updateFilter:E}))),n().createElement(Ho,{label:"Tags"},n().createElement(ui,{filters:P,datasource:e,setError:v,updateFilter:E,deleteFilter:e=>{i(hi(fi({},o),{filters:o.filters.filter((t=>t.id!==e.id))}))},staticTags:x,isTagsLoading:y,query:O,requireTagAndValue:!0})),t.config.featureToggles.metricsSummary&&n().createElement(ti,{datasource:e,onChange:i,query:o,isTagsLoading:y})),n().createElement("div",{className:g.rawQueryContainer},n().createElement(so,{query:w.replace(O),lang:{grammar:nn,name:"traceql"}}),n().createElement(a.Button,{variant:"secondary",size:"sm",onClick:()=>{(0,t.reportInteraction)("grafana_traces_copy_to_traceql_clicked",{app:null!=l?l:"",grafana_version:t.config.buildInfo.version,location:"search_tab"}),s();const e=an(o.filters||[]);i(hi(fi({},o),{query:e,queryType:"traceql"}))}},"Edit in TraceQL")),n().createElement(Ao,{onChange:i,query:o})),m?n().createElement(a.Alert,{title:"Unable to connect to Tempo search",severity:"info",className:g.alert},"Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can configure it in the ",n().createElement("a",{href:`/datasources/edit/${e.uid}`},"datasource settings"),"."):null)},vi=e=>({alert:(0,o.css)({maxWidth:"75ch",marginTop:e.spacing(2)}),container:(0,o.css)({display:"flex",gap:"4px",flexWrap:"wrap",flexDirection:"column"}),rawQueryContainer:(0,o.css)({alignItems:"center",backgroundColor:e.colors.background.secondary,display:"flex",justifyContent:"space-between",padding:e.spacing(1)})});function yi(e){return yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yi(e)}function bi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oi(e){var t=function(e,t){if("object"!=yi(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=yi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==yi(t)?t:String(t)}function Si(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Oi(n.key),n)}}function wi(e,t,r){return t&&Si(e.prototype,t),r&&Si(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ei(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ti(e,t){return Ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ti(e,t)}function xi(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ti(e,t)}function Pi(e,t){if(t&&("object"===yi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ei(e)}function ki(e){return ki=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ki(e)}function ji(e,t,r){return(t=Oi(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ni(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ci(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ci(Object(r),!0).forEach((function(t){ji(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ci(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ri={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},Di=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};bi(this,e),this.init(t,r)}return wi(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||Ri,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,r,n){return n&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(r).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,_i(_i({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}}]),e}(),Ii=new Di,Ai=function(){function e(){bi(this,e),this.observers={}}return wi(e,[{key:"on",value:function(e,t){var r=this;return e.split(" ").forEach((function(e){r.observers[e]=r.observers[e]||[],r.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,r)})),this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(r))}))}}]),e}();function Fi(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.resolve=e,r.reject=t,r}function $i(e){return null==e?"":""+e}function Li(e,t,r){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function a(){return!e||"string"==typeof e}for(var o="string"!=typeof t?[].concat(t):t.split(".");o.length>1;){if(a())return{};var i=n(o.shift());!e[i]&&r&&(e[i]=new r),e=Object.prototype.hasOwnProperty.call(e,i)?e[i]:{}}return a()?{}:{obj:e,k:n(o.shift())}}function Qi(e,t,r){var n=Li(e,t,Object);n.obj[n.k]=r}function qi(e,t){var r=Li(e,t),n=r.obj,a=r.k;if(n)return n[a]}function zi(e,t,r){var n=qi(e,r);return void 0!==n?n:qi(t,r)}function Mi(e,t,r){for(var n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?"string"==typeof e[n]||e[n]instanceof String||"string"==typeof t[n]||t[n]instanceof String?r&&(e[n]=t[n]):Mi(e[n],t[n],r):e[n]=t[n]);return e}function Vi(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var Ui={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function Bi(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return Ui[e]})):e}var Gi="undefined"!=typeof window&&window.navigator&&void 0===window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,Wi=[" ",",","?","!",";"];function Xi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Yi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xi(Object(r),!0).forEach((function(t){ji(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ji(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var n=t.split(r),a=e,o=0;o<n.length;++o){if(!a)return;if("string"==typeof a[n[o]]&&o+1<n.length)return;if(void 0===a[n[o]]){for(var i=2,s=n.slice(o,o+i).join(r),l=a[s];void 0===l&&n.length>o+i;)i++,l=a[s=n.slice(o,o+i).join(r)];if(void 0===l)return;if(null===l)return null;if(t.endsWith(s)){if("string"==typeof l)return l;if(s&&"string"==typeof l[s])return l[s]}var c=n.slice(o+i).join(r);return c?Ji(l,c,r):void 0}a=a[n[o]]}return a}}var Hi=function(e){xi(a,e);var t,r,n=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=ki(t);if(r){var a=ki(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return Pi(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return bi(this,a),t=n.call(this),Gi&&Ai.call(Ei(t)),t.data=e||{},t.options=r,void 0===t.options.keySeparator&&(t.options.keySeparator="."),void 0===t.options.ignoreJSONStructure&&(t.options.ignoreJSONStructure=!0),t}return wi(a,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,o=void 0!==n.ignoreJSONStructure?n.ignoreJSONStructure:this.options.ignoreJSONStructure,i=[e,t];r&&"string"!=typeof r&&(i=i.concat(r)),r&&"string"==typeof r&&(i=i.concat(a?r.split(a):r)),e.indexOf(".")>-1&&(i=e.split("."));var s=qi(this.data,i);return s||!o||"string"!=typeof r?s:Ji(this.data&&this.data[e]&&this.data[e][t],r,a)}},{key:"addResource",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},o=this.options.keySeparator;void 0===o&&(o=".");var i=[e,t];r&&(i=i.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(n=t,t=(i=e.split("."))[1]),this.addNamespaces(t),Qi(this.data,i,n),a.silent||this.emit("added",e,t,r,n)}},{key:"addResources",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var a in r)"string"!=typeof r[a]&&"[object Array]"!==Object.prototype.toString.apply(r[a])||this.addResource(e,t,a,r[a],{silent:!0});n.silent||this.emit("added",e,t,r)}},{key:"addResourceBundle",value:function(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},i=[e,t];e.indexOf(".")>-1&&(n=r,r=t,t=(i=e.split("."))[1]),this.addNamespaces(t);var s=qi(this.data,i)||{};n?Mi(s,r,a):s=Yi(Yi({},s),r),Qi(this.data,i,s),o.silent||this.emit("added",e,t,r)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?Yi(Yi({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),a}(Ai),Ki={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,r,n,a){var o=this;return e.forEach((function(e){o.processors[e]&&(t=o.processors[e].process(t,r,n,a))})),t}};function Zi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function es(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zi(Object(r),!0).forEach((function(t){ji(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ts={},rs=function(e){xi(a,e);var t,r,n=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=ki(t);if(r){var a=ki(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return Pi(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return bi(this,a),t=n.call(this),Gi&&Ai.call(Ei(t)),function(e,t,r){["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach((function(e){t[e]&&(r[e]=t[e])}))}(0,e,Ei(t)),t.options=r,void 0===t.options.keySeparator&&(t.options.keySeparator="."),t.logger=Ii.create("translator"),t}return wi(a,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var r=this.resolve(e,t);return r&&void 0!==r.res}},{key:"extractFromKey",value:function(e,t){var r=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===r&&(r=":");var n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,a=t.ns||this.options.defaultNS||[],o=r&&e.indexOf(r)>-1,i=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||function(e,t,r){t=t||"",r=r||"";var n=Wi.filter((function(e){return t.indexOf(e)<0&&r.indexOf(e)<0}));if(0===n.length)return!0;var a=new RegExp("(".concat(n.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),o=!a.test(e);if(!o){var i=e.indexOf(r);i>0&&!a.test(e.substring(0,i))&&(o=!0)}return o}(e,r,n));if(o&&!i){var s=e.match(this.interpolator.nestingRegexp);if(s&&s.length>0)return{key:e,namespaces:a};var l=e.split(r);(r!==n||r===n&&this.options.ns.indexOf(l[0])>-1)&&(a=l.shift()),e=l.join(n)}return"string"==typeof a&&(a=[a]),{key:e,namespaces:a}}},{key:"translate",value:function(e,t,r){var n=this;if("object"!==yi(t)&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var o=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,s=this.extractFromKey(e[e.length-1],t),l=s.key,c=s.namespaces,u=c[c.length-1],d=t.lng||this.language,p=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d&&"cimode"===d.toLowerCase()){if(p){var f=t.nsSeparator||this.options.nsSeparator;return o?(h.res="".concat(u).concat(f).concat(l),h):"".concat(u).concat(f).concat(l)}return o?(h.res=l,h):l}var h=this.resolve(e,t),g=h&&h.res,m=h&&h.usedKey||l,v=h&&h.exactUsedKey||l,y=Object.prototype.toString.apply(g),b=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,O=!this.i18nFormat||this.i18nFormat.handleAsObject;if(O&&g&&"string"!=typeof g&&"boolean"!=typeof g&&"number"!=typeof g&&["[object Number]","[object Function]","[object RegExp]"].indexOf(y)<0&&("string"!=typeof b||"[object Array]"!==y)){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var S=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,g,es(es({},t),{},{ns:c})):"key '".concat(l," (").concat(this.language,")' returned an object instead of string.");return o?(h.res=S,h):S}if(i){var w="[object Array]"===y,E=w?[]:{},T=w?v:m;for(var x in g)if(Object.prototype.hasOwnProperty.call(g,x)){var P="".concat(T).concat(i).concat(x);E[x]=this.translate(P,es(es({},t),{joinArrays:!1,ns:c})),E[x]===P&&(E[x]=g[x])}g=E}}else if(O&&"string"==typeof b&&"[object Array]"===y)(g=g.join(b))&&(g=this.extendTranslation(g,e,t,r));else{var k=!1,j=!1,N=void 0!==t.count&&"string"!=typeof t.count,C=a.hasDefaultValue(t),_=N?this.pluralResolver.getSuffix(d,t.count,t):"",R=t["defaultValue".concat(_)]||t.defaultValue;!this.isValidLookup(g)&&C&&(k=!0,g=R),this.isValidLookup(g)||(j=!0,g=l);var D=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&j?void 0:g,I=C&&R!==g&&this.options.updateMissing;if(j||k||I){if(this.logger.log(I?"updateKey":"missingKey",d,u,l,I?R:g),i){var A=this.resolve(l,es(es({},t),{},{keySeparator:!1}));A&&A.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var F=[],$=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&$&&$[0])for(var L=0;L<$.length;L++)F.push($[L]);else"all"===this.options.saveMissingTo?F=this.languageUtils.toResolveHierarchy(t.lng||this.language):F.push(t.lng||this.language);var Q=function(e,r,a){var o=C&&a!==g?a:D;n.options.missingKeyHandler?n.options.missingKeyHandler(e,u,r,o,I,t):n.backendConnector&&n.backendConnector.saveMissing&&n.backendConnector.saveMissing(e,u,r,o,I,t),n.emit("missingKey",e,u,r,g)};this.options.saveMissing&&(this.options.saveMissingPlurals&&N?F.forEach((function(e){n.pluralResolver.getSuffixes(e,t).forEach((function(r){Q([e],l+r,t["defaultValue".concat(r)]||R)}))})):Q(F,l,R))}g=this.extendTranslation(g,e,t,h,r),j&&g===l&&this.options.appendNamespaceToMissingKey&&(g="".concat(u,":").concat(l)),(j||k)&&this.options.parseMissingKeyHandler&&(g="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(u,":").concat(l):l,k?g:void 0):this.options.parseMissingKeyHandler(g))}return o?(h.res=g,h):g}},{key:"extendTranslation",value:function(e,t,r,n,a){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,es(es({},this.options.interpolation.defaultVariables),r),n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init(es(es({},r),{interpolation:es(es({},this.options.interpolation),r.interpolation)}));var i,s="string"==typeof e&&(r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(s){var l=e.match(this.interpolator.nestingRegexp);i=l&&l.length}var c=r.replace&&"string"!=typeof r.replace?r.replace:r;if(this.options.interpolation.defaultVariables&&(c=es(es({},this.options.interpolation.defaultVariables),c)),e=this.interpolator.interpolate(e,c,r.lng||this.language,r),s){var u=e.match(this.interpolator.nestingRegexp);i<(u&&u.length)&&(r.nest=!1)}!1!==r.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return a&&a[0]===n[0]&&!r.context?(o.logger.warn("It seems you are nesting recursively key: ".concat(n[0]," in key: ").concat(t[0])),null):o.translate.apply(o,n.concat([t]))}),r)),r.interpolation&&this.interpolator.reset()}var d=r.postProcess||this.options.postProcess,p="string"==typeof d?[d]:d;return null!=e&&p&&p.length&&!1!==r.applyPostProcessor&&(e=Ki.handle(p,e,t,this.options&&this.options.postProcessPassResolved?es({i18nResolved:n},r):r,this)),e}},{key:"resolve",value:function(e){var t,r,n,a,o,i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!i.isValidLookup(t)){var l=i.extractFromKey(e,s),c=l.key;r=c;var u=l.namespaces;i.options.fallbackNS&&(u=u.concat(i.options.fallbackNS));var d=void 0!==s.count&&"string"!=typeof s.count,p=d&&!s.ordinal&&0===s.count&&i.pluralResolver.shouldUseIntlApi(),f=void 0!==s.context&&("string"==typeof s.context||"number"==typeof s.context)&&""!==s.context,h=s.lngs?s.lngs:i.languageUtils.toResolveHierarchy(s.lng||i.language,s.fallbackLng);u.forEach((function(e){i.isValidLookup(t)||(o=e,!ts["".concat(h[0],"-").concat(e)]&&i.utils&&i.utils.hasLoadedNamespace&&!i.utils.hasLoadedNamespace(o)&&(ts["".concat(h[0],"-").concat(e)]=!0,i.logger.warn('key "'.concat(r,'" for languages "').concat(h.join(", "),'" won\'t get resolved as namespace "').concat(o,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach((function(r){if(!i.isValidLookup(t)){a=r;var o,l=[c];if(i.i18nFormat&&i.i18nFormat.addLookupKeys)i.i18nFormat.addLookupKeys(l,c,r,e,s);else{var u;d&&(u=i.pluralResolver.getSuffix(r,s.count,s));var h="".concat(i.options.pluralSeparator,"zero");if(d&&(l.push(c+u),p&&l.push(c+h)),f){var g="".concat(c).concat(i.options.contextSeparator).concat(s.context);l.push(g),d&&(l.push(g+u),p&&l.push(g+h))}}for(;o=l.pop();)i.isValidLookup(t)||(n=o,t=i.getResource(r,e,o,s))}})))}))}})),{res:t,usedKey:r,exactUsedKey:n,usedLng:a,usedNS:o}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,r,n):this.resourceStore.getResource(e,t,r,n)}}],[{key:"hasDefaultValue",value:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}]),a}(Ai);function ns(e){return e.charAt(0).toUpperCase()+e.slice(1)}var as=function(){function e(t){bi(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ii.create("languageUtils")}return wi(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],r=e.split("-");return this.options.lowerCaseLng?r=r.map((function(e){return e.toLowerCase()})):2===r.length?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=ns(r[1].toLowerCase()))):3===r.length&&(r[0]=r[0].toLowerCase(),2===r[1].length&&(r[1]=r[1].toUpperCase()),"sgn"!==r[0]&&2===r[2].length&&(r[2]=r[2].toUpperCase()),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=ns(r[1].toLowerCase())),t.indexOf(r[2].toLowerCase())>-1&&(r[2]=ns(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,r=this;return e?(e.forEach((function(e){if(!t){var n=r.formatLanguageCode(e);r.options.supportedLngs&&!r.isSupportedCode(n)||(t=n)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var n=r.getLanguagePartFromCode(e);if(r.isSupportedCode(n))return t=n;t=r.options.supportedLngs.find((function(e){if(0===e.indexOf(n))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}},{key:"toResolveHierarchy",value:function(e,t){var r=this,n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),a=[],o=function(e){e&&(r.isSupportedCode(e)?a.push(e):r.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&o(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&o(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&o(this.getLanguagePartFromCode(e))):"string"==typeof e&&o(this.formatLanguageCode(e)),n.forEach((function(e){a.indexOf(e)<0&&o(r.formatLanguageCode(e))})),a}}]),e}(),os=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],is={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},ss=["v1","v2","v3"],ls={zero:0,one:1,two:2,few:3,many:4,other:5},cs=function(){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};bi(this,e),this.languageUtils=t,this.options=n,this.logger=Ii.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(r={},os.forEach((function(e){e.lngs.forEach((function(t){r[t]={numbers:e.nr,plurals:is[e.fc]}}))})),r)}return wi(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getRule(e,t);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,r).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,r);return n?this.shouldUseIntlApi()?n.resolvedOptions().pluralCategories.sort((function(e,t){return ls[e]-ls[t]})).map((function(e){return"".concat(t.options.prepend).concat(e)})):n.numbers.map((function(n){return t.getSuffix(e,n,r)})):[]}},{key:"getSuffix",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.getRule(e,r);return n?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(n.select(t)):this.getSuffixRetroCompatible(n,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var r=this,n=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),a=e.numbers[n];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===a?a="plural":1===a&&(a=""));var o=function(){return r.options.prepend&&a.toString()?r.options.prepend+a.toString():a.toString()};return"v1"===this.options.compatibilityJSON?1===a?"":"number"==typeof a?"_plural_".concat(a.toString()):o():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?o():this.options.prepend&&n.toString()?this.options.prepend+n.toString():n.toString()}},{key:"shouldUseIntlApi",value:function(){return!ss.includes(this.options.compatibilityJSON)}}]),e}();function us(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ds(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?us(Object(r),!0).forEach((function(t){ji(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):us(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ps=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};bi(this,e),this.logger=Ii.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return wi(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:Bi,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?Vi(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?Vi(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?Vi(t.nestingPrefix):t.nestingPrefixEscaped||Vi("$t("),this.nestingSuffix=t.nestingSuffix?Vi(t.nestingSuffix):t.nestingSuffixEscaped||Vi(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var r="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(r,"g")}},{key:"interpolate",value:function(e,t,r,n){var a,o,i,s=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function c(e){return e.replace(/\$/g,"$$$$")}var u=function(e){if(e.indexOf(s.formatSeparator)<0){var a=zi(t,l,e);return s.alwaysFormat?s.format(a,void 0,r,ds(ds(ds({},n),t),{},{interpolationkey:e})):a}var o=e.split(s.formatSeparator),i=o.shift().trim(),c=o.join(s.formatSeparator).trim();return s.format(zi(t,l,i),c,r,ds(ds(ds({},n),t),{},{interpolationkey:i}))};this.resetRegExp();var d=n&&n.missingInterpolationHandler||this.options.missingInterpolationHandler,p=n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return c(e)}},{regex:this.regexp,safeValue:function(e){return s.escapeValue?c(s.escape(e)):c(e)}}].forEach((function(t){for(i=0;a=t.regex.exec(e);){var r=a[1].trim();if(void 0===(o=u(r)))if("function"==typeof d){var l=d(e,a,n);o="string"==typeof l?l:""}else if(n&&n.hasOwnProperty(r))o="";else{if(p){o=a[0];continue}s.logger.warn("missed to pass in variable ".concat(r," for interpolating ").concat(e)),o=""}else"string"==typeof o||s.useRawValueToEscape||(o=$i(o));var c=t.safeValue(o);if(e=e.replace(a[0],c),p?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=a[0].length):t.regex.lastIndex=0,++i>=s.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var r,n,a=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=ds({},o);function s(e,t){var r=this.nestingOptionsSeparator;if(e.indexOf(r)<0)return e;var n=e.split(new RegExp("".concat(r,"[ ]*{"))),a="{".concat(n[1]);e=n[0];var o=(a=this.interpolate(a,i)).match(/'/g),s=a.match(/"/g);(o&&o.length%2==0&&!s||s.length%2!=0)&&(a=a.replace(/'/g,'"'));try{i=JSON.parse(a),t&&(i=ds(ds({},t),i))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(r).concat(a)}return delete i.defaultValue,e}for(i.applyPostProcessor=!1,delete i.defaultValue;r=this.nestingRegexp.exec(e);){var l=[],c=!1;if(-1!==r[0].indexOf(this.formatSeparator)&&!/{.*}/.test(r[1])){var u=r[1].split(this.formatSeparator).map((function(e){return e.trim()}));r[1]=u.shift(),l=u,c=!0}if((n=t(s.call(this,r[1].trim(),i),i))&&r[0]===e&&"string"!=typeof n)return n;"string"!=typeof n&&(n=$i(n)),n||(this.logger.warn("missed to resolve ".concat(r[1]," for nesting ").concat(e)),n=""),c&&(n=l.reduce((function(e,t){return a.format(e,t,o.lng,ds(ds({},o),{},{interpolationkey:r[1].trim()}))}),n.trim())),e=e.replace(r[0],n),this.regexp.lastIndex=0}return e}}]),e}();function fs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function hs(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fs(Object(r),!0).forEach((function(t){ji(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function gs(e){var t={};return function(r,n,a){var o=n+JSON.stringify(a),i=t[o];return i||(i=e(n,a),t[o]=i),i(r)}}var ms=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};bi(this,e),this.logger=Ii.create("formatter"),this.options=t,this.formats={number:gs((function(e,t){var r=new Intl.NumberFormat(e,t);return function(e){return r.format(e)}})),currency:gs((function(e,t){var r=new Intl.NumberFormat(e,hs(hs({},t),{},{style:"currency"}));return function(e){return r.format(e)}})),datetime:gs((function(e,t){var r=new Intl.DateTimeFormat(e,hs({},t));return function(e){return r.format(e)}})),relativetime:gs((function(e,t){var r=new Intl.RelativeTimeFormat(e,hs({},t));return function(e){return r.format(e,t.range||"day")}})),list:gs((function(e,t){var r=new Intl.ListFormat(e,hs({},t));return function(e){return r.format(e)}}))},this.init(t)}return wi(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"addCached",value:function(e,t){this.formats[e.toLowerCase().trim()]=gs(t)}},{key:"format",value:function(e,t,r,n){var a=this,o=t.split(this.formatSeparator).reduce((function(e,t){var o=function(e){var t=e.toLowerCase().trim(),r={};if(e.indexOf("(")>-1){var n=e.split("(");t=n[0].toLowerCase().trim();var a=n[1].substring(0,n[1].length-1);"currency"===t&&a.indexOf(":")<0?r.currency||(r.currency=a.trim()):"relativetime"===t&&a.indexOf(":")<0?r.range||(r.range=a.trim()):a.split(";").forEach((function(e){if(e){var t=function(e){if(Array.isArray(e))return e}(o=e.split(":"))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return Ni(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ni(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=t[0],a=t.slice(1).join(":").trim().replace(/^'+|'+$/g,"");r[n.trim()]||(r[n.trim()]=a),"false"===a&&(r[n.trim()]=!1),"true"===a&&(r[n.trim()]=!0),isNaN(a)||(r[n.trim()]=parseInt(a,10))}var o}))}return{formatName:t,formatOptions:r}}(t),i=o.formatName,s=o.formatOptions;if(a.formats[i]){var l=e;try{var c=n&&n.formatParams&&n.formatParams[n.interpolationkey]||{},u=c.locale||c.lng||n.locale||n.lng||r;l=a.formats[i](e,u,hs(hs(hs({},s),n),c))}catch(e){a.logger.warn(e)}return l}return a.logger.warn("there was no format function for ".concat(i)),e}),e);return o}}]),e}();function vs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ys(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vs(Object(r),!0).forEach((function(t){ji(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var bs=function(e){xi(a,e);var t,r,n=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=ki(t);if(r){var a=ki(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return Pi(this,e)});function a(e,t,r){var o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return bi(this,a),o=n.call(this),Gi&&Ai.call(Ei(o)),o.backend=e,o.store=t,o.services=r,o.languageUtils=r.languageUtils,o.options=i,o.logger=Ii.create("backendConnector"),o.waitingReads=[],o.maxParallelReads=i.maxParallelReads||10,o.readingCalls=0,o.maxRetries=i.maxRetries>=0?i.maxRetries:5,o.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,o.state={},o.queue=[],o.backend&&o.backend.init&&o.backend.init(r,i.backend,i),o}return wi(a,[{key:"queueLoad",value:function(e,t,r,n){var a=this,o={},i={},s={},l={};return e.forEach((function(e){var n=!0;t.forEach((function(t){var s="".concat(e,"|").concat(t);!r.reload&&a.store.hasResourceBundle(e,t)?a.state[s]=2:a.state[s]<0||(1===a.state[s]?void 0===i[s]&&(i[s]=!0):(a.state[s]=1,n=!1,void 0===i[s]&&(i[s]=!0),void 0===o[s]&&(o[s]=!0),void 0===l[t]&&(l[t]=!0)))})),n||(s[e]=!0)})),(Object.keys(o).length||Object.keys(i).length)&&this.queue.push({pending:i,pendingCount:Object.keys(i).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(o),pending:Object.keys(i),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(e,t,r){var n=e.split("|"),a=n[0],o=n[1];t&&this.emit("failedLoading",a,o,t),r&&this.store.addResourceBundle(a,o,r),this.state[e]=t?-1:2;var i={};this.queue.forEach((function(r){!function(e,t,r,n){var a=Li(e,t,Object),o=a.obj,i=a.k;o[i]=o[i]||[],o[i].push(r)}(r.loaded,[a],o),function(e,t){void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)}(r,e),t&&r.errors.push(t),0!==r.pendingCount||r.done||(Object.keys(r.loaded).forEach((function(e){i[e]||(i[e]={});var t=r.loaded[e];t.length&&t.forEach((function(t){void 0===i[e][t]&&(i[e][t]=!0)}))})),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())})),this.emit("loaded",i),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,r){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,i=arguments.length>5?arguments[5]:void 0;return e.length?this.readingCalls>=this.maxParallelReads?void this.waitingReads.push({lng:e,ns:t,fcName:r,tried:a,wait:o,callback:i}):(this.readingCalls++,this.backend[r](e,t,(function(s,l){if(n.readingCalls--,n.waitingReads.length>0){var c=n.waitingReads.shift();n.read(c.lng,c.ns,c.fcName,c.tried,c.wait,c.callback)}s&&l&&a<n.maxRetries?setTimeout((function(){n.read.call(n,e,t,r,a+1,2*o,i)}),o):i(s,l)}))):i(null,{})}},{key:"prepareLoading",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var o=this.queueLoad(e,t,n,a);if(!o.toLoad.length)return o.pending.length||a(),null;o.toLoad.forEach((function(e){r.loadOne(e)}))}},{key:"load",value:function(e,t,r){this.prepareLoading(e,t,{},r)}},{key:"reload",value:function(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}},{key:"loadOne",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.split("|"),a=n[0],o=n[1];this.read(a,o,"read",void 0,void 0,(function(n,i){n&&t.logger.warn("".concat(r,"loading namespace ").concat(o," for language ").concat(a," failed"),n),!n&&i&&t.logger.log("".concat(r,"loaded namespace ").concat(o," for language ").concat(a),i),t.loaded(e,n,i)}))}},{key:"saveMissing",value:function(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(r,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=r&&""!==r&&(this.backend&&this.backend.create&&this.backend.create(e,t,r,n,null,ys(ys({},o),{},{isUpdate:a})),e&&e[0]&&this.store.addResource(e[0],t,r,n))}}]),a}(Ai);function Os(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function Ss(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ws(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ss(Object(r),!0).forEach((function(t){ji(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ss(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Es(){}var Ts=function(e){xi(a,e);var t,r,n=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=ki(t);if(r){var a=ki(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return Pi(this,e)});function a(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;if(bi(this,a),e=n.call(this),Gi&&Ai.call(Ei(e)),e.options=Os(r),e.services={},e.logger=Ii,e.modules={external:[]},t=Ei(e),Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach((function(e){"function"==typeof t[e]&&(t[e]=t[e].bind(t))})),o&&!e.isInitialized&&!r.isClone){if(!e.options.initImmediate)return e.init(r,o),Pi(e,Ei(e));setTimeout((function(){e.init(r,o)}),0)}return e}return wi(a,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;"function"==typeof t&&(r=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var n={debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===yi(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===yi(e[2])||"object"===yi(e[3])){var r=e[3]||e[2];Object.keys(r).forEach((function(e){t[e]=r[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,r,n){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}};function a(e){return e?"function"==typeof e?new e:e:null}if(this.options=ws(ws(ws({},n),this.options),Os(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=ws(ws({},n.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var o;this.modules.logger?Ii.init(a(this.modules.logger),this.options):Ii.init(null,this.options),this.modules.formatter?o=this.modules.formatter:"undefined"!=typeof Intl&&(o=ms);var i=new as(this.options);this.store=new Hi(this.options.resources,this.options);var s=this.services;s.logger=Ii,s.resourceStore=this.store,s.languageUtils=i,s.pluralResolver=new cs(i,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!o||this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format||(s.formatter=a(o),s.formatter.init(s,this.options),this.options.interpolation.format=s.formatter.format.bind(s.formatter)),s.interpolator=new ps(this.options),s.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},s.backendConnector=new bs(a(this.modules.backend),s.resourceStore,s,this.options),s.backendConnector.on("*",(function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];e.emit.apply(e,[t].concat(n))})),this.modules.languageDetector&&(s.languageDetector=a(this.modules.languageDetector),s.languageDetector.init(s,this.options.detection,this.options)),this.modules.i18nFormat&&(s.i18nFormat=a(this.modules.i18nFormat),s.i18nFormat.init&&s.i18nFormat.init(this)),this.translator=new rs(this.services,this.options),this.translator.on("*",(function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];e.emit.apply(e,[t].concat(n))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,r||(r=Es),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var r;return(r=e.store)[t].apply(r,arguments)}})),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var r;return(r=e.store)[t].apply(r,arguments),e}}));var c=Fi(),u=function(){var t=function(t,n){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),c.resolve(n),r(t,n)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),c}},{key:"loadResources",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Es,n="string"==typeof e?e:this.language;if("function"==typeof e&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(n&&"cimode"===n.toLowerCase())return r();var a=[],o=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){a.indexOf(e)<0&&a.push(e)}))};n?o(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return o(e)})),this.options.preload&&this.options.preload.forEach((function(e){return o(e)})),this.services.backendConnector.load(a,this.options.ns,(function(e){e||t.resolvedLanguage||!t.language||t.setResolvedLanguage(t.language),r(e)}))}else r(null)}},{key:"reloadResources",value:function(e,t,r){var n=Fi();return e||(e=this.languages),t||(t=this.options.ns),r||(r=Es),this.services.backendConnector.reload(e,t,(function(e){n.resolve(),r(e)})),n}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&Ki.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}},{key:"changeLanguage",value:function(e,t){var r=this;this.isLanguageChangingTo=e;var n=Fi();this.emit("languageChanging",e);var a=function(e){r.language=e,r.languages=r.services.languageUtils.toResolveHierarchy(e),r.resolvedLanguage=void 0,r.setResolvedLanguage(e)},o=function(o){e||o||!r.services.languageDetector||(o=[]);var i="string"==typeof o?o:r.services.languageUtils.getBestMatchFromCodes(o);i&&(r.language||a(i),r.translator.language||r.translator.changeLanguage(i),r.services.languageDetector&&r.services.languageDetector.cacheUserLanguage(i)),r.loadResources(i,(function(e){!function(e,o){o?(a(o),r.translator.changeLanguage(o),r.isLanguageChangingTo=void 0,r.emit("languageChanged",o),r.logger.log("languageChanged",o)):r.isLanguageChangingTo=void 0,n.resolve((function(){return r.t.apply(r,arguments)})),t&&t(e,(function(){return r.t.apply(r,arguments)}))}(e,i)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(o):o(e):o(this.services.languageDetector.detect()),n}},{key:"getFixedT",value:function(e,t,r){var n=this,a=function e(t,a){var o;if("object"!==yi(a)){for(var i=arguments.length,s=new Array(i>2?i-2:0),l=2;l<i;l++)s[l-2]=arguments[l];o=n.options.overloadTranslationOptionHandler([t,a].concat(s))}else o=ws({},a);o.lng=o.lng||e.lng,o.lngs=o.lngs||e.lngs,o.ns=o.ns||e.ns,o.keyPrefix=o.keyPrefix||r||e.keyPrefix;var c=n.options.keySeparator||".",u=o.keyPrefix?"".concat(o.keyPrefix).concat(c).concat(t):t;return n.t(u,o)};return"string"==typeof e?a.lng=e:a.lngs=e,a.ns=t,a.keyPrefix=r,a}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var n=this.resolvedLanguage||this.languages[0],a=!!this.options&&this.options.fallbackLng,o=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;var i=function(e,r){var n=t.services.backendConnector.state["".concat(e,"|").concat(r)];return-1===n||2===n};if(r.precheck){var s=r.precheck(this,i);if(void 0!==s)return s}return!(!this.hasResourceBundle(n,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!i(n,e)||a&&!i(o,e)))}},{key:"loadNamespaces",value:function(e,t){var r=this,n=Fi();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){r.options.ns.indexOf(e)<0&&r.options.ns.push(e)})),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var r=Fi();"string"==typeof e&&(e=[e]);var n=this.options.preload||[],a=e.filter((function(e){return n.indexOf(e)<0}));return a.length?(this.options.preload=n.concat(a),this.loadResources((function(e){r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){return e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),e?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr":"rtl"}},{key:"cloneInstance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Es,n=ws(ws(ws({},this.options),t),{isClone:!0}),o=new a(n);return void 0===t.debug&&void 0===t.prefix||(o.logger=o.logger.clone(t)),["store","services","language"].forEach((function(t){o[t]=e[t]})),o.services=ws({},this.services),o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o.translator=new rs(o.services,o.options),o.translator.on("*",(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];o.emit.apply(o,[e].concat(r))})),o.init(n,r),o.translator.options=o.options,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),a}(Ai);ji(Ts,"createInstance",(function(){return new Ts(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}));var xs=Ts.createInstance();xs.createInstance=Ts.createInstance,xs.createInstance,xs.init,xs.loadResources,xs.reloadResources,xs.use,xs.changeLanguage,xs.getFixedT,xs.t,xs.exists,xs.setDefaultNamespace,xs.hasLoadedNamespace,xs.loadNamespaces,xs.loadLanguages;const Ps=xs;function ks(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function js(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){ks(o,n,a,i,s,"next",e)}function s(e){ks(o,n,a,i,s,"throw",e)}i(void 0)}))}}const Ns=({datasource:e,onChange:t,disabled:r,filterKey:o,allFilters:i})=>null===o?n().createElement("div",{className:"gf-form","data-testid":"AdHocFilterKey-add-key-wrapper"},n().createElement(a.SegmentAsync,{disabled:r,className:"query-segment-key",Component:Rs,value:o,onChange:t,loadOptions:()=>Ds(e,o,i),inputMinWidth:90})):n().createElement("div",{className:"gf-form","data-testid":"AdHocFilterKey-key-wrapper"},n().createElement(a.SegmentAsync,{disabled:r,className:"query-segment-key",value:o,onChange:t,loadOptions:()=>As(e,o,i),inputMinWidth:90})),Cs="-- remove filter --",_s={label:Cs,value:Cs},Rs=n().createElement("span",{className:"gf-form-label query-part","aria-label":"Add Filter"},n().createElement(a.Icon,{name:"plus"})),Ds=(Is=js((function*(e,r,n){const a=yield(0,t.getDataSourceSrv)().get(e);if(!a||!a.getTagKeys)return[];const o=n.filter((e=>e.key!==r));return(yield a.getTagKeys({filters:o})).map((e=>({label:e.text,value:e.text})))})),function(e,t,r){return Is.apply(this,arguments)});var Is;const As=function(){var e=js((function*(e,t,r){const n=yield Ds(e,t,r);return[_s,...n]}));return function(t,r,n){return e.apply(this,arguments)}}();function Fs(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}const $s=({datasource:e,disabled:t,onChange:r,filterKey:o,filterValue:i,placeHolder:s,allFilters:l})=>n().createElement("div",{className:"gf-form","data-testid":"AdHocFilterValue-value-wrapper"},n().createElement(a.SegmentAsync,{className:"query-segment-value",disabled:t,placeholder:s,value:i,onChange:r,loadOptions:()=>Ls(e,o,l)})),Ls=function(){var r=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Fs(o,n,a,i,s,"next",e)}function s(e){Fs(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(r,n,a){const o=yield(0,t.getDataSourceSrv)().get(r);if(!o||!o.getTagValues)return[];const i=(0,e.getDefaultTimeRange)(),s=a.filter((e=>e.key!==n));return(yield o.getTagValues({key:n,filters:s,timeRange:i})).map((e=>({label:e.text,value:e.text})))}));return function(e,t,n){return r.apply(this,arguments)}}(),Qs=["=","!=","<",">","=~","!~"].map((e=>({label:e,value:e}))),qs=({value:e,disabled:t,onChange:r})=>n().createElement(a.Segment,{className:"query-segment-operator",value:e,disabled:t,options:Qs,onChange:r}),zs=({datasource:e,filter:{key:t,operator:r,value:a},onKeyChange:o,onOperatorChange:i,onValueChange:s,placeHolder:l,allFilters:c,disabled:u})=>n().createElement(n().Fragment,null,n().createElement(Ns,{disabled:u,datasource:e,filterKey:t,onChange:o,allFilters:c}),n().createElement("div",{className:"gf-form"},n().createElement(qs,{disabled:u,value:r,onChange:i})),n().createElement($s,{disabled:u,datasource:e,filterKey:t,filterValue:a,allFilters:c,onChange:s,placeHolder:l})),Ms=Ps.t,Vs=({datasource:e,appendBefore:t,onCompleted:a,allFilters:o})=>{const[i,s]=(0,r.useState)(null),[l,c]=(0,r.useState)("="),u=(0,r.useCallback)((e=>{var t;e.value===Cs?s(null):s(null!==(t=e.value)&&void 0!==t?t:"")}),[s]),d=(0,r.useCallback)((e=>{var t;return c(null!==(t=e.value)&&void 0!==t?t:"")}),[c]),p=(0,r.useCallback)((e=>{var t;a({value:null!==(t=e.value)&&void 0!==t?t:"",operator:l,key:i}),s(null),c("=")}),[a,l,i]);return null===i?n().createElement(Ns,{datasource:e,filterKey:i,onChange:u,allFilters:o}):n().createElement(n().Fragment,{key:"filter-builder"},t,n().createElement(zs,{datasource:e,filter:{key:i,value:"",operator:l},placeHolder:("variable.adhoc.placeholder","Select value",Ms("variable.adhoc.placeholder","Select value",undefined)),onKeyChange:u,onOperatorChange:d,onValueChange:p,allFilters:o}))},Us=({label:e})=>n().createElement("div",{className:"gf-form"},n().createElement("span",{className:"gf-form-label query-keyword"},e));function Bs(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Gs extends r.PureComponent{render(){const{filters:e,disabled:t}=this.props;return n().createElement("div",{className:"gf-form-inline"},this.renderFilters(e,t),!t&&n().createElement(Vs,{datasource:this.props.datasource,appendBefore:e.length>0?n().createElement(Us,{label:"AND"}):null,onCompleted:this.appendFilterToVariable,allFilters:this.getAllFilters()}))}getAllFilters(){return this.props.baseFilters?this.props.baseFilters.concat(this.props.filters):this.props.filters}renderFilters(e,t){return 0===e.length&&t?n().createElement(a.Segment,{disabled:t,value:"No filters",options:[],onChange:()=>{}}):e.reduce(((e,r,a)=>(e.length>0&&e.push(n().createElement(Us,{label:"AND",key:`condition-${a}`})),e.push(this.renderFilterSegments(r,a,t)),e)),[])}renderFilterSegments(e,t,r){return n().createElement(n().Fragment,{key:`filter-${t}`},n().createElement(zs,{disabled:r,datasource:this.props.datasource,filter:e,onKeyChange:this.onChange(t,"key"),onOperatorChange:this.onChange(t,"operator"),onValueChange:this.onChange(t,"value"),allFilters:this.getAllFilters()}))}constructor(...e){super(...e),Bs(this,"onChange",((e,t)=>r=>{const{filters:n}=this.props,{value:a}=r;return r.value===Cs?this.props.removeFilter(e):this.props.changeFilter(e,(o=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Bs(e,t,r[t])}))}return e}({},n[e]),i=null!=(i={[t]:a})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(i)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})),o));var o,i})),Bs(this,"appendFilterToVariable",(e=>{this.props.addFilter(e)}))}}function Ws(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Xs(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ys(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Xs(e,t,r[t])}))}return e}function Js(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Hs({graphDatasourceUid:e,query:t,onChange:o}){const s=(0,a.useStyles2)(el),l=(0,i.c)((()=>b(e)),[e]),[c,u]=(0,r.useState)(void 0);if((0,r.useEffect)((()=>{function e(){return e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ws(o,n,a,i,s,"next",e)}function s(e){Ws(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(e){const t=yield e.getTagKeys({filters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_server_seconds_sum|traces_service_graph_request_total|traces_service_graph_request_failed_total",condition:""}]});u(Boolean(t.length))})),e.apply(this,arguments)}!l.loading&&l.value&&function(t){e.apply(this,arguments)}(l.value)}),[l]),l.loading)return null;const d=l.value;if(!e)return Ks("No service graph datasource selected","Please set up a service graph datasource in the datasource settings",s);if(e&&!d)return Ks("No service graph data found","Service graph datasource is configured but the data source no longer exists. Please configure existing data source to use the service graph functionality",s);const p=function(e){let t,r=[];const n=/([\w_]+)(=|!=|<|>|=~|!~)"(.*?)"/g;for(;null!==(t=n.exec(e));)r.push({key:t[1],operator:t[2],value:t[3],condition:""});return r}((Array.isArray(t.serviceMapQuery)?t.serviceMapQuery[0]:t.serviceMapQuery)||"");return n().createElement("div",null,n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Filter",labelWidth:14,grow:!0},n().createElement(Gs,{datasource:{uid:e},filters:p,baseFilters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_total|traces_spanmetrics_calls_total",condition:""}],addFilter:e=>{o(Js(Ys({},t),{serviceMapQuery:Zs([...p,e])}))},removeFilter:e=>{const r=[...p];r.splice(e,1),o(Js(Ys({},t),{serviceMapQuery:Zs(r)}))},changeFilter:(e,r)=>{const n=[...p];n.splice(e,1,r),o(Js(Ys({},t),{serviceMapQuery:Zs(n)}))}}))),!1===c?Ks("No service graph data found","Please ensure that service graph metrics are set up correctly",s):null)}function Ks(e,t,r){return n().createElement(a.Alert,{title:e,severity:"info",className:r.alert},t," according to the"," ",n().createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://grafana.com/docs/grafana/latest/datasources/tempo/service-graph/",className:r.link},"Tempo documentation"),".")}function Zs(e){return`{${e.map((e=>`${e.key}${e.operator}"${e.value}"`)).join(",")}}`}const el=e=>({alert:(0,o.css)({maxWidth:"75ch",marginTop:e.spacing(2)}),link:(0,o.css)({color:e.colors.text.link,textDecoration:"underline"})}),tl={};var rl,nl;!function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.INTERNAL=1]="INTERNAL",e[e.SERVER=2]="SERVER",e[e.CLIENT=3]="CLIENT",e[e.PRODUCER=4]="PRODUCER",e[e.CONSUMER=5]="CONSUMER"}(rl||(rl={})),function(e){e[e.Error=7e3]="Error",e[e.Info=3e3]="Info",e[e.Success=3e3]="Success",e[e.Warning=5e3]="Warning"}(nl||(nl={}));const al={error:7e3,info:3e3,success:3e3,warning:5e3},ol=e=>{const t=(i=(0,a.useTheme2)(),(0,o.css)({position:"absolute",zIndex:i.zIndex.portal,top:0,right:10}));var i;const[s,l]=(0,r.useState)(!1),[c,u]=(0,r.useState)();return(0,r.useEffect)((()=>()=>{c&&clearTimeout(c)}),[c]),(0,r.useEffect)((()=>{if(""!==e.text){l(!0);const t=setTimeout((()=>{l(!1)}),al[e.severity]);u(t)}}),[e.severity,e.text]),n().createElement(n().Fragment,null,s&&n().createElement(a.Alert,{className:t,elevated:!0,title:e.text,severity:e.severity}))};var il=f(4916);const sl=il.oF.deserialize({version:14,states:"/YO]QPOOP!^OPOOO]QPO'#CkO#QQPO'#CjO%eQQO'#ClOOQO'#DP'#DPOOQO'#DO'#DOO%lQPO'#DOO%qQSO'#C{OOQO'#C|'#C|O%yQPO'#C|O&UQPO'#DRO&ZQPO'#DSO&`QSO'#DUOOQO'#Cj'#CjQ&eQPOOOOQO'#C`'#C`P'SO!bO'#C^POOO)C>})C>}O'_QPO,59VO'fQSO,59hO'qQPO,59TO(cQPO,58zO(jQPO,59VO(jQPO,59VO(jQPO,59VO(jQPO,59VO(jQPO,59VO(jQPO,59VO(jQPO,59VOOQO'#Co'#CoOOQO'#Cu'#CuO(oQWO'#CuO)WQ`O'#CwO)]QPO'#CwO#[QQO'#CmO)bQWO,59WO#[QQO'#CmOOQO'#Cm'#CmOOQO,59W,59WO#[QQO,59jO)pQPO,59hO)pQPO,59gOOQO,59h,59hO#[QQO,59mO#[QQO,59nOOQO,59p,59pO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zPOOO'#DV'#DVP*eO!bO,58xPOOO,58x,58xOOQO1G.q1G.qOOQO1G/S1G/SOOQO1G.o1G.oOOQO1G.f1G.fO(jQPO'#CkO+bQPO1G.qO,ZQPO1G.qO,bQPO1G.qO-ZQPO1G.qO-bQPO1G.qO-iQPO1G.qO-pQ`O,59cOOQO,59c,59cO-{Q`O,59cO.QQWO,59XO#[QQO,59XO#[QQO,59XO#[QQO,59XOOQO1G.r1G.rO.`QWO,59XO.tQWO1G/UO)pQPO'#C|O/SQpO1G/RO/zQWO1G/XO0YQWO'#DTO0kQPO1G/YO1eQPO1G.fO2^QPO1G.fO2eQPO1G.fO3^QPO1G.fO3eQPO1G.fO3lQPO1G.fO4eQPO1G.fO4lQPO1G.fPOOO-E7T-E7TPOOO1G.d1G.dO4sQPO,59VOOQO1G.}1G.}O5_QPO1G.}OOQO1G.s1G.sO5uQWO1G.sO5|QWO1G.sOOQO7+$p7+$pO6TQSO,59hOOQO7+$s7+$sO#[QQO,59oOOQO7+$t7+$tO6]Q`O7+$iO6bQWO1G/ZOOQO<<HT<<HT",stateData:"7Q~O|OSPOS}PQ~OeXOfXOgXOhXO!RQO!USO!WYO!pUO!qTO!rTO!sTO!tTO!uZO!v[O!x]O~O}aO~OTgOUhOVjOWiOXkOYlO!TmOZ^X[^X~Oz^X!S^X~P!cOdnOenOfnOgnOhnOjpOmrOnrO!RsO!WuO!XuO!YnO!ZnO![nO!]nO!^nO!_nO!`nO!anO!bnO!cnO!dnO!enO!foO!goO!hoO!ioO!joO!koO!loO!moO!noO!oqO~O!VwO~P#[O!RxO~OqyOtzO~Oe{Of{Og{O~O!R|O~O!R}O~O!y!OO~OT!POU!QOV!ROW!SOX!TOY!UOZ!WO[!XO!T!VO~O!O!YO!P!YO!Q![O~O!S!]O~P!cOqyOtzO!S!^O~O!S!_OTSXUSXVSXWSXXSXYSXZSX[SX!TSX~O!S!`O~P&eO!R!aO~O!o!hOTiXYiXbiX!ViX!SiX!wiX~Ol!iO~O!o!jO~OT!mOY!nOb!lO!V!oO~OeXOfXOgXOhXO!R!rO!WYO!pUO!qTO!rTO!sTO!tTO~O!O!YO!P!YO!Q#QO~OUhOVjOWiOXkO!TmOY_iZ_i[_iz_i!S_i~OT_i~P*pOUhOT_iV_iX_iY_iZ_i[_iz_i!T_i!S_i~OW_i~P+iOWiO~P+iOUhOVjOWiOT_iY_iZ_i[_iz_i!T_i!S_i~OX_i~P,iOTgO~P*pOXkO~P,iOl#SOm#TOn#TO~Ol#SO~OT!mOY!nOb!lO!S#UO~OT!mOY!nOb!lO!Vaa!Saa!waa~OT!mOY!nOb!lO!S#XO~OqyOToiUoiVoiWoiXoiYoiZoi[oizoi!Toi!Soi~OT!mOY!nOb!lO!S#ZO~OT!mOY!nOb!lO!SwX!wwX~O!S#]O!w#[O~OU!QOV!ROW!SOX!TO!T!VOYSiZSi[SizSi!SSi~OTSi~P0sOU!QOTSiVSiXSiYSiZSi[SizSi!TSi!SSi~OW!SO~P1lOWSi~P1lOU!QOV!ROW!SOTSiYSiZSi[SizSi!TSi!SSi~OXSi~P2lOT!PO~P0sOX!TO~P2lOT!POU!QOV!ROW!SOX!TOY!UO!T!VO[SizSi!SSi~OZSi~P3sOZ!WO~P3sOTgOUhOVjOWiOXkOYlO!S!]O!TmO~O!o#^O~Ob!lOYai!Vai!Sai!wai~OTai~P5dOT!mO~P5dOqyO!S!^O~Ol#`O~OT!mOY!nOb!lO!Swi!wwi~OgfePqbjmjnln~",goto:"&tzPP{P!OPPPPPPPP!q#O#_$W$eP%TPPPPP%TP%TPPP$W%aP%y&ZP$W$W&k$W&nRbPQ_OQfQQ!`!QQ!w!PQ!x!RQ!y!SQ!z!TQ!{!UQ!|!VQ!}!WR#O!Xg`OQ!P!Q!R!S!T!U!V!W!Xd`O!P!Q!R!S!T!U!V!W!XReQdRO!P!Q!R!S!T!U!V!W!XQcQQ!]hQ!bgQ!ciQ!djQ!ekQ!flQ!gmR#R!ag^OQ!P!Q!R!S!T!U!V!W!XQtSQ!ksQ!puQ!qxQ!t|Q!u}Q#U!lQ#V!mQ#W!nR#_#[evSsux|}!l!m!n#[dWO!P!Q!R!S!T!U!V!W!XQdQQ!^yQ!szR#Y!rmXOQyz!P!Q!R!S!T!U!V!W!X!rmVOQyz!P!Q!R!S!T!U!V!W!X!rR!v}Q!ZaR#P!Z",nodeNames:" LineComment BlockComment TraceQL SpansetPipelineExpression And Gt Desc Lt Anc Or Pipe ExperimentalOp WrappedSpansetPipeline SpansetPipeline SpansetExpression SpansetFilter FieldExpression FieldOp Static String Integer Float Duration TemplateVariable IntrinsicField Parent AttributeField Identifier Resource Span ScalarFilter ScalarExpression ScalarOp Aggregate AggregateExpression ComparisonOp GroupOperation SelectOperation SelectArgs CoalesceOperation",maxTerm:87,skippedNodes:[0,1,2,41],repeatNodeCount:1,tokenData:"%*Q~R!`X^%Tpq%Tqr%xrs'Qst(dtu*juv2cvw3_wx(dxy3jyz3wz{2c{|2c|}3|}!O4R!O!P4[!P!Q4a!Q![5[![!](d!]!^(d!^!_7O!_!`7d!`!a7n!a!b(d!b!c(d!c!}(d#Q#R8S#R#S(d#S#T8Z#T#U<c#U#V?X#V#WAP#W#X!1P#X#Y!8k#Y#Z!=]#Z#](d#]#^!A}#^#_(d#_#`!Ii#`#a(d#a#b!M]#b#c#$P#c#d#)q#d#e#+i#e#f(d#f#g#7{#g#h$!u#h#i$<p#i#j$KO#j#o(d#o#p%)b#p#q%)g#q#r%)t#r#s%)y#y#z%T$f$g%T#BY#BZ%T$IS$I_%T$I|$JO%T$JT$JU%T$KV$KW%T&FU&FV%T~%YY|~X^%Tpq%T#y#z%T$f$g%T#BY#BZ%T$IS$I_%T$I|$JO%T$JT$JU%T$KV$KW%T&FU&FV%T#Q%}S!XS!^!_&Z!_!`&h!`!a&o#r#s&w!d&`P[!d!^!_&c!d&hO[!dh&oOtWb`!d&tP[!d!`!a&c!|'QOtW[!db`t'TVOr'Qrs'js#O'Q#O#P*Z#P;'S'Q;'S;=`*d<%lO'Qt'qZdSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dp(iZlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dp)_VOr)[rs(ds#O)[#O#P)t#P;'S)[;'S;=`)}<%lO)[p)wQrs)[#O#P)[p*QP;=`<%l)[p*WP;=`<%l(dt*^Qrs'Q#O#P'Qt*gP;=`<%l'Qv*oelpOp(drs,Qst,jtu,juv,jwx,jz|,j}![(d![!],j!]!^,j!a!b,j!b!c,j!c!},j!}#Q(d#R#S,j#S#T,j#T#o,j#o#p-y#s;'S(d;'S;=`*T<%lO(dv,TVOr,Qrs,js#O,Q#O#P-j#P;'S,Q;'S;=`-s<%lO,Qv,qZhUlpOp,jrs,Qsv,jwx,jz|,j}!^,j!a#Q,j#R#o,j#s;'S,j;'S;=`-d<%lO,jv-gP;=`<%l,jv-mQrs,Q#O#P,Qv-vP;=`<%l,Qv-|^rs.xst/btu/buv/bwx/bz|/b![!]/b!]!^/b!a!b/b!b!c/b!c!}/b#R#S/b#S#T/b#T#o/bv.{VOr.xrs/bs#O.x#O#P2S#P;'S.x;'S;=`2]<%lO.xv/e^Op/brs.xsv/bwx/bz|/b}![/b![!]0a!]!^/b!a#Q/b#R#o/b#q#r1u#s;'S/b;'S;=`1|<%lO/bv0deOp/brs.xsv/bwx/bz|/b}!O/b!O!P0a!P!Q/b!Q![0a![!]0a!]!^/b!a!c/b!c!}0a!}#Q/b#R#S0a#S#T/b#T#o0a#q#r1u#s;'S/b;'S;=`1|<%lO/bv1|OhUlpv2PP;=`<%l/bv2VQrs.x#O#P.xv2`P;=`<%l.x#l2lZq!jb`lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~3bPvw3e~3jOT~^3oP!RUyz3rW3wO!yW~3|O!S~~4RO!w~#Q4[O!WUq!jb`~4aO!o~~4hQq!jb`z{4n!P!Q4s~4sO}~~4xSP~OY4sZ;'S4s;'S;=`5U<%lO4s~5XP;=`<%l4s~5aWe~!O!P5y!Q![5[#[#]6k#a#b6p#b#c6x#g#h6k#i#j6x${$|6x~5|P!Q![6P~6UVf~!Q![6P#[#]6k#a#b6p#b#c6x#g#h6k#i#j6x${$|6x~6pOg~~6uPg~#g#h6k~6{P#g#h6k!|7XQtWW!db`!^!_7_!_!`&h!d7dOX!dh7kPtWb`#r#s&h!|7wQtWU!db`!_!`&h!`!a7}!d8SOV!d!z8ZOq!jb`t8`dlpOp8Zpr9nrs:]sv8Zvw9nwx8Zxz9nz|8Z|}9n}!^8Z!^!a9n!a#Q8Z#Q#R9n#R#S8Z#S#T'j#T#o8Z#o#s9n#s;'S8Z;'S;=`<]<%lO8ZS9qTO#S9n#S#T:Q#T;'S9n;'S;=`:V<%lO9nS:VOdSS:YP;=`<%l9nt:`XOr:]rs8Zs#O:]#O#P:{#P#S:]#S#T;k#T;'S:];'S;=`<V<%lO:]t;OXOr9nrs:]s#O9n#O#P:]#P#S9n#S#T:Q#T;'S9n;'S;=`:V<%lO9nt;pVdSOr)[rs(ds#O)[#O#P)t#P;'S)[;'S;=`)}<%lO)[t<YP;=`<%l:]t<`P;=`<%l8Zr<h]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k=a#k#o(d#s;'S(d;'S;=`*T<%lO(dr=f]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Z(d#Z#[>_#[#o(d#s;'S(d;'S;=`*T<%lO(dr>fZ!sQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr?^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#m(d#m#n@V#n#o(d#s;'S(d;'S;=`*T<%lO(dr@^Z!uQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dvAUalpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#[(d#[#]BZ#]#`(d#`#aJs#a#c(d#c#d! e#d#o(d#s;'S(d;'S;=`*T<%lO(dtB`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^CX#^#o(d#s;'S(d;'S;=`*T<%lO(dtC^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#aDV#a#o(d#s;'S(d;'S;=`*T<%lO(dtD[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#XET#X#o(d#s;'S(d;'S;=`*T<%lO(dtEY]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!e(d!e!fFR!f#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dtFW]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#dGP#d#o(d#s;'S(d;'S;=`*T<%lO(dtGU]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#jG}#j#o(d#s;'S(d;'S;=`*T<%lO(dtHS]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#cH{#c#o(d#s;'S(d;'S;=`*T<%lO(dtIQ]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#iIy#i#o(d#s;'S(d;'S;=`*T<%lO(dtJQZ!fSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dtJx]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^Kq#^#o(d#s;'S(d;'S;=`*T<%lO(dtKv]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#YLo#Y#o(d#s;'S(d;'S;=`*T<%lO(dtLt]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#cMm#c#o(d#s;'S(d;'S;=`*T<%lO(dtMr]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#iNk#i#o(d#s;'S(d;'S;=`*T<%lO(dtNrZ!cSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv! jalpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!!o#U#b(d#b#c!(_#c#i(d#i#j!-}#j#o(d#s;'S(d;'S;=`*T<%lO(dr!!t]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a!#m#a#o(d#s;'S(d;'S;=`*T<%lO(dr!#r]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!$k#Y#o(d#s;'S(d;'S;=`*T<%lO(dr!$p]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h!%i#h#o(d#s;'S(d;'S;=`*T<%lO(dr!%n]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W!&g#W#o(d#s;'S(d;'S;=`*T<%lO(dr!&l]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!'e#Y#o(d#s;'S(d;'S;=`*T<%lO(dr!'lZ!xQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!(d]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h!)]#h#o(d#s;'S(d;'S;=`*T<%lO(dt!)b]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j!*Z#j#o(d#s;'S(d;'S;=`*T<%lO(dt!*`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b!+X#b#o(d#s;'S(d;'S;=`*T<%lO(dt!+^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!,V#Y#o(d#s;'S(d;'S;=`*T<%lO(dt!,[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!-T#g#o(d#s;'S(d;'S;=`*T<%lO(dt!-[Z!eSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr!.S]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!.{#c#o(d#s;'S(d;'S;=`*T<%lO(dr!/Q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!/y#i#o(d#s;'S(d;'S;=`*T<%lO(dr!0O[lpOp(drs)[sv(dwx(dxy!0tz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dQ!0wPyz!0zQ!1PO!pQt!1U]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j!1}#j#o(d#s;'S(d;'S;=`*T<%lO(dt!2S]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!2{#g#o(d#s;'S(d;'S;=`*T<%lO(dt!3Q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!3y#U#o(d#s;'S(d;'S;=`*T<%lO(dt!4O]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!4w#i#o(d#s;'S(d;'S;=`*T<%lO(dt!4|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^!5u#^#o(d#s;'S(d;'S;=`*T<%lO(dt!5z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d!6s#d#o(d#s;'S(d;'S;=`*T<%lO(dt!6x]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!7q#c#o(d#s;'S(d;'S;=`*T<%lO(dt!7xZ!gSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!8p]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!9i#g#o(d#s;'S(d;'S;=`*T<%lO(dt!9n]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!:g#g#o(d#s;'S(d;'S;=`*T<%lO(dt!:l]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d!;e#d#o(d#s;'S(d;'S;=`*T<%lO(dt!;j]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!<c#g#o(d#s;'S(d;'S;=`*T<%lO(dt!<jZ!^SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!=b]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!>Z#U#o(d#s;'S(d;'S;=`*T<%lO(dt!>`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a!?X#a#o(d#s;'S(d;'S;=`*T<%lO(dt!?^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h!@V#h#o(d#s;'S(d;'S;=`*T<%lO(dt!@[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!AT#Y#o(d#s;'S(d;'S;=`*T<%lO(dt!A[Z!ZSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!BS]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!B{#c#o(d#s;'S(d;'S;=`*T<%lO(dt!CQ]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!Cy#i#o(d#s;'S(d;'S;=`*T<%lO(dt!DO]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!Dw#Y#o(d#s;'S(d;'S;=`*T<%lO(dt!D|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!Eu#g#o(d#s;'S(d;'S;=`*T<%lO(dt!Ez]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!Fs#c#o(d#s;'S(d;'S;=`*T<%lO(dt!Fx]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!Gq#U#o(d#s;'S(d;'S;=`*T<%lO(dt!Gv]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a!Ho#a#o(d#s;'S(d;'S;=`*T<%lO(dt!HvZ!aSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!In]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^!Jg#^#o(d#s;'S(d;'S;=`*T<%lO(dt!Jl]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!Ke#c#o(d#s;'S(d;'S;=`*T<%lO(dt!Kj]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X!Lc#X#o(d#s;'S(d;'S;=`*T<%lO(dt!LjZ!hSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr!Mb_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!Na#U#](d#]#^#!X#^#o(d#s;'S(d;'S;=`*T<%lO(dr!Nf]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#l(d#l#m# _#m#o(d#s;'S(d;'S;=`*T<%lO(dr# fZ!qQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr#!^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c##V#c#o(d#s;'S(d;'S;=`*T<%lO(dr##^Z!rQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#$U_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#%T#U#](d#]#^#'y#^#o(d#s;'S(d;'S;=`*T<%lO(dt#%Y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b#&R#b#o(d#s;'S(d;'S;=`*T<%lO(dt#&W]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#'P#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#'WZ!iSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#(O]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a#(w#a#o(d#s;'S(d;'S;=`*T<%lO(dt#)OZ![SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#)v]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#_(d#_#`#*o#`#o(d#s;'S(d;'S;=`*T<%lO(dt#*vZ!]SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~#+n_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#,m#U#f(d#f#g#1_#g#o(d#s;'S(d;'S;=`*T<%lO(d~#,r]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#-k#g#o(d#s;'S(d;'S;=`*T<%lO(d~#-p]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#.i#Y#o(d#s;'S(d;'S;=`*T<%lO(d~#.n]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c#/g#c#o(d#s;'S(d;'S;=`*T<%lO(d~#/l]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i#0e#i#o(d#s;'S(d;'S;=`*T<%lO(d~#0lZj~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#1d]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d#2]#d#o(d#s;'S(d;'S;=`*T<%lO(dt#2b]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X#3Z#X#o(d#s;'S(d;'S;=`*T<%lO(dt#3`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j#4X#j#o(d#s;'S(d;'S;=`*T<%lO(dt#4^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W#5V#W#o(d#s;'S(d;'S;=`*T<%lO(dt#5[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#6T#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#6Y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#7R#g#o(d#s;'S(d;'S;=`*T<%lO(dt#7YZ!dSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~#8Q_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#9P#Y#c(d#c#d#?m#d#o(d#s;'S(d;'S;=`*T<%lO(d~#9U]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h#9}#h#o(d#s;'S(d;'S;=`*T<%lO(d~#:S]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d#:{#d#o(d#s;'S(d;'S;=`*T<%lO(d~#;Q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j#;y#j#o(d#s;'S(d;'S;=`*T<%lO(d~#<O]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#<w#g#o(d#s;'S(d;'S;=`*T<%lO(d~#<|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W#=u#W#o(d#s;'S(d;'S;=`*T<%lO(d~#=z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#>s#Y#o(d#s;'S(d;'S;=`*T<%lO(d~#>zZm~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#?r]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d#@k#d#o(d#s;'S(d;'S;=`*T<%lO(dt#@p]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i#Ai#i#o(d#s;'S(d;'S;=`*T<%lO(dt#An_lpOp(drs)[sv(dwx(dz|(d}!^(d!a!p(d!p!q#Bm!q!u(d!u!v#Fa!v#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#Br]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#Ck#U#o(d#s;'S(d;'S;=`*T<%lO(dt#Cp]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b#Di#b#o(d#s;'S(d;'S;=`*T<%lO(dt#Dn]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#Eg#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#EnZ!jSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#Ff]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#G_#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#Gd]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#H]#g#o(d#s;'S(d;'S;=`*T<%lO(dt#Hb]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k#IZ#k#o(d#s;'S(d;'S;=`*T<%lO(dt#I`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^#JX#^#o(d#s;'S(d;'S;=`*T<%lO(dt#J^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W#KV#W#o(d#s;'S(d;'S;=`*T<%lO(dt#K[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#LT#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#LY]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!p(d!p!q#MR!q#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#MW]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#NP#U#o(d#s;'S(d;'S;=`*T<%lO(dt#NU]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b#N}#b#o(d#s;'S(d;'S;=`*T<%lO(dt$ S]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$ {#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$!SZ!kSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~$!zblpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$$S#Y#d(d#d#e$,n#e#h(d#h#i$/d#i#j$:x#j#o(d#s;'S(d;'S;=`*T<%lO(dv$$X_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a$%W#a#f(d#f#g$(z#g#o(d#s;'S(d;'S;=`*T<%lO(dr$%]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$&U#Y#o(d#s;'S(d;'S;=`*T<%lO(dr$&Z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W$'S#W#o(d#s;'S(d;'S;=`*T<%lO(dr$'X]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$(Q#i#o(d#s;'S(d;'S;=`*T<%lO(dr$(XZ!vQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$)P]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k$)x#k#o(d#s;'S(d;'S;=`*T<%lO(dt$)}]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$*v#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$*{]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$+t#g#o(d#s;'S(d;'S;=`*T<%lO(dt$+{Z!bSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~$,s]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$-l#U#o(d#s;'S(d;'S;=`*T<%lO(d~$-q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c$.j#c#o(d#s;'S(d;'S;=`*T<%lO(d~$.qZn~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$/i]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$0b#U#o(d#s;'S(d;'S;=`*T<%lO(dt$0g]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$1`#i#o(d#s;'S(d;'S;=`*T<%lO(dt$1e]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j$2^#j#o(d#s;'S(d;'S;=`*T<%lO(dt$2c]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$3[#h#o(d#s;'S(d;'S;=`*T<%lO(dt$3c]!lSlpOp(drs)[sv(dwx(dz|(d}!^(d!a!o(d!o!p$4[!p#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$4a]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$5Y#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$5_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$6W#h#o(d#s;'S(d;'S;=`*T<%lO(dt$6]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$7U#h#o(d#s;'S(d;'S;=`*T<%lO(dt$7Z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$8S#U#o(d#s;'S(d;'S;=`*T<%lO(dt$8X]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Z(d#Z#[$9Q#[#o(d#s;'S(d;'S;=`*T<%lO(dt$9V]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$:O#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$:VZ!mSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr$:}]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b$;v#b#o(d#s;'S(d;'S;=`*T<%lO(dr$;}Z!tQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$<u]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$=n#g#o(d#s;'S(d;'S;=`*T<%lO(dt$=s_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$>r#U#i(d#i#j$IW#j#o(d#s;'S(d;'S;=`*T<%lO(dt$>w]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W$?p#W#o(d#s;'S(d;'S;=`*T<%lO(dt$?u]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$@n#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$@s]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!f(d!f!g$Al!g#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$Aq]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j$Bj#j#o(d#s;'S(d;'S;=`*T<%lO(dt$Bo]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$Ch#g#o(d#s;'S(d;'S;=`*T<%lO(dt$Cm]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$Df#U#o(d#s;'S(d;'S;=`*T<%lO(dt$Dk]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$Ed#i#o(d#s;'S(d;'S;=`*T<%lO(dt$Ei]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^$Fb#^#o(d#s;'S(d;'S;=`*T<%lO(dt$Fg]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d$G`#d#o(d#s;'S(d;'S;=`*T<%lO(dt$Ge]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c$H^#c#o(d#s;'S(d;'S;=`*T<%lO(dt$HeZ!nSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$I]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$JU#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$J]Z!YSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$KT]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c$K|#c#o(d#s;'S(d;'S;=`*T<%lO(dt$LR]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$Lz#h#o(d#s;'S(d;'S;=`*T<%lO(dt$MP_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$NO#Y#d(d#d#e% v#e#o(d#s;'S(d;'S;=`*T<%lO(dt$NT]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$N|#i#o(d#s;'S(d;'S;=`*T<%lO(dt% TZ!_SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt% {]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%!t#Y#o(d#s;'S(d;'S;=`*T<%lO(dt%!y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W%#r#W#o(d#s;'S(d;'S;=`*T<%lO(dt%#w]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^%$p#^#o(d#s;'S(d;'S;=`*T<%lO(dt%$u]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Y(d#Y#Z%%n#Z#o(d#s;'S(d;'S;=`*T<%lO(dt%%s]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^%&l#^#o(d#s;'S(d;'S;=`*T<%lO(dt%&q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%'j#Y#o(d#s;'S(d;'S;=`*T<%lO(dt%'o]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X%(h#X#o(d#s;'S(d;'S;=`*T<%lO(dt%(oZ!`SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~%)gO!U~~%)lPZ~#p#q%)o~%)tOY~~%)yO!V~!t%*QO!T!db`",tokenizers:[1,2,3,4,5,6,new il.ML("j~RQYZXz{^~^O!P~~aP!P!Qd~iO!Q~~",25,46)],topRules:{TraceQL:[0,3]},tokenPrec:1001}),ll=17,cl=25,ul=34,dl=37,pl=39;function fl(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hl(e,t){const r=e.cursorAt(t);do{if(r.from===t||r.to===t){const{node:e}=r;if(e.type.isError)return e}}while(r.next());return null}function gl(e,t){return e[t]}function ml(e,t){let r=e;for(const[e,n]of t){if(r=gl(r,e),null===r)return null;if(void 0===n.find((e=>e===(null==r?void 0:r.type.id))))return null}return r}function vl(e,t){return t.slice(e.from===e.to?e.from-1:e.from,e.to)}function yl(e,t){return e.every(((e,r)=>e===t[r]))}const bl=[{path:[0,27],fun:function(e,t){const r=ml(e,[["parent",[27]]]),n=r?vl(r,t):"";if("."===n)return{type:"SPANSET_ONLY_DOT"};const a=n.indexOf("."),o=n.slice(0,a);return["span","resource","parent"].find((e=>e===o))?{type:"SPANSET_IN_NAME_SCOPE",scope:o}:{type:"SPANSET_IN_NAME"}}},{path:[0,ll],fun:wl},{path:[0,16],fun:function(e,t,r){const n=Ol(e,t,r);return n||{type:"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE"}}},{path:[0,ul],fun:Tl},{path:[0,cl],fun:Tl},{path:[0,4],fun:function(e,t,r){var n;return 11===(null===(n=e.prevSibling)||void 0===n?void 0:n.type.id)?{type:"SPANSET_PIPELINE_AFTER_OPERATOR"}:{type:"NEW_SPANSET"}}},{path:[0,31,14],fun:function(e,t,r){var n;if(36!==(null===(n=e.prevSibling)||void 0===n?void 0:n.type.id))return{type:"SPANSET_COMPARISON_OPERATORS"}}},{path:[ll],fun:Sl},{path:[16],fun:Sl},{path:[4],fun:El},{path:[3],fun:El},{path:[20,19],fun:wl}],Ol=(e,t,r)=>{const n=e=>{const r=ml(e,[["firstChild",[27]]]),n=r?vl(r,t):"",a=n.indexOf(".");return n.slice(0,a)};if(" "===t[r-1])return;const a=ml(e,[["firstChild",[ll]]]);if(a)return{type:"SPANSET_IN_NAME_SCOPE",scope:n(a)};const o=ml(e,[["parent",[16]],["firstChild",[ll]]]);return o&&" "!==t[r]?{type:"SPANSET_IN_NAME_SCOPE",scope:n(o)}:void 0};function Sl(e,t,r,n){const a=Ol(e,t,n);if(a)return a;let o=ml(e,[["firstChild",[ll]],["firstChild",[27]]]);return o?{type:"SPANSET_EXPRESSION_OPERATORS"}:(o=ml(e,[["lastChild",[ll]],["lastChild",[ll]],["lastChild",[19]]]),o?{type:"SPANFIELD_COMBINING_OPERATORS"}:(o=ml(e,[["lastChild",[ll]]]),o?{type:"SPANSET_EXPRESSION_OPERATORS"}:{type:"SPANSET_EMPTY"}))}function wl(e,t,r,n){var a,o,i;const s=Ol(e,t,n);if(s)return s;if(ml(e,[["parent",[19]],["parent",[ll]],["prevSibling",[18]]])){var l,c,u;let r=null===(u=e.parent)||void 0===u||null===(c=u.parent)||void 0===c||null===(l=c.prevSibling)||void 0===l?void 0:l.prevSibling;if(r)return{type:"SPANSET_IN_VALUE",tagName:vl(r,t),betweenQuotes:!0}}if(18===(null===(a=e.prevSibling)||void 0===a?void 0:a.type.id)){var d;let r=null===(d=e.prevSibling)||void 0===d?void 0:d.prevSibling;if(r)return{type:"SPANSET_IN_VALUE",tagName:vl(r,t),betweenQuotes:!1}}return"And"===(null===(o=e.prevSibling)||void 0===o?void 0:o.type.name)||"Or"===(null===(i=e.prevSibling)||void 0===i?void 0:i.type.name)?{type:"SPANSET_EMPTY"}:{type:"SPANSET_IN_THE_MIDDLE"}}function El(e,t,r){let n=e.firstChild;try{for(n=e.firstChild;n.to<r;)n=n.nextSibling}catch(e){console.error("Unexpected error while searching for previous node",e)}return 5===(null==n?void 0:n.type.id)||10===(null==n?void 0:n.type.id)?{type:"NEW_SPANSET"}:{type:"SPANSET_COMBINING_OPERATORS"}}function Tl(e,t,r){const n=null==e?void 0:e.parent;if(n&&[cl,ul,dl,pl].includes(n.type.id))return{type:"ATTRIBUTE_FOR_FUNCTION"}}function xl(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Pl(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){xl(o,n,a,i,s,"next",e)}function s(e){xl(o,n,a,i,s,"throw",e)}i(void 0)}))}}function kl(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){kl(e,t,r[t])}))}return e}function Nl(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Cl{provideCompletionItems(e,t){var r;if(!this.monaco||!this.editor)throw new Error("provideCompletionItems called before CompletionProvider was initialized");if((null===(r=this.editor.getModel())||void 0===r?void 0:r.id)!==e.id)return{suggestions:[]};const{range:n,offset:a}=function(e,t,r){const n=t.getWordAtPosition(r),a=null!=n?e.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn}):e.Range.fromPositions(r),o={column:r.column,lineNumber:r.lineNumber};return{offset:t.getOffsetAt(o),range:a}}(this.monaco,e,t),o=function(e,t){if(""===e)return{query:e,type:"EMPTY"};const r=sl.parse(e);let n=t;for(;n-1>=0&&" "===e[n-1];)n-=1;let a=hl(r,n);a||(a=hl(r,n-1));const o=null!=a?a.cursor():r.cursorAt(n),i=o.node,s=[o.type.id];for(;o.parent();)s.push(o.type.id);let l;for(let r of bl)yl(r.path,s)&&(l=r.fun(i,e,n,t));return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){fl(e,t,r[t])}))}return e}({query:e},null!=l?l:{type:"UNKNOWN"})}(e.getValue(),a);return(null!=o?this.getCompletions(o):Promise.resolve([])).then((t=>{const r=t.length.toString().length,o=t.map(((t,o)=>{const i={kind:_l(t.type,this.monaco),label:t.label,insertText:t.insertText,insertTextRules:t.insertTextRules,detail:t.detail,documentation:t.documentation,sortText:o.toString().padStart(r,"0"),range:n,command:{id:this.registerInteractionCommandId||"noOp",title:"Report Interaction",arguments:[t.label,t.type]}};return function(e,t,r,n){if("TAG_NAME"===t){const t=r.getValue().substring(0,n).match(/(span\.|resource\.|\.)?([\w./-]*)$/);if(t){const r=t[1],a=t[2];a&&(r||"."===e.insertText[0]||(e.insertText="."+e.insertText),e.range=Nl(jl({},e.range),{startColumn:n-a.length+1}))}}}(i,t.type,e,a),i}));return{suggestions:o}}))}setRegisterInteractionCommandId(e){this.registerInteractionCommandId=e}getTagValues(e,t){var r=this;return Pl((function*(){let n;const a=`${e}:${t}`;return r.cachedValues.hasOwnProperty(a)?n=r.cachedValues[a]:(n=yield r.languageProvider.getOptionsV2(e,t),r.cachedValues[a]=n),n}))()}getCompletions(e){var r=this;return Pl((function*(){switch(e.type){case"UNKNOWN":return[];case"EMPTY":return r.getScopesCompletions("{ ","$0 }").concat(r.getIntrinsicsCompletions("{ ","$0 }")).concat(r.getTagsCompletions("{ ."));case"SPANSET_EMPTY":case"ATTRIBUTE_FOR_FUNCTION":return r.getScopesCompletions().concat(r.getIntrinsicsCompletions()).concat(r.getTagsCompletions("."));case"SPANSET_ONLY_DOT":return r.getTagsCompletions();case"SPANSET_IN_THE_MIDDLE":case"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE":return[...Cl.comparisonOps,...Cl.logicalOps].map((e=>Nl(jl({},e),{type:"OPERATOR"})));case"SPANSET_IN_NAME":return r.getScopesCompletions().concat(r.getIntrinsicsCompletions()).concat(r.getTagsCompletions());case"SPANSET_IN_NAME_SCOPE":return r.getTagsCompletions(void 0,e.scope);case"SPANSET_EXPRESSION_OPERATORS":return[...Cl.comparisonOps,...Cl.logicalOps,...Cl.arithmeticOps].map((e=>Nl(jl({},e),{type:"OPERATOR"})));case"SPANFIELD_COMBINING_OPERATORS":return[...Cl.logicalOps,...Cl.arithmeticOps,...Cl.comparisonOps].map((e=>Nl(jl({},e),{type:"OPERATOR"})));case"SPANSET_COMBINING_OPERATORS":return Cl.spansetOps.map((e=>Nl(jl({},e),{type:"OPERATOR"})));case"SPANSET_PIPELINE_AFTER_OPERATOR":return[...Cl.functions.map((e=>{var t,n;return Nl(jl({},e),{insertTextRules:null===(n=r.monaco)||void 0===n||null===(t=n.languages.CompletionItemInsertTextRule)||void 0===t?void 0:t.InsertAsSnippet,type:"FUNCTION"})})),...r.getScopesCompletions().concat(r.getIntrinsicsCompletions()).concat(r.getTagsCompletions("."))];case"SPANSET_COMPARISON_OPERATORS":return Cl.comparisonOps.map((e=>Nl(jl({},e),{type:"OPERATOR"})));case"SPANSET_IN_VALUE":let n;try{n=yield r.getTagValues(e.tagName,e.query)}catch(e){(0,t.isFetchError)(e)?ht(Ze(pt(e.data.error,new Error(e.data.message)))):e instanceof Error&&ht(Ze(pt("Error",e)))}const a=[],o=t=>e.betweenQuotes?t.label:"string"===t.type?`"${t.label}"`:t.label;return null==n||n.forEach((e=>{(null==e?void 0:e.label)&&a.push({label:e.label,insertText:o(e),type:"TAG_VALUE"})})),a;case"SPANSET_AFTER_VALUE":return Cl.logicalOps.map((e=>({label:e.label,insertText:e.insertText+"}",type:"OPERATOR"})));case"NEW_SPANSET":return r.getScopesCompletions("{ ","$0 }").concat(r.getIntrinsicsCompletions("{ ","$0 }")).concat(r.getTagsCompletions("."));default:throw new Error(`Unexpected situation ${e}`)}}))()}getTagsCompletions(e,t){return this.languageProvider.getTraceqlAutocompleteTags(t).sort(((e,t)=>e.localeCompare(t,void 0,{sensitivity:"accent"}))).map((t=>({label:t,insertText:(e||"")+t,type:"TAG_NAME"})))}getIntrinsicsCompletions(e,t){return Zr.map((r=>{var n,a;return{label:r,insertText:(e||"")+r+(t||""),type:"KEYWORD",insertTextRules:null===(a=this.monaco)||void 0===a||null===(n=a.languages.CompletionItemInsertTextRule)||void 0===n?void 0:n.InsertAsSnippet}}))}getScopesCompletions(e,t){return en.map((r=>{var n,a;return{label:r,insertText:(e||"")+r+(t||""),type:"SCOPE",insertTextRules:null===(a=this.monaco)||void 0===a||null===(n=a.languages.CompletionItemInsertTextRule)||void 0===n?void 0:n.InsertAsSnippet}}))}constructor(e){kl(this,"languageProvider",void 0),kl(this,"registerInteractionCommandId",void 0),kl(this,"triggerCharacters",["{",".","[","(","=","~"," ",'"']),kl(this,"monaco",void 0),kl(this,"editor",void 0),kl(this,"cachedValues",{}),this.languageProvider=e.languageProvider,this.registerInteractionCommandId=null}}function _l(e,t){switch(e){case"TAG_NAME":return t.languages.CompletionItemKind.Enum;case"KEYWORD":return t.languages.CompletionItemKind.Keyword;case"OPERATOR":return t.languages.CompletionItemKind.Operator;case"TAG_VALUE":return t.languages.CompletionItemKind.EnumMember;case"SCOPE":return t.languages.CompletionItemKind.Class;case"FUNCTION":return t.languages.CompletionItemKind.Function;default:throw new Error(`Unexpected CompletionType: ${e}`)}}kl(Cl,"arithmeticOps",[{label:"+",insertText:"+",detail:"Plus"},{label:"-",insertText:"-",detail:"Minus"},{label:"*",insertText:"*",detail:"Times"},{label:"/",insertText:"/",detail:"Over"}]),kl(Cl,"logicalOps",[{label:"&&",insertText:"&&",detail:"And",documentation:"And (intersection) operator. Checks that both conditions found matches."},{label:"||",insertText:"||",detail:"Or",documentation:"Or (union) operator. Checks that either condition found matches."}]),kl(Cl,"comparisonOps",[{label:"=",insertText:"=",detail:"Equality"},{label:"!=",insertText:"!=",detail:"Inequality"},{label:">",insertText:">",detail:"Greater than"},{label:">=",insertText:">=",detail:"Greater than or equal to"},{label:"<",insertText:"<",detail:"Less than"},{label:"<=",insertText:"<=",detail:"Less than or equal to"},{label:"=~",insertText:"=~",detail:"Regular expression"},{label:"!~",insertText:"!~",detail:"Negated regular expression"}]),kl(Cl,"structuralOps",[{label:">>",insertText:">>",detail:"Descendant",documentation:"Descendant operator. Looks for spans matching {condB} that are descendants of a span matching {condA}"},{label:">",insertText:">",detail:"Child",documentation:"Child operator. Looks for spans matching {condB} that are direct child spans of a parent matching {condA}"},{label:"<<",insertText:"<<",detail:"Ancestor",documentation:"Ancestor operator. Looks for spans matching {condB} that are ancestors of a span matching {condA}"},{label:"<",insertText:"<",detail:"Parent",documentation:"Parent operator. Looks for spans matching {condB} that are direct parent spans of a child matching {condA}"},{label:"~",insertText:"~",detail:"Sibling",documentation:"Sibling operator. Checks that spans matching {condA} and {condB} are siblings of the same parent span."}]),kl(Cl,"spansetOps",[{label:"|",insertText:"|",detail:"Pipe"},...Cl.logicalOps,...Cl.structuralOps]),kl(Cl,"spansetAggregatorOps",[{label:"count",insertText:"count()$0",detail:"Number of spans",documentation:"Counts the number of spans in a spanset"},{label:"avg",insertText:"avg($0)",detail:"Average of attribute",documentation:"Computes the average of a given numeric attribute or intrinsic for a spanset."},{label:"max",insertText:"max($0)",detail:"Max value of attribute",documentation:"Computes the maximum value of a given numeric attribute or intrinsic for a spanset."},{label:"min",insertText:"min($0)",detail:"Min value of attribute",documentation:"Computes the minimum value of a given numeric attribute or intrinsic for a spanset."},{label:"sum",insertText:"sum($0)",detail:"Sum value of attribute",documentation:"Computes the sum value of a given numeric attribute or intrinsic for a spanset."}]),kl(Cl,"functions",[...Cl.spansetAggregatorOps,{label:"by",insertText:"by($0)",detail:"Grouping of attributes",documentation:"Groups by arbitrary attributes."},{label:"select",insertText:"select($0)",detail:"Selection of fields",documentation:"Selects arbitrary fields from spans."}]);const Rl=e=>{if(""===e.trim())return[];if(e.trim().match(/^[0-9A-Fa-f]*$/))return[];const t=sl.parse(e),r=[];return t.iterate({enter:e=>{0===e.type.id&&r.push(e.node)}}),r},Dl=(e,t,r)=>{const n=[...Il(e.MarkerSeverity.Error,t,r),...Al(e.MarkerSeverity.Warning,t)];e.editor.setModelMarkers(t,"owner",n)},Il=(e,t,r)=>r.map((r=>{const n=(e=>{var t;switch(null===(t=e.parent)||void 0===t?void 0:t.type.id){case ll:var r;switch(null===(r=e.prevSibling)||void 0===r?void 0:r.type.id){case 5:case 10:return"Invalid value after logical operator.";case 18:return"Invalid value after comparison or arithmetic operator.";default:return"Invalid operator after field expression."}case 16:var n;return(null===(n=e.prevSibling)||void 0===n?void 0:n.type.id)===ll?"Invalid comparison operator after field expression.":"Invalid expression for spanset.";case 4:var a;switch(null===(a=e.prevSibling)||void 0===a?void 0:a.type.id){case 4:return"Invalid spanset combining operator after spanset expression.";case 11:return"Invalid aggregation operator after pipepile operator.";default:return"Invalid spanset expression after spanset combining operator."}case cl:case ul:return"Invalid expression for aggregator operator.";case 27:return"Invalid expression for spanset.";case 31:var o;switch(null===(o=e.prevSibling)||void 0===o?void 0:o.type.id){case 36:return"Invalid value after comparison operator.";case 32:var i,s;if((null===(s=e.prevSibling)||void 0===s||null===(i=s.firstChild)||void 0===i?void 0:i.type.id)===ul)return"Invalid comparison operator after aggregator operator.";default:return"Invalid value after comparison operator."}default:return"Invalid query."}})(r);return Fl(e,n,t,r.from,r.to)})),Al=(e,t)=>{let r=[];const n=t.getValue(),a=sl.parse(n);if(n.indexOf(".")>-1){const n=a.cursorAt(0);do{const{node:a}=n;var o,i,s;if(28===a.type.id&&26!==(null===(o=a.prevSibling)||void 0===o?void 0:o.type.id)&&29!==(null===(i=a.prevSibling)||void 0===i?void 0:i.type.id)&&30!==(null===(s=a.prevSibling)||void 0===s?void 0:s.type.id)){const n=a.prevSibling?a.prevSibling.from:a.from-1,o=a.prevSibling?a.prevSibling.to:a.from-1,i="Add resource or span scope to attribute to improve query performance.";r.push(Fl(e,i,t,n,o))}}while(n.next())}return r},Fl=(e,t,r,n,a)=>{let o=0,i=0,s=n,l=a;for(;s>0;)o++,s-=r.getLineLength(o)+1;for(;l>0;)i++,l-=r.getLineLength(i)+1;return{message:t,severity:e,startLineNumber:o,endLineNumber:i,startColumn:s+r.getLineLength(o)+2,endColumn:l+r.getLineLength(i)+2}};function $l(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Ll(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ql(e){const[o,i]=(0,r.useState)(""),{query:s,onChange:l,onRunQuery:c,placeholder:u}=e,d=function(e,t){const n=(0,r.useRef)(new Cl({languageProvider:e.languageProvider}));(0,r.useEffect)((()=>{const r=function(){var r=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){$l(o,n,a,i,s,"next",e)}function s(e){$l(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(){try{yield e.languageProvider.start()}catch(e){e instanceof Error&&(console.error(e),t(e.message))}}));return function(){return r.apply(this,arguments)}}();r()}),[e,t]);const a=(0,r.useRef)(null);return(0,r.useEffect)((()=>()=>{var e;null===(e=a.current)||void 0===e||e.call(a)}),[]),(e,t,r)=>{n.current.editor=e,n.current.monaco=t,n.current.setRegisterInteractionCommandId(r);const{dispose:o}=t.languages.registerCompletionItemProvider(zl,n.current);a.current=o}}(e.datasource,i),p=(0,a.useTheme2)(),f=Vl(p,u),h=(0,r.useRef)(s);h.current=s;const g=e=>{var t,r;l((t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ll(e,t,r[t])}))}return e}({},h.current),r=null!=(r={query:e})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t))},m=(0,r.useRef)(c);m.current=c;const v=(0,r.useRef)();return n().createElement(n().Fragment,null,n().createElement(a.CodeEditor,{value:s.query||"",language:zl,onBlur:g,onChange:g,containerStyles:f.queryField,readOnly:e.readOnly,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on"},onBeforeEditorMount:Ml,onEditorDidMount:(r,n)=>{e.readOnly||(d(r,n,function(e){return e.addCommand(0,(function(e,r,n){const a={datasourceType:"tempo",type:n};"TAG_VALUE"!==n&&(a.label=r),(0,t.reportInteraction)("grafana_traces_traceql_completion",a)}))}(r)),function(e,t,r){e.addAction({id:"run-query",label:"Run Query",keybindings:[t.KeyMod.Shift|t.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(){m.current()}})}(r,n),function(e,t,r){const n=[{range:new t.Range(1,1,1,1),options:{className:r.placeholder,isWholeLine:!0}}];let a=[];const o=()=>{const t=e.getModel();if(!t)return;const r=0===t.getValueLength()?n:[];a=t.deltaDecorations(a,r)};o(),e.onDidChangeModelContent(o)}(r,n,f)),function(e){const t=e.getDomNode(),r=()=>{if(t){const r=Math.min(1e3,e.getContentHeight()),n=parseInt(t.style.width,10);t.style.width=`${n}px`,t.style.height=`${r}px`,e.layout({width:n,height:r})}};e.onDidContentSizeChange(r),r()}(r);const a=r.getModel();if(a){const e=Rl(a.getValue());Dl(n,a,e)}r.onDidChangeModelContent((e=>{const t=r.getModel();if(!t)return;window.clearTimeout(v.current);const a=Rl(t.getValue()),o=e.changes[0].rangeOffset;Dl(n,t,a.filter((e=>!(e.from<=o&&o<=e.to)))),v.current=window.setTimeout((()=>{Dl(n,t,a)}),500)}))}}),o&&n().createElement(ol,{severity:"error",text:o}))}let ql=!1;const zl="traceql";function Ml(e){if(!ql){ql=!0;const{aliases:t,extensions:r,mimetypes:n,def:a}=rn;e.languages.register({id:zl,aliases:t,extensions:r,mimetypes:n}),e.languages.setMonarchTokensProvider(zl,a.language),e.languages.setLanguageConfiguration(zl,a.languageConfiguration)}}const Vl=(e,t)=>({queryField:(0,o.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,flex:1}),placeholder:(0,o.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.3}})});function Ul(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bl(e){const o=(0,a.useStyles2)(Gl),i=(0,gt.defaults)(e.query,tl),[s,l]=(0,r.useState)((()=>{const e=an(i.filters||[]);return e===i.query||"{}"===e}));return n().createElement(n().Fragment,null,n().createElement(a.InlineLabel,null,"Build complex queries using TraceQL to select a list of traces."," ",n().createElement("a",{rel:"noreferrer",target:"_blank",href:"https://grafana.com/docs/tempo/latest/traceql/"},"Documentation")),!s&&n().createElement("div",{className:o.copyContainer},n().createElement("span",null,"Continue editing the query from the Search tab?"),n().createElement(a.Button,{variant:"secondary",size:"sm",onClick:()=>{var r,n,a;(0,t.reportInteraction)("grafana_traces_copy_to_traceql_clicked",{app:null!==(r=e.app)&&void 0!==r?r:"",grafana_version:t.config.buildInfo.version,location:"traceql_tab"}),e.onClearResults(),e.onChange((n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ul(e,t,r[t])}))}return e}({},i),a=null!=(a={query:an(i.filters||[])})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})),n)),l(!0)},style:{marginLeft:"10px"}},"Copy query from Search")),n().createElement(Ql,{placeholder:"Enter a TraceQL query or trace ID (run with Shift+Enter)",query:i,onChange:e.onChange,datasource:e.datasource,onRunQuery:e.onRunQuery}),n().createElement("div",{className:o.optionsContainer},n().createElement(Ao,{query:i,onChange:e.onChange})))}const Gl=e=>({optionsContainer:(0,o.css)({marginTop:"10px"}),copyContainer:(0,o.css)({backgroundColor:e.colors.background.secondary,padding:e.spacing(.5,1),fontSize:e.typography.body.fontSize})});function Wl(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Xl(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Xl(e,t,r[t])}))}return e}function Jl(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Hl extends n().PureComponent{componentDidMount(){var e=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Wl(o,n,a,i,s,"next",e)}function s(e){Wl(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(){e.props.query.queryType&&"clear"!==e.props.query.queryType||e.props.onChange(Jl(Yl({},e.props.query),{queryType:"traceql"}))}))()}render(){var e;const{query:r,onChange:i,datasource:s,app:l}=this.props,c=s.getLokiSearchDS(),u=null===(e=s.serviceMap)||void 0===e?void 0:e.datasourceUid;let d=[{value:"traceqlSearch",label:"Search"},{value:"traceql",label:"TraceQL"},{value:"serviceMap",label:"Service Graph"}];var p;return c&&((null==s||null===(p=s.search)||void 0===p?void 0:p.hide)?d.unshift({value:"search",label:"Search"}):d.push({value:"search",label:"Loki Search"})),(r.spanName||r.serviceName||r.search||r.maxDuration||r.minDuration||"nativeSearch"===r.queryType)&&d.unshift({value:"nativeSearch",label:"[Deprecated] Search"}),n().createElement(n().Fragment,null,n().createElement(a.Modal,{title:"Upload trace",isOpen:this.state.uploadModalOpen,onDismiss:()=>this.setState({uploadModalOpen:!1})},n().createElement("div",{className:(0,o.css)({padding:this.props.theme.spacing(2)})},n().createElement(a.FileDropzone,{options:{multiple:!1},onLoad:e=>{this.props.datasource.uploadedJson=e,i(Jl(Yl({},r),{queryType:"upload"})),this.setState({uploadModalOpen:!1}),this.props.onRunQuery()}}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{label:"Query type",grow:!0},n().createElement(a.HorizontalGroup,{spacing:"sm",align:"center",justify:"space-between"},n().createElement(a.RadioButtonGroup,{options:d,value:r.queryType,onChange:e=>{var n;(0,t.reportInteraction)("grafana_traces_query_type_changed",{datasourceType:"tempo",app:null!=l?l:"",grafana_version:t.config.buildInfo.version,newQueryType:e,previousQueryType:null!==(n=r.queryType)&&void 0!==n?n:""}),this.onClearResults(),i(Jl(Yl({},r),{queryType:e}))},size:"md"}),n().createElement(a.Button,{variant:"secondary",size:"sm",onClick:()=>{this.setState({uploadModalOpen:!0})}},"Import trace")))),"search"===r.queryType&&n().createElement(S,{logsDatasourceUid:c,query:r,onRunQuery:this.onRunLinkedQuery,onChange:this.onChangeLinkedQuery}),"nativeSearch"===r.queryType&&n().createElement(ro,{datasource:this.props.datasource,query:r,onChange:i,onBlur:this.props.onBlur,onRunQuery:this.props.onRunQuery}),"traceqlSearch"===r.queryType&&n().createElement(mi,{datasource:this.props.datasource,query:r,onChange:i,onBlur:this.props.onBlur,app:l,onClearResults:this.onClearResults}),"serviceMap"===r.queryType&&n().createElement(Hs,{graphDatasourceUid:u,query:r,onChange:i}),"traceql"===r.queryType&&n().createElement(Bl,{datasource:this.props.datasource,query:r,onRunQuery:this.props.onRunQuery,onChange:i,app:l,onClearResults:this.onClearResults}))}constructor(e){super(e),Xl(this,"onChangeLinkedQuery",(e=>{const{query:t,onChange:r}=this.props;r(Jl(Yl({},t),{linkedQuery:Jl(Yl({},e),{refId:"linked"})}))})),Xl(this,"onRunLinkedQuery",(()=>{this.props.onRunQuery()})),Xl(this,"onClearResults",(()=>{const{onChange:e,query:t,onRunQuery:r}=this.props;e(Jl(Yl({},t),{queryType:"clear"})),r()})),this.state={uploadModalOpen:!1}}}const Kl=(0,a.withTheme2)(Hl);var Zl=Object.defineProperty,ec=Object.defineProperties,tc=Object.getOwnPropertyDescriptors,rc=Object.getOwnPropertySymbols,nc=Object.prototype.hasOwnProperty,ac=Object.prototype.propertyIsEnumerable,oc=(e,t,r)=>t in e?Zl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ic=(e,t)=>{for(var r in t||(t={}))nc.call(t,r)&&oc(e,r,t[r]);if(rc)for(var r of rc(t))ac.call(t,r)&&oc(e,r,t[r]);return e},sc=(e,t)=>ec(e,tc(t));const lc=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:i})=>{const s=(0,a.useTheme2)(),l={container:(0,o.css)({p:{margin:0},"p + p":{marginTop:s.spacing(2)}}),text:(0,o.css)(sc(ic({},s.typography.body),{color:s.colors.text.secondary,a:(0,o.css)({color:s.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})}))};return n().createElement("div",{className:(0,o.cx)(l.container,i)},n().createElement("p",{className:l.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",n().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&n().createElement("p",{className:l.text},n().createElement("i",null,"Fields marked with * are required")))};var cc=Object.defineProperty,uc=Object.defineProperties,dc=Object.getOwnPropertyDescriptors,pc=Object.getOwnPropertySymbols,fc=Object.prototype.hasOwnProperty,hc=Object.prototype.propertyIsEnumerable,gc=(e,t,r)=>t in e?cc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,mc=(e,t)=>{for(var r in t||(t={}))fc.call(t,r)&&gc(e,r,t[r]);if(pc)for(var r of pc(t))hc.call(t,r)&&gc(e,r,t[r]);return e},vc=(e,t)=>uc(e,dc(t));const yc=({children:e,title:t,description:i,isCollapsible:s=!1,isInitiallyOpen:l=!0,kind:c="section",className:u})=>{const{colors:d,typography:p,spacing:f}=(0,a.useTheme2)(),[h,g]=(0,r.useState)(!s||l),m=h?"angle-up":"angle-down",v="sub-section"===c,y=`${h?"Collapse":"Expand"} section ${t}`,b={header:(0,o.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,o.css)({margin:0}),subtitle:(0,o.css)({margin:0,fontWeight:p.fontWeightRegular}),descriptionText:(0,o.css)(vc(mc({marginTop:f(v?.25:.5),marginBottom:0},p.bodySmall),{color:d.text.secondary})),content:(0,o.css)({marginTop:f(2)})};return n().createElement("div",{className:u},n().createElement("div",{className:b.header},"section"===c?n().createElement("h3",{className:b.title},t):n().createElement("h6",{className:b.subtitle},t),s&&n().createElement(a.IconButton,{name:m,onClick:()=>g(!h),type:"button",size:"xl","aria-label":y})),i&&n().createElement("p",{className:b.descriptionText},i),h&&n().createElement("div",{className:b.content},e))};var bc=Object.defineProperty,Oc=Object.defineProperties,Sc=Object.getOwnPropertyDescriptors,wc=Object.getOwnPropertySymbols,Ec=Object.prototype.hasOwnProperty,Tc=Object.prototype.propertyIsEnumerable,xc=(e,t,r)=>t in e?bc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Pc=e=>{var t=e,{children:r}=t,a=((e,t)=>{var r={};for(var n in e)Ec.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&wc)for(var n of wc(e))t.indexOf(n)<0&&Tc.call(e,n)&&(r[n]=e[n]);return r})(t,["children"]);return n().createElement(yc,((e,t)=>Oc(e,Sc({kind:"section"})))(((e,t)=>{for(var r in t||(t={}))Ec.call(t,r)&&xc(e,r,t[r]);if(wc)for(var r of wc(t))Tc.call(t,r)&&xc(e,r,t[r]);return e})({},a)),r)};var kc=Object.defineProperty,jc=Object.defineProperties,Nc=Object.getOwnPropertyDescriptors,Cc=Object.getOwnPropertySymbols,_c=Object.prototype.hasOwnProperty,Rc=Object.prototype.propertyIsEnumerable,Dc=(e,t,r)=>t in e?kc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Ic=({config:e,onChange:t,description:r,urlPlaceholder:i,urlTooltip:s,urlLabel:l,className:c})=>{const u=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e.url),d={container:(0,o.css)({maxWidth:578})};return n().createElement(n().Fragment,null,n().createElement(Pc,{title:"Connection",description:r,className:(0,o.cx)(d.container,c)},n().createElement(a.InlineField,{htmlFor:"connection-url",label:l||"URL",labelWidth:24,tooltip:s||n().createElement(n().Fragment,null,"Specify a complete HTTP URL",n().createElement("br",null),"(for example https://example.com:8080)"),grow:!0,disabled:e.readOnly,required:!0,invalid:!u&&!e.readOnly,error:u?"":"Please enter a valid URL",interactive:!0},n().createElement(a.Input,{id:"connection-url","aria-label":"Data source connection URL",onChange:r=>t(((e,t)=>jc(e,Nc(t)))(((e,t)=>{for(var r in t||(t={}))_c.call(t,r)&&Dc(e,r,t[r]);if(Cc)for(var r of Cc(t))Rc.call(t,r)&&Dc(e,r,t[r]);return e})({},e),{url:r.currentTarget.value})),value:e.url||"",placeholder:i||"URL"}))))};var Ac=Object.defineProperty,Fc=Object.defineProperties,$c=Object.getOwnPropertyDescriptors,Lc=Object.getOwnPropertySymbols,Qc=Object.prototype.hasOwnProperty,qc=Object.prototype.propertyIsEnumerable,zc=(e,t,r)=>t in e?Ac(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Mc=(e,t)=>{for(var r in t||(t={}))Qc.call(t,r)&&zc(e,r,t[r]);if(Lc)for(var r of Lc(t))qc.call(t,r)&&zc(e,r,t[r]);return e},Vc=(e,t)=>Fc(e,$c(t));const Uc=e=>{var t=e,{isConfigured:n,onReset:o}=t,i=((e,t)=>{var r={};for(var n in e)Qc.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Lc)for(var n of Lc(e))t.indexOf(n)<0&&qc.call(e,n)&&(r[n]=e[n]);return r})(t,["isConfigured","onReset"]);return r.createElement(a.HorizontalGroup,null,!n&&r.createElement(a.Input,Vc(Mc({},i),{type:"password"})),n&&r.createElement(a.Input,Vc(Mc({},i),{type:"text",disabled:!0,value:"configured"})),n&&r.createElement(a.Button,{onClick:o,variant:"secondary"},"Reset"))},Bc=()=>({inlineFieldNoMarginRight:(0,o.css)({marginRight:0}),inlineFieldWithSecret:(0,o.css)({'[class$="layoutChildrenWrapper"]:first-child':{flexGrow:1}})}),Gc=({user:e,passwordConfigured:t,userTooltip:r="The username of the data source account",passwordTooltip:i="The password of the data source account",onUserChange:s,onPasswordChange:l,onPasswordReset:c,readOnly:u})=>{const d=Bc(),p={lastInlineField:(0,o.css)({marginBottom:0})};return n().createElement(n().Fragment,null,n().createElement(a.InlineField,{className:d.inlineFieldNoMarginRight,label:"User",labelWidth:24,tooltip:r,required:!0,htmlFor:"basic-auth-user-input",interactive:!0,grow:!0,disabled:u},n().createElement(a.Input,{id:"basic-auth-user-input",placeholder:"User",value:e,onChange:e=>s(e.currentTarget.value),required:!0})),n().createElement(a.InlineField,{className:(0,o.cx)(d.inlineFieldNoMarginRight,d.inlineFieldWithSecret,p.lastInlineField),label:"Password",labelWidth:24,tooltip:i,required:!0,htmlFor:"basic-auth-password-input",interactive:!0,grow:!0,disabled:u},n().createElement(Uc,{id:"basic-auth-password-input",isConfigured:t,onReset:u?()=>{}:c,placeholder:"Password",onChange:e=>l(e.currentTarget.value),required:!0})))};var Wc=Object.defineProperty,Xc=Object.defineProperties,Yc=Object.getOwnPropertyDescriptors,Jc=Object.getOwnPropertySymbols,Hc=Object.prototype.hasOwnProperty,Kc=Object.prototype.propertyIsEnumerable,Zc=(e,t,r)=>t in e?Wc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const eu=e=>{var t=e,{children:r}=t,a=((e,t)=>{var r={};for(var n in e)Hc.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Jc)for(var n of Jc(e))t.indexOf(n)<0&&Kc.call(e,n)&&(r[n]=e[n]);return r})(t,["children"]);return n().createElement(yc,((e,t)=>Xc(e,Yc({kind:"sub-section"})))(((e,t)=>{for(var r in t||(t={}))Hc.call(t,r)&&Zc(e,r,t[r]);if(Jc)for(var r of Jc(t))Kc.call(t,r)&&Zc(e,r,t[r]);return e})({},a)),r)};var tu=(e=>(e.NoAuth="NoAuth",e.BasicAuth="BasicAuth",e.OAuthForward="OAuthForward",e.CrossSiteCredentials="CrossSiteCredentials",e))(tu||{}),ru=Object.defineProperty,nu=Object.defineProperties,au=Object.getOwnPropertyDescriptors,ou=Object.getOwnPropertySymbols,iu=Object.prototype.hasOwnProperty,su=Object.prototype.propertyIsEnumerable,lu=(e,t,r)=>t in e?ru(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cu=(e,t)=>{for(var r in t||(t={}))iu.call(t,r)&&lu(e,r,t[r]);if(ou)for(var r of ou(t))su.call(t,r)&&lu(e,r,t[r]);return e},uu=(e,t)=>nu(e,au(t));const du={[tu.BasicAuth]:{label:"Basic authentication",value:tu.BasicAuth,description:"Authenticate with your data source username and password"},[tu.CrossSiteCredentials]:{label:"Enable cross-site access control requests",value:tu.CrossSiteCredentials,description:"Allow cross-site Access-Control requests with your existing credentials and cookies. This enables the server to authenticate the user and perform authorized requests on their behalf on other domains."},[tu.OAuthForward]:{label:"Forward OAuth Identity",value:tu.OAuthForward,description:"Forward the OAuth access token (and if available: the OIDC ID token) of the user querying to the data source"},[tu.NoAuth]:{label:"No Authentication",value:tu.NoAuth,description:"Data source is available without authentication"}},pu=({selectedMethod:e,mostCommonMethod:t,visibleMethods:i,extendedDefaultOptions:s,customMethods:l,onAuthMethodSelect:c,basicAuth:u,readOnly:d})=>{var p,f,h,g;const[m,v]=(0,r.useState)(!1),{colors:y,spacing:b}=(0,a.useTheme2)(),O=(0,r.useMemo)((()=>{var e;return null!=i?i:[tu.BasicAuth,tu.OAuthForward,tu.NoAuth,...null!=(e=null==l?void 0:l.map((e=>e.id)))?e:[]]}),[l,i]),S=O.length>1,w=(0,r.useMemo)((()=>{var e;const r=null!=(e=null==l?void 0:l.reduce(((e,t)=>(e[t.id]={label:t.label,value:t.id,description:t.description},e)),{}))?e:{},n={};let a;for(a in du)s&&s[a]?n[a]=cu(cu({},du[a]),s[a]):n[a]=du[a];const o=cu(cu({},r),n);return O.filter((e=>Boolean(o[e]))).map((e=>{const r=o[e];return e===t&&S?uu(cu({},r),{label:`${r.label} (most common)`}):r}))}),[O,l,s,t,S]);let E=e;S?e===tu.NoAuth&&t&&!m&&(E=t):E=O[0];let T=null;E===tu.BasicAuth&&u?T=n().createElement(Gc,uu(cu({},u),{readOnly:d})):E.startsWith("custom-")&&(T=null!=(f=null==(p=null==l?void 0:l.find((e=>e.id===E)))?void 0:p.component)?f:null);const x=S?"Authentication methods":null!=(h=w[0].label)?h:"",P=S?"Choose an authentication method to access the data source":null!=(g=w[0].description)?g:"",k={authMethods:(0,o.css)(cu({marginTop:b(2.5)},S&&{padding:b(2),border:`1px solid ${y.border.weak}`})),selectedMethodFields:(0,o.css)({marginTop:b(1.5)})};return n().createElement(eu,{title:x,description:P},n().createElement("div",{className:k.authMethods},S&&n().createElement(a.Select,{options:w,value:E,onChange:e=>{v(!0),c(e.value)},disabled:d}),T&&n().createElement("div",{className:k.selectedMethodFields},T)))};var fu=Object.defineProperty,hu=Object.defineProperties,gu=Object.getOwnPropertyDescriptors,mu=Object.getOwnPropertySymbols,vu=Object.prototype.hasOwnProperty,yu=Object.prototype.propertyIsEnumerable,bu=(e,t,r)=>t in e?fu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ou=(e,t)=>{for(var r in t||(t={}))vu.call(t,r)&&bu(e,r,t[r]);if(mu)for(var r of mu(t))yu.call(t,r)&&bu(e,r,t[r]);return e};const Su=e=>({configuredStyle:o.css`
      min-height: ${e.spacing(e.components.height.md)};
      padding-top: ${e.spacing(.5)};
      resize: none;
    `}),wu=e=>{var t=e,{isConfigured:n,onReset:i}=t,s=((e,t)=>{var r={};for(var n in e)vu.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&mu)for(var n of mu(e))t.indexOf(n)<0&&yu.call(e,n)&&(r[n]=e[n]);return r})(t,["isConfigured","onReset"]);const l=(0,a.useStyles2)(Su);return r.createElement(a.HorizontalGroup,null,!n&&r.createElement(a.TextArea,Ou({},s)),n&&r.createElement(a.TextArea,((e,t)=>hu(e,gu(t)))(Ou({},s),{rows:1,disabled:!0,value:"configured",className:(0,o.cx)(l.configuredStyle)})),n&&r.createElement(a.Button,{onClick:i,variant:"secondary"},"Reset"))},Eu=({children:e,enabled:t,label:r,tooltipText:i,onToggle:s,readOnly:l})=>{const{colors:c,spacing:u}=(0,a.useTheme2)(),d={container:(0,o.css)({marginTop:3}),checkboxContainer:(0,o.css)({display:"flex",alignItems:"center"}),infoIcon:(0,o.css)({marginTop:-2,marginLeft:5,color:c.text.secondary}),content:(0,o.css)({margin:u(1,0,2,3)})};return n().createElement("div",{className:d.container},n().createElement("div",{className:d.checkboxContainer},n().createElement(a.Checkbox,{value:t,label:r,onChange:()=>s(!t),disabled:l}),n().createElement(a.Tooltip,{placement:"top",content:i,interactive:!0},n().createElement(a.Icon,{name:"info-circle",className:d.infoIcon,size:"sm"}))),t&&e&&n().createElement("div",{className:d.content},e))},Tu=({enabled:e,certificateConfigured:t,onToggle:r,onCertificateChange:i,onCertificateReset:s,tooltips:l,readOnly:c})=>{var u;const d=Bc();return n().createElement(Eu,{enabled:e,label:"Add self-signed certificate",tooltipText:"Add your own Certificate Authority (CA) certificate on top of one generated by the certificate authorities for additional security measures",onToggle:e=>r(e),readOnly:c},n().createElement(a.InlineField,{label:"CA Certificate",labelWidth:24,tooltip:null!=(u=null==l?void 0:l.certificateLabel)?u:"Your self-signed certificate",required:!0,htmlFor:"self-signed-certificate-input",interactive:!0,grow:!0,className:(0,o.cx)(d.inlineFieldNoMarginRight,d.inlineFieldWithSecret),disabled:c},n().createElement(wu,{id:"self-signed-certificate-input",isConfigured:t,onChange:e=>i(e.currentTarget.value),onReset:c?()=>{}:s,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})))},xu=({enabled:e,serverName:t,clientCertificateConfigured:r,clientKeyConfigured:i,onToggle:s,onServerNameChange:l,onClientCertificateChange:c,onClientKeyChange:u,onClientCertificateReset:d,onClientKeyReset:p,tooltips:f,readOnly:h})=>{var g,m,v;const y=Bc();return n().createElement(Eu,{enabled:e,label:"TLS Client Authentication",tooltipText:"Validate using TLS client authentication, in which the server authenticates the client",onToggle:e=>s(e),readOnly:h},n().createElement(a.InlineField,{label:"ServerName",labelWidth:24,tooltip:null!=(g=null==f?void 0:f.serverNameLabel)?g:"A Servername is used to verify the hostname on the returned certificate",required:!0,htmlFor:"client-auth-servername-input",interactive:!0,grow:!0,className:y.inlineFieldNoMarginRight,disabled:h},n().createElement(a.Input,{id:"client-auth-servername-input",placeholder:"domain.example.com",value:t,onChange:e=>l(e.currentTarget.value),required:!0})),n().createElement(a.InlineField,{label:"Client Certificate",labelWidth:24,tooltip:null!=(m=null==f?void 0:f.certificateLabel)?m:"The client certificate can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-certificate-input",interactive:!0,grow:!0,className:(0,o.cx)(y.inlineFieldNoMarginRight,y.inlineFieldWithSecret),disabled:h},n().createElement(wu,{id:"client-auth-client-certificate-input",isConfigured:r,onChange:e=>c(e.currentTarget.value),onReset:h?()=>{}:d,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})),n().createElement(a.InlineField,{label:"Client Key",labelWidth:24,tooltip:null!=(v=null==f?void 0:f.keyLabel)?v:"The client key can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-key-input",interactive:!0,grow:!0,className:(0,o.cx)(y.inlineFieldNoMarginRight,y.inlineFieldWithSecret),disabled:h},n().createElement(wu,{id:"client-auth-client-key-input",isConfigured:i,onChange:e=>u(e.currentTarget.value),onReset:h?()=>{}:p,placeholder:"Begins with --- RSA PRIVATE KEY CERTIFICATE ---",rows:6,required:!0})))},Pu=({enabled:e,onToggle:t,readOnly:r})=>n().createElement(Eu,{enabled:e,label:"Skip TLS certificate validation",tooltipText:"Skipping TLS certificate validation is not recommended unless absolutely necessary or for testing",onToggle:e=>t(e),readOnly:r});var ku=Object.defineProperty,ju=Object.defineProperties,Nu=Object.getOwnPropertyDescriptors,Cu=Object.getOwnPropertySymbols,_u=Object.prototype.hasOwnProperty,Ru=Object.prototype.propertyIsEnumerable,Du=(e,t,r)=>t in e?ku(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Iu=(e,t)=>{for(var r in t||(t={}))_u.call(t,r)&&Du(e,r,t[r]);if(Cu)for(var r of Cu(t))Ru.call(t,r)&&Du(e,r,t[r]);return e},Au=(e,t)=>ju(e,Nu(t));const Fu=({selfSignedCertificate:e,TLSClientAuth:t,skipTLSVerification:r,readOnly:i})=>{const{spacing:s}=(0,a.useTheme2)(),l={container:(0,o.css)({marginTop:s(3)})};return n().createElement(eu,{className:l.container,title:"TLS settings",description:"Additional security measures that can be applied on top of authentication"},n().createElement(Tu,Au(Iu({},e),{readOnly:i})),n().createElement(xu,Au(Iu({},t),{readOnly:i})),n().createElement(Pu,Au(Iu({},r),{readOnly:i})))};var $u=Object.defineProperty,Lu=Object.defineProperties,Qu=Object.getOwnPropertyDescriptors,qu=Object.getOwnPropertySymbols,zu=Object.prototype.hasOwnProperty,Mu=Object.prototype.propertyIsEnumerable,Vu=(e,t,r)=>t in e?$u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Uu=(e,t)=>{for(var r in t||(t={}))zu.call(t,r)&&Vu(e,r,t[r]);if(qu)for(var r of qu(t))Mu.call(t,r)&&Vu(e,r,t[r]);return e},Bu=(e,t)=>Lu(e,Qu(t));const Gu=({header:e,onChange:t,onBlur:r,onDelete:i,readOnly:s})=>{const{spacing:l}=(0,a.useTheme2)(),c=Bc(),u={container:(0,o.css)({alignItems:"center"}),input:(0,o.css)({minWidth:"100%"}),headerNameField:(0,o.css)({width:"40%",marginRight:0,paddingRight:l(1)}),headerValueField:(0,o.css)({width:"45%",marginRight:0}),removeHeaderBtn:(0,o.css)({margin:"0 0 3px 10px"})};return n().createElement(n().Fragment,null,n().createElement(a.InlineFieldRow,{className:u.container},n().createElement(a.InlineField,{label:"Header",labelWidth:9,grow:!0,className:u.headerNameField,htmlFor:`custom-header-${e.id}-name-input`,disabled:s},n().createElement(a.Input,{id:`custom-header-${e.id}-name-input`,placeholder:"X-Custom-Header",value:e.name,width:12,onChange:r=>t(Bu(Uu({},e),{name:r.currentTarget.value})),onBlur:r,className:u.input})),n().createElement(a.InlineField,{label:"Value",labelWidth:9,grow:!0,className:(0,o.cx)(c.inlineFieldWithSecret,u.headerValueField),htmlFor:`custom-header-${e.id}-value-input`,disabled:s},n().createElement(Uc,{id:`custom-header-${e.id}-value-input`,isConfigured:e.configured,placeholder:"Header value",value:e.value,width:12,onChange:r=>t(Bu(Uu({},e),{value:r.currentTarget.value})),onReset:s?()=>{}:()=>t(Bu(Uu({},e),{configured:!1,value:""})),onBlur:r,className:u.input})),n().createElement(a.IconButton,{name:"trash-alt",tooltip:"Remove header",tooltipPlacement:"top",className:u.removeHeaderBtn,onClick:i,type:"button",disabled:s})))};var Wu=Object.defineProperty,Xu=Object.defineProperties,Yu=Object.getOwnPropertyDescriptors,Ju=Object.getOwnPropertySymbols,Hu=Object.prototype.hasOwnProperty,Ku=Object.prototype.propertyIsEnumerable,Zu=(e,t,r)=>t in e?Wu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ed=(e,t)=>{for(var r in t||(t={}))Hu.call(t,r)&&Zu(e,r,t[r]);if(Ju)for(var r of Ju(t))Ku.call(t,r)&&Zu(e,r,t[r]);return e},td=(e,t)=>Xu(e,Yu(t));const rd=({headers:e,onChange:t,readOnly:i})=>{const{spacing:s}=(0,a.useTheme2)(),[l,c]=(0,r.useState)(e.map((e=>td(ed({},e),{id:nd(),value:""}))));(0,r.useEffect)((()=>{c((t=>{let r=!1;const n=t.map((t=>{var n;const a=null==(n=e.find((e=>e.name===t.name)))?void 0:n.configured;return void 0!==a&&t.configured!==a?(r=!0,td(ed({},t),{configured:a})):t}));return r?n:t}))}),[e]);const u=()=>{t(l.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))},d={container:(0,o.css)({marginTop:s(3)}),addHeaderButton:(0,o.css)({marginTop:s(1.5)})};return n().createElement("div",{className:d.container},n().createElement(eu,{title:"HTTP headers",description:"Pass along additional context and metadata about the request/response",isCollapsible:!0,isInitiallyOpen:l.length>0},n().createElement("div",null,l.map((e=>n().createElement(Gu,{key:e.id,header:e,onChange:e=>((e,t)=>{c(l.map((r=>r.id===e?ed({},t):r)))})(e.id,e),onDelete:()=>(e=>{const r=l.findIndex((t=>t.id===e));if(-1===r)return;const n=[...l];n.splice(r,1),c(n),t(n.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))})(e.id),onBlur:u,readOnly:i})))),n().createElement("div",{className:d.addHeaderButton},n().createElement(a.Button,{icon:"plus",variant:"secondary",fill:"outline",onClick:()=>{c([...l,{id:nd(),name:"",value:"",configured:!1}])},disabled:i},0===l.length?"Add header":"Add another header"))))};function nd(){return Math.random().toString(16).slice(2)}var ad=Object.defineProperty,od=Object.defineProperties,id=Object.getOwnPropertyDescriptors,sd=Object.getOwnPropertySymbols,ld=Object.prototype.hasOwnProperty,cd=Object.prototype.propertyIsEnumerable,ud=(e,t,r)=>t in e?ad(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dd=(e,t)=>{for(var r in t||(t={}))ld.call(t,r)&&ud(e,r,t[r]);if(sd)for(var r of sd(t))cd.call(t,r)&&ud(e,r,t[r]);return e},pd=(e,t)=>od(e,id(t));const fd=({selectedMethod:e,mostCommonMethod:t,visibleMethods:r,extendedDefaultOptions:a,customMethods:i,onAuthMethodSelect:s,basicAuth:l,TLS:c,customHeaders:u,readOnly:d=!1})=>{const p={container:(0,o.css)({maxWidth:578})};return n().createElement("div",{className:p.container},n().createElement(Pc,{title:"Authentication"},n().createElement(pu,{selectedMethod:e,mostCommonMethod:t,customMethods:i,visibleMethods:r,extendedDefaultOptions:a,onAuthMethodSelect:s,basicAuth:l,readOnly:d}),c&&n().createElement(Fu,pd(dd({},c),{readOnly:d})),u&&n().createElement(rd,pd(dd({},u),{readOnly:d}))))};var hd=Object.defineProperty,gd=Object.defineProperties,md=Object.getOwnPropertyDescriptors,vd=Object.getOwnPropertySymbols,yd=Object.prototype.hasOwnProperty,bd=Object.prototype.propertyIsEnumerable,Od=(e,t,r)=>t in e?hd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Sd=(e,t)=>{for(var r in t||(t={}))yd.call(t,r)&&Od(e,r,t[r]);if(vd)for(var r of vd(t))bd.call(t,r)&&Od(e,r,t[r]);return e},wd=(e,t)=>gd(e,md(t));const Ed="httpHeaderName",Td="httpHeaderValue";function xd(e){return e.basicAuth?tu.BasicAuth:e.withCredentials?tu.CrossSiteCredentials:e.jsonData.oauthPassThru?tu.OAuthForward:tu.NoAuth}function Pd(e,t){return r=>{t(wd(Sd({},e),{basicAuth:r===tu.BasicAuth,withCredentials:r===tu.CrossSiteCredentials,jsonData:wd(Sd({},e.jsonData),{oauthPassThru:r===tu.OAuthForward})}))}}function kd(e,t){return{user:e.basicAuthUser,passwordConfigured:e.secureJsonFields.basicAuthPassword,onUserChange:r=>t(wd(Sd({},e),{basicAuthUser:r})),onPasswordChange:r=>t(wd(Sd({},e),{secureJsonData:wd(Sd({},e.secureJsonData),{basicAuthPassword:r})})),onPasswordReset:()=>t(wd(Sd({},e),{secureJsonData:wd(Sd({},e.secureJsonData),{basicAuthPassword:""}),secureJsonFields:wd(Sd({},e.secureJsonFields),{basicAuthPassword:!1})}))}}function jd(e,t){return{selfSignedCertificate:{enabled:Boolean(e.jsonData.tlsAuthWithCACert),certificateConfigured:e.secureJsonFields.tlsCACert,onToggle:r=>t(wd(Sd({},e),{jsonData:wd(Sd({},e.jsonData),{tlsAuthWithCACert:r})})),onCertificateChange:r=>t(wd(Sd({},e),{secureJsonData:wd(Sd({},e.secureJsonData),{tlsCACert:r})})),onCertificateReset:()=>t(wd(Sd({},e),{secureJsonData:wd(Sd({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:wd(Sd({},e.secureJsonFields),{tlsCACert:!1})}))},TLSClientAuth:{enabled:e.jsonData.tlsAuth,serverName:e.jsonData.serverName,clientCertificateConfigured:e.secureJsonFields.tlsClientCert,clientKeyConfigured:e.secureJsonFields.tlsClientKey,onToggle:r=>t(wd(Sd({},e),{jsonData:wd(Sd({},e.jsonData),{tlsAuth:r})})),onServerNameChange:r=>t(wd(Sd({},e),{jsonData:wd(Sd({},e.jsonData),{serverName:r})})),onClientCertificateChange:r=>t(wd(Sd({},e),{secureJsonData:wd(Sd({},e.secureJsonData),{tlsClientCert:r})})),onClientCertificateReset:()=>t(wd(Sd({},e),{secureJsonData:wd(Sd({},e.secureJsonData),{tlsClientCert:""}),secureJsonFields:wd(Sd({},e.secureJsonFields),{tlsClientCert:!1})})),onClientKeyChange:r=>t(wd(Sd({},e),{secureJsonData:wd(Sd({},e.secureJsonData),{tlsClientKey:r})})),onClientKeyReset:()=>t(wd(Sd({},e),{secureJsonData:wd(Sd({},e.secureJsonData),{tlsClientKey:""}),secureJsonFields:wd(Sd({},e.secureJsonFields),{tlsClientKey:!1})}))},skipTLSVerification:{enabled:e.jsonData.tlsSkipVerify,onToggle:r=>t(wd(Sd({},e),{jsonData:wd(Sd({},e.jsonData),{tlsSkipVerify:r})}))}}}function Nd(e,t){return{headers:Object.keys(e.jsonData).filter((e=>e.startsWith(Ed))).sort().map((t=>{var r;const n=t.slice(14);return{name:e.jsonData[t],configured:null!=(r=e.secureJsonFields[`${Td}${n}`])&&r}})),onChange:r=>{const n=Object.fromEntries(Object.entries(e.jsonData).filter((([e])=>!e.startsWith(Ed)))),a=Object.fromEntries(Object.entries(e.secureJsonData||{}).filter((([e])=>!e.startsWith(Td)))),o=Object.fromEntries(Object.entries(e.secureJsonFields).filter((([e])=>!e.startsWith(Td))));r.forEach(((e,t)=>{n[`${Ed}${t+1}`]=e.name,e.configured?o[`${Td}${t+1}`]=!0:a[`${Td}${t+1}`]=e.value})),t(wd(Sd({},e),{jsonData:n,secureJsonData:a,secureJsonFields:o}))}}}var Cd=Object.defineProperty,_d=Object.defineProperties,Rd=Object.getOwnPropertyDescriptors,Dd=Object.getOwnPropertySymbols,Id=Object.prototype.hasOwnProperty,Ad=Object.prototype.propertyIsEnumerable,Fd=(e,t,r)=>t in e?Cd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$d=(e,t)=>{for(var r in t||(t={}))Id.call(t,r)&&Fd(e,r,t[r]);if(Dd)for(var r of Dd(t))Ad.call(t,r)&&Fd(e,r,t[r]);return e},Ld=(e,t)=>_d(e,Rd(t));const Qd=({config:e,onChange:t,className:r})=>{const i={container:(0,o.css)({maxWidth:578})};return n().createElement(eu,{title:"Advanced HTTP settings",className:(0,o.cx)(i.container,r)},n().createElement(a.InlineField,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:e.readOnly,grow:!0},n().createElement(a.TagsInput,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:e.jsonData.keepCookies,onChange:r=>{t(Ld($d({},e),{jsonData:Ld($d({},e.jsonData),{keepCookies:r})}))}})),n().createElement(a.InlineField,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:e.readOnly,grow:!0},n().createElement(a.Input,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:e.jsonData.timeout,onChange:r=>{t(Ld($d({},e),{jsonData:Ld($d({},e.jsonData),{timeout:parseInt(r.currentTarget.value,10)})}))}})))};function qd(e){const{description:t,suffix:r,feature:o}=e,i=`Learn more about ${o}`,s=(0,a.useStyles2)(zd);return n().createElement("span",{className:s.container},t,n().createElement("a",{"aria-label":i,href:`https://grafana.com/docs/grafana/next/datasources/${r}`,rel:"noreferrer",target:"_blank"},i))}const zd=e=>({container:(0,o.css)({color:e.colors.text.secondary,a:(0,o.css)({color:e.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})});const Md=/^(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])$/,Vd=(e,t)=>!(e.match(t)||!e),Ud=e=>{const t=e.validationRegex||Md,[o,i]=(0,r.useState)((()=>!!e.value&&Vd(e.value,t)));var s;!function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=[]);var a=function(e,t){void 0===t&&(t=0);var n=(0,r.useRef)(!1),a=(0,r.useRef)(),o=(0,r.useRef)(e),i=(0,r.useCallback)((function(){return n.current}),[]),s=(0,r.useCallback)((function(){n.current=!1,a.current&&clearTimeout(a.current),a.current=setTimeout((function(){n.current=!0,o.current()}),t)}),[t]),l=(0,r.useCallback)((function(){n.current=null,a.current&&clearTimeout(a.current)}),[]);return(0,r.useEffect)((function(){o.current=e}),[e]),(0,r.useEffect)((function(){return s(),l}),[t]),[i,l,s]}(e,t),o=a[0],i=a[1],s=a[2];(0,r.useEffect)(s,n)}((()=>{i(Vd(e.value,t))}),500,[e.value]);const l={labelWidth:26,disabled:null!==(s=e.disabled)&&void 0!==s&&s,invalid:o,error:e.isInvalidError};return e.label&&(l.label=e.label,l.tooltip=e.tooltip||""),n().createElement(a.InlineField,l,n().createElement(a.Input,{type:"text",placeholder:e.placeholder||"0",width:e.width||40,onChange:t=>{e.onChange(t.currentTarget.value)},value:e.value,"aria-label":e.ariaLabel||"interval input"}))};function Bd(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gd(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Bd(e,t,r[t])}))}return e}function Wd(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Xd=({values:e,onChange:t,id:r})=>{const i=(0,a.useStyles2)(Yd);return n().createElement("div",{className:i.wrapper},e.length?e.map(((s,l)=>n().createElement("div",{className:i.pair,key:l},n().createElement(a.SegmentInput,{id:`${r}-key-${l}`,placeholder:"Tag name",value:s.key,onChange:r=>{t(e.map(((e,t)=>t===l?Wd(Gd({},e),{key:String(r)}):e)))}}),n().createElement(a.InlineLabel,{"aria-label":"equals",className:i.operator},"as"),n().createElement(a.SegmentInput,{id:`${r}-value-${l}`,placeholder:"New name (optional)",value:s.value||"",onChange:r=>{t(e.map(((e,t)=>t===l?Wd(Gd({},e),{value:String(r)}):e)))}}),n().createElement(a.ToolbarButton,{onClick:()=>t([...e.slice(0,l),...e.slice(l+1)]),className:(0,o.cx)(i.removeTag,"query-part"),"aria-label":"Remove tag",type:"button",icon:"times"}),l===e.length-1?n().createElement(a.ToolbarButton,{onClick:()=>t([...e,{key:"",value:""}]),className:"query-part","aria-label":"Add tag",type:"button",icon:"plus"}):null))):n().createElement(a.ToolbarButton,{icon:"plus",onClick:()=>t([...e,{key:"",value:""}]),className:"query-part","aria-label":"Add tag",type:"button"}))},Yd=e=>({wrapper:(0,o.css)({display:"flex",flexDirection:"column",gap:`${e.spacing(.5)} 0`}),pair:(0,o.css)({display:"flex",justifyContent:"start",alignItems:"center"}),operator:(0,o.css)({color:e.v1.palette.orange,width:"auto"}),removeTag:(0,o.css)({marginRight:e.spacing(.5)})});function Jd(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Hd(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Jd(e,t,r[t])}))}return e}function Kd(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Zd({options:e,onOptionsChange:i}){const s=["loki","elasticsearch","grafana-splunk-datasource","grafana-opensearch-datasource","grafana-falconlogscale-datasource","googlecloud-logging-datasource"],l=(0,r.useMemo)((()=>function(e){var t;if(null==e?void 0:e.tracesToLogsV2)return e.tracesToLogsV2;if(!(null==e?void 0:e.tracesToLogs))return;const r={customQuery:!1};return r.datasourceUid=e.tracesToLogs.datasourceUid,r.tags=e.tracesToLogs.mapTagNamesEnabled?e.tracesToLogs.mappedTags:null===(t=e.tracesToLogs.tags)||void 0===t?void 0:t.map((e=>({key:e}))),r.filterByTraceID=e.tracesToLogs.filterByTraceID,r.filterBySpanID=e.tracesToLogs.filterBySpanID,r.spanStartTimeShift=e.tracesToLogs.spanStartTimeShift,r.spanEndTimeShift=e.tracesToLogs.spanEndTimeShift,r}(e.jsonData)||{customQuery:!1}),[e.jsonData]),{query:c="",tags:u,customQuery:d}=l,p=(0,r.useCallback)((t=>{i(Kd(Hd({},e),{jsonData:Kd(Hd({},e.jsonData),{tracesToLogsV2:Hd({},l,t),tracesToLogs:void 0})}))}),[i,e,l]);return n().createElement("div",{className:(0,o.css)({width:"100%"})},n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{tooltip:"The logs data source the trace is going to navigate to",label:"Data source",labelWidth:26},n().createElement(t.DataSourcePicker,{inputId:"trace-to-logs-data-source-picker",filter:e=>s.includes(e.type),current:l.datasourceUid,noDefault:!0,width:40,onChange:e=>p({datasourceUid:e.uid})}))),n().createElement(a.InlineFieldRow,null,n().createElement(Ud,{label:tp("start"),tooltip:rp("start","0"),value:l.spanStartTimeShift||"",onChange:e=>{p({spanStartTimeShift:e})},isInvalidError:np})),n().createElement(a.InlineFieldRow,null,n().createElement(Ud,{label:tp("end"),tooltip:rp("end","0"),value:l.spanEndTimeShift||"",onChange:e=>{p({spanEndTimeShift:e})},isInvalidError:np})),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'cluster', 'hostname', 'namespace', 'pod', 'service.name', 'service.namespace'",label:"Tags",labelWidth:26},n().createElement(Xd,{values:null!=u?u:[],onChange:e=>p({tags:e})}))),n().createElement(ep,{disabled:d,type:"trace",id:"filterByTraceID",value:Boolean(l.filterByTraceID),onChange:e=>p({filterByTraceID:e})}),n().createElement(ep,{disabled:d,type:"span",id:"filterBySpanID",value:Boolean(l.filterBySpanID),onChange:e=>p({filterBySpanID:e})}),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26},n().createElement(a.InlineSwitch,{id:"customQuerySwitch",value:d,onChange:e=>p({customQuery:e.currentTarget.checked})}))),d&&n().createElement(a.InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to logs data source. Interpolate tags using the `$__tags` keyword",grow:!0},n().createElement(a.Input,{label:"Query",type:"text",allowFullScreen:!0,value:c,onChange:e=>p({query:e.currentTarget.value})})))}function ep(e){return n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{disabled:e.disabled,label:`Filter by ${e.type} ID`,labelWidth:26,grow:!0,tooltip:`Filters logs by ${e.type} ID`},n().createElement(a.InlineSwitch,{id:e.id,value:e.value,onChange:t=>e.onChange(t.currentTarget.checked)})))}const tp=e=>`Span ${e} time shift`,rp=(e,t)=>`Shifts the ${e} time of the span. Default: ${t} (Time units can be used here, for example: 5s, -1m, 3h)`,np="Invalid time shift. See tooltip for examples.",ap=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#trace-to-logs":"/#trace-to-logs",n().createElement(Pc,{title:"Trace to logs",description:n().createElement(qd,{description:"Navigate from a trace span to the selected data source's logs.",suffix:r,feature:"trace to logs"}),isCollapsible:!0,isInitiallyOpen:!0},n().createElement(Zd,{options:e,onOptionsChange:t}))};function op(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ip(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){op(e,t,r[t])}))}return e}function sp(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function lp({options:r,onOptionsChange:i}){var s,l,c,u,d,p,f;const h=(0,a.useStyles2)(up);var g;return n().createElement("div",{className:(0,o.css)({width:"100%"})},n().createElement(a.InlineFieldRow,{className:h.row},n().createElement(a.InlineField,{tooltip:"The Prometheus data source the trace is going to navigate to",label:"Data source",labelWidth:26},n().createElement(t.DataSourcePicker,{inputId:"trace-to-metrics-data-source-picker",pluginId:"prometheus",current:null===(s=r.jsonData.tracesToMetrics)||void 0===s?void 0:s.datasourceUid,noDefault:!0,width:40,onChange:t=>(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{datasourceUid:t.uid}))})),(null===(l=r.jsonData.tracesToMetrics)||void 0===l?void 0:l.datasourceUid)?n().createElement(a.Button,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{datasourceUid:void 0}))}},"Clear"):null),n().createElement(a.InlineFieldRow,null,n().createElement(Ud,{label:tp("start"),tooltip:rp("start","-2m"),value:(null===(c=r.jsonData.tracesToMetrics)||void 0===c?void 0:c.spanStartTimeShift)||"",onChange:t=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{spanStartTimeShift:t}))},placeholder:"-2m",isInvalidError:np})),n().createElement(a.InlineFieldRow,null,n().createElement(Ud,{label:tp("end"),tooltip:rp("end","2m"),value:(null===(u=r.jsonData.tracesToMetrics)||void 0===u?void 0:u.spanEndTimeShift)||"",onChange:t=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{spanEndTimeShift:t}))},placeholder:"2m",isInvalidError:np})),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{tooltip:"Tags that will be used in the metrics query",label:"Tags",labelWidth:26},n().createElement(Xd,{values:null!==(g=null===(d=r.jsonData.tracesToMetrics)||void 0===d?void 0:d.tags)&&void 0!==g?g:[],onChange:t=>(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{tags:t}))}))),null===(f=r.jsonData.tracesToMetrics)||void 0===f||null===(p=f.queries)||void 0===p?void 0:p.map(((t,o)=>n().createElement("div",{key:o,className:h.queryRow},n().createElement(a.InlineField,{label:"Link Label",labelWidth:26,tooltip:"Descriptive label for the linked query"},n().createElement(a.Input,{label:"Link Label",type:"text",allowFullScreen:!0,value:t.name,width:40,onChange:t=>{var n,a;const s=(null!==(a=null===(n=r.jsonData.tracesToMetrics)||void 0===n?void 0:n.queries)&&void 0!==a?a:[]).map(((e,r)=>r===o?sp(ip({},e),{name:t.currentTarget.value}):e));(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{queries:s}))}})),n().createElement(a.InlineField,{label:"Query",labelWidth:10,tooltip:"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword",grow:!0},n().createElement(a.Input,{label:"Query",type:"text",allowFullScreen:!0,value:t.query,onChange:t=>{var n,a;const s=(null!==(a=null===(n=r.jsonData.tracesToMetrics)||void 0===n?void 0:n.queries)&&void 0!==a?a:[]).map(((e,r)=>r===o?sp(ip({},e),{query:t.currentTarget.value}):e));(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{queries:s}))}})),n().createElement(a.Button,{variant:"destructive",title:"Remove query",icon:"times",type:"button",onClick:()=>{var t;const n=null===(t=r.jsonData.tracesToMetrics)||void 0===t?void 0:t.queries.filter(((e,t)=>t!==o));(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{queries:n}))}})))),n().createElement(a.Button,{variant:"secondary",title:"Add query",icon:"plus",type:"button",onClick:()=>{var t,n;(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:i,options:r},"tracesToMetrics",sp(ip({},r.jsonData.tracesToMetrics),{queries:[...null!==(n=null===(t=r.jsonData.tracesToMetrics)||void 0===t?void 0:t.queries)&&void 0!==n?n:[],{query:""}]}))}},"Add query"))}const cp=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#trace-to-metrics":"/#trace-to-metrics",n().createElement(Pc,{title:"Trace to metrics",description:n().createElement(qd,{description:"Navigate from a trace span to the selected data source's metrics.",suffix:r,feature:"trace to metrics"}),isCollapsible:!0,isInitiallyOpen:!0},n().createElement(lp,{options:e,onOptionsChange:t}))},up=e=>({infoText:{paddingBottom:e.spacing(2),color:e.colors.text.secondary},row:(0,o.css)({label:"row",alignItems:"baseline"}),queryRow:(0,o.css)({label:"queryRow",display:"flex",flexFlow:"wrap"})});function dp(e,t){void 0===t&&(t=[]);var n=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var a,o,i=(0,r.useRef)(0),s=(a=(0,r.useRef)(!1),o=(0,r.useCallback)((function(){return a.current}),[]),(0,r.useEffect)((function(){return a.current=!0,function(){a.current=!1}}),[]),o),l=(0,r.useState)(n),c=l[0],u=l[1],d=(0,r.useCallback)((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=++i.current;return c.loading||u((function(e){return(0,St.__assign)((0,St.__assign)({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return s()&&n===i.current&&u({value:e,loading:!1}),e}),(function(e){return s()&&n===i.current&&u({error:e,loading:!1}),e}))}),t);return[c,d]}(e,t,{loading:!0}),a=n[0],o=n[1];return(0,r.useEffect)((function(){o()}),[o]),a}function pp(e){const t=(o=e.profileTypes,(0,r.useMemo)((()=>{if(!o)return[];let e=new Map;for(let r of o){var t;let n=[];r.id.indexOf(":")>-1&&(n=r.id.split(":"));const[a,o]=n;e.has(a)||e.set(a,{label:a,value:a,items:[]}),null===(t=e.get(a))||void 0===t||t.items.push({label:o,value:r.id})}return Array.from(e.values())}),[o]));var o,i;return n().createElement(a.Cascader,{placeholder:e.placeholder,separator:"-",displayAllSelectedLevels:!0,initialValue:e.initialProfileTypeId,allowCustomValue:!0,onSelect:e.onChange,options:t,changeOnSelect:!1,width:null!==(i=e.width)&&void 0!==i?i:26})}function fp(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function hp(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){fp(o,n,a,i,s,"next",e)}function s(e){fp(o,n,a,i,s,"throw",e)}i(void 0)}))}}function gp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){gp(e,t,r[t])}))}return e}function vp(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function yp({options:i,onOptionsChange:s}){var l,c,u,d,p,f,h,g;const m=(0,r.useMemo)((()=>["grafana-pyroscope-datasource"]),[]),[v,y]=(0,r.useState)([]),b=(0,r.useMemo)((()=>{var e;let t=0===v.length?"No profile types found":"Select profile type";return(null===(e=i.jsonData.tracesToProfiles)||void 0===e?void 0:e.datasourceUid)||(t="Please select profiling data source"),t}),[null===(l=i.jsonData.tracesToProfiles)||void 0===l?void 0:l.datasourceUid,v]),{value:O}=dp(hp((function*(){var e;return yield(0,t.getDataSourceSrv)().get(null===(e=i.jsonData.tracesToProfiles)||void 0===e?void 0:e.datasourceUid)})),[null===(c=i.jsonData.tracesToProfiles)||void 0===c?void 0:c.datasourceUid]),{value:S}=dp(hp((function*(){var e;if(O instanceof t.DataSourceWithBackend&&m.includes(O.type)&&O.uid===(null===(e=i.jsonData.tracesToProfiles)||void 0===e?void 0:e.datasourceUid))return yield null==O?void 0:O.getResource("profileTypes")})),[O]);var w;return(0,r.useEffect)((()=>{y(null!=S?S:[])}),[S]),n().createElement("div",{className:(0,o.css)({width:"100%"})},n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{tooltip:"The profiles data source the trace is going to navigate to",label:"Data source",labelWidth:26},n().createElement(t.DataSourcePicker,{inputId:"trace-to-profiles-data-source-picker",filter:e=>m.includes(e.type),current:null===(u=i.jsonData.tracesToProfiles)||void 0===u?void 0:u.datasourceUid,noDefault:!0,width:40,onChange:t=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:s,options:i},"tracesToProfiles",vp(mp({},i.jsonData.tracesToProfiles),{datasourceUid:t.uid}))}}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'service.name', 'service.namespace'",label:"Tags",labelWidth:26},n().createElement(Xd,{values:null!==(w=null===(d=i.jsonData.tracesToProfiles)||void 0===d?void 0:d.tags)&&void 0!==w?w:[],onChange:t=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:s,options:i},"tracesToProfiles",vp(mp({},i.jsonData.tracesToProfiles),{tags:t}))}}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{tooltip:"Profile type that will be used in the query",label:"Profile type",labelWidth:26},n().createElement(pp,{profileTypes:v,placeholder:b,initialProfileTypeId:null===(p=i.jsonData.tracesToProfiles)||void 0===p?void 0:p.profileTypeId,onChange:t=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:s,options:i},"tracesToProfiles",vp(mp({},i.jsonData.tracesToProfiles),{profileTypeId:t}))},width:40}))),n().createElement(a.InlineFieldRow,null,n().createElement(a.InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26},n().createElement(a.InlineSwitch,{id:"profilesCustomQuerySwitch",value:null===(f=i.jsonData.tracesToProfiles)||void 0===f?void 0:f.customQuery,onChange:t=>(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:s,options:i},"tracesToProfiles",vp(mp({},i.jsonData.tracesToProfiles),{customQuery:t.currentTarget.checked}))}))),(null===(h=i.jsonData.tracesToProfiles)||void 0===h?void 0:h.customQuery)&&n().createElement(a.InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to profiles data source. Interpolate tags using the `$__tags` keyword",grow:!0},n().createElement(a.Input,{label:"Query",type:"text",allowFullScreen:!0,value:(null===(g=i.jsonData.tracesToProfiles)||void 0===g?void 0:g.query)||"",onChange:t=>(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:s,options:i},"tracesToProfiles",vp(mp({},i.jsonData.tracesToProfiles),{query:t.currentTarget.value}))})))}const bp=({options:e,onOptionsChange:t})=>n().createElement(Pc,{title:"Trace to profiles",description:n().createElement(qd,{description:"Navigate from a trace span to the selected data source's profiles.",suffix:`${e.type}/configure-tempo-data-source/#trace-to-profiles`,feature:"trace to profiles"}),isCollapsible:!0,isInitiallyOpen:!0},n().createElement(yp,{options:e,onOptionsChange:t}));function Op(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Sp({options:t,onOptionsChange:r}){var o;const i=(0,a.useStyles2)(Ep);return n().createElement("div",{className:i.container},n().createElement(a.InlineFieldRow,{className:i.row},n().createElement(a.InlineField,{tooltip:"Displays the node graph above the trace view. Default: disabled",label:"Enable node graph",labelWidth:26},n().createElement(a.InlineSwitch,{id:"enableNodeGraph",value:null===(o=t.jsonData.nodeGraph)||void 0===o?void 0:o.enabled,onChange:n=>{return(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:t},"nodeGraph",(a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Op(e,t,r[t])}))}return e}({},t.jsonData.nodeGraph),o=null!=(o={enabled:n.currentTarget.checked})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(o)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(o,e))})),a));var a,o}}))))}const wp=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#node-graph":"/#node-graph",n().createElement(eu,{title:"Node graph",description:n().createElement(qd,{description:"Show or hide the node graph visualization.",suffix:r,feature:"the node graph"})},n().createElement(Sp,{options:e,onOptionsChange:t}))},Ep=e=>({infoText:(0,o.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),container:(0,o.css)({label:"container",width:"100%"}),row:(0,o.css)({label:"row",alignItems:"baseline"})});function Tp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Tp(e,t,r[t])}))}return e}function Pp(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const kp="None",jp="Duration",Np="Tag";function Cp({options:t,onOptionsChange:r}){var i,s,l;const c=(0,a.useStyles2)(Rp),u=[kp,jp,Np].map(e.toOption);return n().createElement("div",{className:(0,o.css)({width:"100%"})},n().createElement(a.InlineFieldRow,{className:c.row},n().createElement(a.InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0},n().createElement(a.Select,{inputId:"label",options:u,value:(null===(i=t.jsonData.spanBar)||void 0===i?void 0:i.type)||"",onChange:n=>{var a;(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:t},"spanBar",Pp(xp({},t.jsonData.spanBar),{type:null!==(a=null==n?void 0:n.value)&&void 0!==a?a:""}))},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40}))),(null===(s=t.jsonData.spanBar)||void 0===s?void 0:s.type)===Np&&n().createElement(a.InlineFieldRow,{className:c.row},n().createElement(a.InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key"},n().createElement(a.Input,{type:"text",placeholder:"Enter tag key",onChange:n=>(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:t},"spanBar",Pp(xp({},t.jsonData.spanBar),{tag:n.currentTarget.value})),value:(null===(l=t.jsonData.spanBar)||void 0===l?void 0:l.tag)||"",width:40}))))}const _p=({options:e,onOptionsChange:t})=>{let r=e.type;return r+="tempo"===e.type?"/configure-tempo-data-source/#span-bar":"/#span-bar",n().createElement(eu,{title:"Span bar",description:n().createElement(qd,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:r,feature:"the span bar"})},n().createElement(Cp,{options:e,onOptionsChange:t}))},Rp=e=>({infoText:(0,o.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:(0,o.css)({label:"row",alignItems:"baseline"})});function Dp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ip(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Dp(e,t,r[t])}))}return e}function Ap(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Fp({options:t,onOptionsChange:r}){var o,i,s,l,c;const u=(0,a.useStyles2)($p),d=e=>`Time shift for ${e} of search`,p=e=>`Shifts the ${e} of the time range when searching by TraceID. Searching can return traces that do not fully fall into the search time range, so we recommend using higher time shifts for longer traces. Default: 30m (Time units can be used here, for example: 5s, 1m, 3h`;return n().createElement("div",{className:u.container},n().createElement(a.InlineField,{label:"Use time range in query",tooltip:"The time range can be used when there are performance issues or timeouts since it will narrow down the search to the defined range. Default: disabled",labelWidth:26},n().createElement(a.InlineSwitch,{id:"enable-time-shift",value:(null===(o=t.jsonData.traceQuery)||void 0===o?void 0:o.timeShiftEnabled)||!1,onChange:n=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:t},"traceQuery",Ap(Ip({},t.jsonData.traceQuery),{timeShiftEnabled:n.currentTarget.checked}))}})),n().createElement(Ud,{label:d("start"),tooltip:p("start"),value:(null===(i=t.jsonData.traceQuery)||void 0===i?void 0:i.spanStartTimeShift)||"",disabled:!(null===(s=t.jsonData.traceQuery)||void 0===s?void 0:s.timeShiftEnabled),onChange:n=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:t},"traceQuery",Ap(Ip({},t.jsonData.traceQuery),{spanStartTimeShift:n}))},isInvalidError:np}),n().createElement(Ud,{label:d("end"),tooltip:p("end"),value:(null===(l=t.jsonData.traceQuery)||void 0===l?void 0:l.spanEndTimeShift)||"",disabled:!(null===(c=t.jsonData.traceQuery)||void 0===c?void 0:c.timeShiftEnabled),onChange:n=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:r,options:t},"traceQuery",Ap(Ip({},t.jsonData.traceQuery),{spanEndTimeShift:n}))},isInvalidError:np}))}const $p=e=>({infoText:(0,o.css)({paddingBottom:e.spacing(2),color:e.colors.text.secondary}),container:(0,o.css)({width:"100%"}),row:(0,o.css)({alignItems:"baseline"})});function Lp({options:r,onOptionsChange:o}){var i,s,l,c;const u=(0,a.useStyles2)($p),d=!1!==(null===(i=r.jsonData.tracesToLogs)||void 0===i?void 0:i.lokiSearch)?null===(s=r.jsonData.tracesToLogs)||void 0===s?void 0:s.datasourceUid:void 0;return d&&void 0===r.jsonData.lokiSearch&&(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:r},"lokiSearch",{datasourceUid:d}),n().createElement("div",{className:u.container},n().createElement(a.InlineFieldRow,{className:u.row},n().createElement(a.InlineField,{tooltip:"The Loki data source with the service graph data",label:"Data source",labelWidth:26},n().createElement(t.DataSourcePicker,{inputId:"loki-search-data-source-picker",pluginId:"loki",current:null===(l=r.jsonData.lokiSearch)||void 0===l?void 0:l.datasourceUid,noDefault:!0,width:40,onChange:t=>(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:r},"lokiSearch",{datasourceUid:t.uid})})),(null===(c=r.jsonData.lokiSearch)||void 0===c?void 0:c.datasourceUid)?n().createElement(a.Button,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:r},"lokiSearch",{datasourceUid:void 0})}},"Clear"):null))}function Qp({options:r,onOptionsChange:o}){var i,s;const l=(0,a.useStyles2)($p);return n().createElement("div",{className:l.container},n().createElement(a.InlineFieldRow,{className:l.row},n().createElement(a.InlineField,{tooltip:"The Prometheus data source with the service graph data",label:"Data source",labelWidth:26},n().createElement(t.DataSourcePicker,{inputId:"service-graph-data-source-picker",pluginId:"prometheus",current:null===(i=r.jsonData.serviceMap)||void 0===i?void 0:i.datasourceUid,noDefault:!0,width:40,onChange:t=>(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:r},"serviceMap",{datasourceUid:t.uid})})),(null===(s=r.jsonData.serviceMap)||void 0===s?void 0:s.datasourceUid)?n().createElement(a.Button,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:r},"serviceMap",{datasourceUid:void 0})}},"Clear"):null))}function qp(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function zp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){zp(e,t,r[t])}))}return e}function Vp(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Up({options:t,onOptionsChange:o,datasource:s}){var l,c,u;const d=function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){qp(o,n,a,i,s,"next",e)}function s(e){qp(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(){if(!s)throw new Error("Unable to retrieve datasource");try{yield s.languageProvider.start()}catch(e){throw new Error(y(e.data.message,"Unable to query Tempo"))}}));return function(){return e.apply(this,arguments)}}(),{error:p,loading:f}=(0,i.c)(d,[s,t]),h=(0,r.useCallback)((r=>{var n;let a=null===(n=t.jsonData.search)||void 0===n?void 0:n.filters;a||(a=[]);const i=a.findIndex((e=>e.id===r.id));i>=0?a=fn(a,i,r):a.push(r),(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:t},"search",Vp(Mp({},t.jsonData.search),{filters:a}))}),[o,t]);(0,r.useEffect)((()=>{var r;(null===(r=t.jsonData.search)||void 0===r?void 0:r.filters)||(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:t},"search",Vp(Mp({},t.jsonData.search),{filters:[{id:"service-name",tag:"service.name",operator:"=",scope:Gr.Resource},{id:"span-name",tag:"name",operator:"=",scope:Gr.Span}]}))}),[o,t]);const g=null===(c=t.jsonData.search)||void 0===c||null===(l=c.filters)||void 0===l?void 0:l.find((e=>!e.tag));return n().createElement(n().Fragment,null,s?n().createElement(ui,{updateFilter:h,deleteFilter:r=>{var n,a;(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:t},"search",Vp(Mp({},t.jsonData.search),{filters:null===(a=t.jsonData.search)||void 0===a||null===(n=a.filters)||void 0===n?void 0:n.filter((e=>e.id!==r.id))}))},filters:(null===(u=t.jsonData.search)||void 0===u?void 0:u.filters)||[],datasource:s,setError:()=>{},staticTags:["duration"],isTagsLoading:f,hideValues:!0,query:"{}"}):n().createElement("div",null,"Invalid data source, please create a valid data source and try again"),p&&n().createElement(a.Alert,{title:"Unable to fetch TraceQL tags",severity:"error",topSpacing:1},p.message),g&&n().createElement(a.Alert,{title:"Please ensure each filter has a selected tag",severity:"warning",topSpacing:1}))}function Bp(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Gp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wp({options:r,onOptionsChange:o}){var s;const l=(0,a.useStyles2)($p),c=(0,t.getDataSourceSrv)(),u=function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Bp(o,n,a,i,s,"next",e)}function s(e){Bp(o,n,a,i,s,"throw",e)}i(void 0)}))}}((function*(){return yield c.get({type:r.type,uid:r.uid})}));return function(){return e.apply(this,arguments)}}(),{value:d}=(0,i.c)(u,[c,r]);return n().createElement("div",{className:l.container},n().createElement(a.InlineFieldRow,{className:l.row},n().createElement(a.InlineField,{tooltip:"Removes the search tab from the query editor",label:"Hide search",labelWidth:26},n().createElement(a.InlineSwitch,{id:"hideSearch",value:null===(s=r.jsonData.search)||void 0===s?void 0:s.hide,onChange:t=>{return(0,e.updateDatasourcePluginJsonDataOption)({onOptionsChange:o,options:r},"search",(n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Gp(e,t,r[t])}))}return e}({},r.jsonData.search),a=null!=(a={hide:t.currentTarget.checked})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})),n));var n,a}}))),n().createElement(a.InlineFieldRow,{className:l.row},n().createElement(a.InlineField,{tooltip:"Configures which fields are available in the UI",label:"Static filters",labelWidth:26},n().createElement(Up,{datasource:d,options:r,onOptionsChange:o}))))}const Xp=e=>({container:(0,o.css)({label:"container",marginBottom:e.spacing(2),maxWidth:"900px"})}),Yp=e=>(Array.isArray(e)?e:[e]).some((e=>(0,t.getTemplateSrv)().containsTemplate(e))),Jp=new e.DataSourcePlugin(ja).setQueryEditor(Kl).setConfigEditor((({options:e,onOptionsChange:r})=>{const o=(0,a.useStyles2)(Xp);return n().createElement("div",{className:o.container},n().createElement(lc,{dataSourceName:"Tempo",docsLink:"https://grafana.com/docs/grafana/latest/datasources/tempo",hasRequiredFields:!1}),n().createElement(a.Divider,{spacing:4}),n().createElement(Ic,{config:e,onChange:r,urlPlaceholder:"http://localhost:3200"}),n().createElement(a.Divider,{spacing:4}),n().createElement(fd,function({config:e,onChange:t}){return{selectedMethod:xd(e),onAuthMethodSelect:Pd(e,t),basicAuth:kd(e,t),TLS:jd(e,t),customHeaders:Nd(e,t),readOnly:e.readOnly}}({config:e,onChange:r})),n().createElement(a.Divider,{spacing:4}),n().createElement(ap,{options:e,onOptionsChange:r}),n().createElement(a.Divider,{spacing:4}),t.config.featureToggles.traceToMetrics?n().createElement(n().Fragment,null,n().createElement(cp,{options:e,onOptionsChange:r}),n().createElement(a.Divider,{spacing:4})):null,n().createElement(bp,{options:e,onOptionsChange:r}),n().createElement(a.Divider,{spacing:4}),n().createElement(Pc,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1},n().createElement(a.Stack,{gap:5,direction:"column"},n().createElement(Qd,{config:e,onChange:r}),t.config.secureSocksDSProxyEnabled&&n().createElement(n().Fragment,null,n().createElement(a.SecureSocksProxySettings,{options:e,onOptionsChange:r})),n().createElement(eu,{title:"Service graph",description:n().createElement(qd,{description:"Select a Prometheus data source that contains the service graph data.",suffix:"tempo/configure-tempo-data-source/#service-graph",feature:"the service graph"})},n().createElement(Qp,{options:e,onOptionsChange:r})),n().createElement(wp,{options:e,onOptionsChange:r}),n().createElement(eu,{title:"Tempo search",description:n().createElement(qd,{description:"Modify how traces are searched.",suffix:"tempo/configure-tempo-data-source/#tempo-search",feature:"Tempo search"})},n().createElement(Wp,{options:e,onOptionsChange:r})),n().createElement(eu,{title:"Loki search",description:n().createElement(qd,{description:"Select a Loki data source to search for traces. Derived fields must be configured in the Loki data source.",suffix:"tempo/configure-tempo-data-source/#loki-search",feature:"Loki search"})},n().createElement(Lp,{options:e,onOptionsChange:r})),n().createElement(eu,{title:"TraceID query",description:n().createElement(qd,{description:"Modify how TraceID queries are run.",suffix:"tempo/configure-tempo-data-source/#traceid-query",feature:"the TraceID query"})},n().createElement(Fp,{options:e,onOptionsChange:r})),n().createElement(_p,{options:e,onOptionsChange:r}))))})).setQueryEditorHelp((function(){return(0,t.reportInteraction)("grafana_traces_cheatsheet_clicked",{datasourceType:"tempo",grafana_version:t.config.buildInfo.version}),n().createElement(n().Fragment,null,n().createElement("h2",null,"Tempo Cheat Sheet"),n().createElement("p",null,n().createElement(a.TextLink,{href:"https://grafana.com/docs/tempo/latest/",external:!0},"Grafana Tempo")," ","is an open source, easy-to-use, and high-volume distributed tracing backend."),n().createElement("p",null,"Tempo implements"," ",n().createElement(a.TextLink,{href:"https://grafana.com/docs/tempo/latest/traceql",external:!0},"TraceQL"),", a traces-first query language inspired by LogQL and PromQL. This query language allows users to precisely and easily select spans and jump directly to the spans fulfilling the specified conditions."),n().createElement("p",null,"You can compose TraceQL queries using either the Search tab (the TraceQL query builder) or the TraceQL tab (the TraceQL query editor). Both of these methods let you build queries and drill-down into result sets. (",n().createElement(a.TextLink,{href:"https://grafana.com/docs/grafana/latest/datasources/tempo/query-editor/",external:!0},"Learn more"),")"))}));(0,t.getAppEvents)().subscribe(e.DashboardLoadedEvent,(({payload:{dashboardId:e,orgId:r,grafanaVersion:n,queries:a}})=>{try{const o=a.tempo;if(!(null==o?void 0:o.length))return;let i={grafana_version:n,dashboard_id:e,org_id:r,native_search_query_count:0,search_query_count:0,service_map_query_count:0,traceql_query_count:0,upload_query_count:0,native_search_queries_with_template_variables_count:0,search_queries_with_template_variables_count:0,service_map_queries_with_template_variables_count:0,traceql_queries_with_template_variables_count:0};for(const e of o)e.hide||("nativeSearch"===e.queryType?(i.native_search_query_count++,(e.serviceName&&Yp(e.serviceName)||e.spanName&&Yp(e.spanName)||e.search&&Yp(e.search)||e.minDuration&&Yp(e.minDuration)||e.maxDuration&&Yp(e.maxDuration))&&i.native_search_queries_with_template_variables_count++):"search"===e.queryType?(i.search_query_count++,e.linkedQuery&&e.linkedQuery.expr&&Yp(e.linkedQuery.expr)&&i.search_queries_with_template_variables_count++):"serviceMap"===e.queryType?(i.service_map_query_count++,e.serviceMapQuery&&Yp(e.serviceMapQuery)&&i.service_map_queries_with_template_variables_count++):"traceql"===e.queryType?(i.traceql_query_count++,Yp(e.query)&&i.traceql_queries_with_template_variables_count++):"upload"===e.queryType&&i.upload_query_count++);(0,t.reportInteraction)("grafana_tempo_dashboard_loaded",i)}catch(e){console.error("error in tempo tracking handler",e)}}))})(),h})()));
//# sourceMappingURL=module.js.map